# Vue 3 å±‚å å¡ç‰‡å¸ƒå±€ç»„ä»¶åº“ - æŠ€æœ¯è§„æ ¼ä¹¦# æŠ€æœ¯è§„æ ¼ä¹¦

## 1. æ¦‚è¿°## **æŠ€æœ¯è§„æ ¼ä¹¦ï¼š`vue-layered-layout` é€šç”¨å¸ƒå±€ç»„ä»¶åº“**

æœ¬ç»„ä»¶åº“ä¸º Vue 3 åº”ç”¨æä¾›ä¸€å¥—çµæ´»çš„å±‚å å¡ç‰‡å¸ƒå±€ç³»ç»Ÿ,æ”¯æŒæ¡Œé¢ç«¯(æ°´å¹³å¸ƒå±€)å’Œç§»åŠ¨ç«¯(å‚ç›´å¸ƒå±€)çš„è‡ªåŠ¨åˆ‡æ¢ã€‚### **1. æ ¸å¿ƒè®¾è®¡å“²å­¦ä¸æ„¿æ™¯ (Core Philosophy & Vision)**

### 1.1 æ ¸å¿ƒç‰¹æ€§`vue-layered-layout` çš„æ ¸å¿ƒå®šä½æ˜¯ä¸€ä¸ª**çº¯ç²¹çš„ã€éä¾µå…¥å¼çš„å¸ƒå±€ä¸äº¤äº’åŸºå…ƒ (Layout and Interaction Primitive)**ï¼Œè€Œéä¸€ä¸ªåŠŸèƒ½æ€§çš„ UI ç»„ä»¶åº“ã€‚å…¶è®¾è®¡å“²å­¦ä¸ HTML çš„ `<table>` å…ƒç´ é«˜åº¦ç›¸ä¼¼ï¼šå®ƒåªè´Ÿè´£å®šä¹‰ç»“æ„ã€ç©ºé—´åˆ’åˆ†å’Œé«˜çº§äº¤äº’è¡Œä¸ºï¼Œè€Œå¯¹å†…éƒ¨æ‰¿è½½çš„**å…·ä½“å†…å®¹å’ŒåŠŸèƒ½å®Œå…¨ä¿æŒä¸å¯çŸ¥ï¼ˆagnosticï¼‰**

- **å¤šå¡ç‰‡ç»„æ”¯æŒ**: æ”¯æŒåœ¨åŒä¸€å®¹å™¨ä¸­åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„å¡ç‰‡ç»„,æ¯ä¸ªç»„å¯ä»¥æœ‰ç‹¬ç«‹çš„æ ·å¼å’Œé…ç½®**æœ¬åº“çš„èŒè´£èŒƒå›´ï¼š**

- **è‡ªé€‚åº”å¸ƒå±€**: æ ¹æ®å®¹å™¨å®½åº¦è‡ªåŠ¨åˆ‡æ¢æ°´å¹³/å‚ç›´å¸ƒå±€

- **å°ºå¯¸è§£æçº¦æŸ**: æ°´å¹³å®½åº¦å­—æ®µä»…æ¥å—åƒç´ , å‚ç›´é«˜åº¦å­—æ®µæ”¯æŒåƒç´ ä¸ `vh`

- **TypeScript æ”¯æŒ**: å®Œæ•´çš„ç±»å‹å®šä¹‰    1. **ç©ºé—´åˆ’åˆ†ï¼š** æä¾›ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºç®¡ç†ä¸€ç»„å¯åŠ¨æ€å¢å‡çš„â€œå¡ç‰‡â€å•å…ƒã€‚

- **éä¾µå…¥å¼**: ä½œä¸ºå¸ƒå±€åŸè¯­,ä¸å¼ºåˆ¶ç‰¹å®šçš„ UI é£æ ¼    2. **å¸ƒå±€è®¡ç®—ï¼š** å®ç°å¤æ‚çš„å“åº”å¼å¸ƒå±€ç®—æ³•ï¼ŒåŒ…æ‹¬æ¡Œé¢ç«¯çš„å¤šè¡Œæ™ºèƒ½æ‰“åŒ…å’Œç§»åŠ¨ç«¯çš„å‚ç›´å †å ã€‚

    3. **çŠ¶æ€ç®¡ç†ï¼š** ç®¡ç†æ¯ä¸ªå¡ç‰‡çš„ä¸¤ç§æ ¸å¿ƒçŠ¶æ€â€”â€”â€œèšç„¦â€ä¸â€œéèšç„¦â€ã€‚

## 2. æ¶æ„è®¾è®¡    4. **äº¤äº’åŸºå…ƒæä¾›ï¼š** æä¾›ä¸€ä¸ªé€šç”¨çš„â€œæ‚¬åœå±•å¼€å¼å®¹å™¨â€(`HoverExpandContainer`)ï¼Œç”¨äºå®ç°è§†è§‰æ— ç¼çš„å±•å¼€/æ”¶èµ·åŠ¨ç”»ï¼Œä½†ä¸é¢„è®¾å…¶å†…éƒ¨åŠŸèƒ½

### 2.1 ç»„ä»¶å±‚æ¬¡ç»“æ„* **â€œä¸åšä»€ä¹ˆâ€ (What we DON'T DO):**

    1. **ä¸é¢„è®¾åŠŸèƒ½ï¼š** ä¸åŒ…å«ä»»ä½•é¢„åˆ¶çš„â€œè¿‡æ»¤â€ã€â€œæ’åºâ€æˆ–â€œåˆ·æ–°â€æŒ‰é’®ã€‚æ‰€æœ‰åŠŸèƒ½æ€§å…ƒç´ å‡ç”±ä½¿ç”¨è€…é€šè¿‡æ’æ§½è‡ªå®šä¹‰ã€‚

```    2. **ä¸é¢„è®¾å†…å®¹ï¼š** ä¸æä¾›é»˜è®¤çš„æ ‡é¢˜ã€æ–‡æœ¬æˆ–ä»»ä½•UIå…ƒç´ ã€‚å¡ç‰‡çš„å¤´éƒ¨å’Œä¸»ä½“åŒºåŸŸæ˜¯å®Œå…¨ç”±ä½¿ç”¨è€…å¡«å……çš„å®¹å™¨ã€‚

LayeredLayoutContainer (å®¹å™¨ç»„ä»¶)    3. **ä¸å¹²æ¶‰æ ·å¼ï¼š** é™¤äº†å¸ƒå±€æ‰€éœ€çš„ç»“æ„æ€§æ ·å¼ï¼ˆå¦‚ `position`, `transform`, `width` ç­‰ï¼‰ï¼Œæœ¬åº“ä¸åº”åŒ…å«ä»»ä½•è£…é¥°æ€§æ ·å¼ï¼ˆå¦‚é¢œè‰²ã€å­—ä½“ã€è¾¹æ¡†æ ·å¼ç­‰ï¼‰ï¼Œä»¥ç¡®ä¿èƒ½æ— ç¼èå…¥ä»»ä½•é¡¹ç›®çš„è®¾è®¡ç³»ç»Ÿã€‚

  â””â”€â”€ LayeredLayoutGroup (å¡ç‰‡ç»„ç»„ä»¶) - å¯ä»¥æœ‰å¤šä¸ª

        â””â”€â”€ LayeredLayoutCard (å¡ç‰‡ç»„ä»¶) - æ¯ä¸ªç»„å†…å¯ä»¥æœ‰å¤šä¸ªå¡ç‰‡æœ€ç»ˆç›®æ ‡æ˜¯äº¤ä»˜ä¸€ä¸ªå¼ºå¤§ã€å¯é¢„æµ‹ä¸”é«˜åº¦å¯å®šåˆ¶çš„å¸ƒå±€â€œå¼•æ“â€ï¼Œè®©å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’ŒUIå®ç°ï¼Œè€Œæ— éœ€å¤„ç†å¤æ‚çš„å“åº”å¼å±‚å å¸ƒå±€è®¡ç®—ã€‚

```

---

### 2.2 æ ¸å¿ƒç»„ä»¶

### **2. ç³»ç»Ÿæ¶æ„ä¸ç»„ä»¶ API (System Architecture & Component API)**

#### 2.2.1 LayeredLayoutContainer

ç³»ç»Ÿç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼Œå®ƒä»¬é€šè¿‡ `props` å’Œ `slots` ååŒå·¥ä½œï¼Œéµå¾ªä¸¥æ ¼çš„å•å‘æ•°æ®æµå’Œå…³æ³¨ç‚¹åˆ†ç¦»åŸåˆ™ã€‚

**ä½œç”¨**: é¡¶å±‚å®¹å™¨,ç”¨äºåŒ…è£¹å¤šä¸ªå¡ç‰‡ç»„ã€‚

#### **2.1. `LayeredLayoutContainer.vue`**

**Props**:
è¿™æ˜¯å¸ƒå±€ç³»ç»Ÿçš„æ ¹å®¹å™¨ï¼Œæ˜¯æ‰€æœ‰å¸ƒå±€é€»è¾‘çš„è®¡ç®—å’Œåˆ†å‘ä¸­å¿ƒã€‚

```typescript

interface LayeredLayoutContainerProps {

  groups: CardGroupConfig[]; // å¡ç‰‡ç»„é…ç½®æ•°ç»„* **Props:**

}

```    ```typescript

    interface Props {

**ç‰¹ç‚¹**:      /**

- ç®€å•çš„åŒ…è£¹å®¹å™¨       * å®šä¹‰æ‰€æœ‰å¡ç‰‡çš„åŸºç¡€é…ç½®ä¿¡æ¯ã€‚

- ä¸å¤„ç†å¸ƒå±€é€»è¾‘       * è¿™æ˜¯é©±åŠ¨æ•´ä¸ªå¸ƒå±€çš„æ ¸å¿ƒæ•°æ®æºã€‚

- é€šè¿‡ slot æ¸²æŸ“å­å¡ç‰‡ç»„       */

      cards: CardConfig[];

#### 2.2.2 LayeredLayoutGroup    }

    ```

**ä½œç”¨**: å•ä¸ªå¡ç‰‡ç»„,ç®¡ç†ä¸€ç»„å¡ç‰‡çš„å¸ƒå±€ã€‚

* **Slots:**

**Props**:  * `default`: é»˜è®¤æ’æ§½ï¼Œç”¨äºæ”¾ç½® `LayeredLayoutCard` ç»„ä»¶ã€‚å®ƒä¼šå‘å­ç»„ä»¶ä½œç”¨åŸŸå†…æš´éœ² `card` (å½“å‰å¡ç‰‡é…ç½®) å’Œ `layout` (è®¡ç®—å‡ºçš„å¸ƒå±€ä¿¡æ¯) ä¸¤ä¸ªå˜é‡ã€‚

```typescript

interface CardGroupConfig {    ```html

  id: string;                    // ç»„ ID    <template #default="{ card, layout }">

  cards: CardConfig[];           // å¡ç‰‡é…ç½®      <LayeredLayoutCard

  className?: string;            // è‡ªå®šä¹‰ CSS ç±»å        :key="card.id"

  style?: Record<string, string | number>; // å†…è”æ ·å¼        :is-focused="layout.isFocused"

  breakpoint?: number;           // æ–­ç‚¹å®½åº¦ (é»˜è®¤: 960px)        :style="layout.style"

  activeBuffer?: number;         // æ¿€æ´»ç¼“å†²åŒº (é»˜è®¤: 20px)      >

}        <!-- Card content goes here -->

```      </LayeredLayoutCard>

    </template>

**ç‰¹ç‚¹**:    ```

- ç‹¬ç«‹ç®¡ç†å¡ç‰‡ç»„çš„å¸ƒå±€çŠ¶æ€

- æ”¯æŒè‡ªå®šä¹‰æ ·å¼å’Œç±»å#### **2.2. `LayeredLayoutCard.vue`**

- å¯ä»¥è®¾ç½®ç‹¬ç«‹çš„ breakpoint

- ä½¿ç”¨ ResizeObserver ç›‘å¬å®¹å™¨å°ºå¯¸å˜åŒ–ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯èšç„¦çš„å¡ç‰‡å•å…ƒã€‚å®ƒæ˜¯ä¸€ä¸ªçº¯ç²¹çš„å†…å®¹å®¹å™¨ã€‚



#### 2.2.3 LayeredLayoutCard* **Props:**



**ä½œç”¨**: å•ä¸ªå¡ç‰‡ç»„ä»¶ã€‚    ```typescript

    interface Props {

**Slots**:      /**

- `header`: å¡ç‰‡å¤´éƒ¨å†…å®¹       * ç”±çˆ¶ç»„ä»¶è®¡ç®—å¹¶ä¼ å…¥ï¼Œå†³å®šå½“å‰å¡ç‰‡æ˜¯å¦å¤„äºèšç„¦çŠ¶æ€ã€‚

- `body`: å¡ç‰‡ä¸»ä½“å†…å®¹       * è¿™æ˜¯å¡ç‰‡å”¯ä¸€çš„ä¸¤ç§çŠ¶æ€ä¹‹ä¸€ã€‚

       */

**ç‰¹ç‚¹**:      isFocused: boolean;

- ä½¿ç”¨ ResizeObserver è‡ªåŠ¨æµ‹é‡å°ºå¯¸    }

- æ”¯æŒèšç„¦/å¤±ç„¦çŠ¶æ€    ```

- æ”¯æŒç‚¹å‡»åˆ‡æ¢ç„¦ç‚¹

* **Slots:**

## 3. å¸ƒå±€ç®—æ³•  * `header`: ç”¨äºå®šä¹‰å¡ç‰‡å¤´éƒ¨åŒºåŸŸçš„å†…å®¹ã€‚æ­¤åŒºåŸŸåœ¨å¡ç‰‡æœªèšç„¦æ—¶å¯è§ã€‚

  * `body`: ç”¨äºå®šä¹‰å¡ç‰‡ä¸»ä½“åŒºåŸŸçš„å†…å®¹ã€‚æ­¤åŒºåŸŸä»…åœ¨å¡ç‰‡èšç„¦æ—¶å®Œå…¨å¯è§ã€‚

### 3.1 æ–¹å‘åˆ¤æ–­

#### **2.3. `HoverExpandContainer.vue`**

ä¸å†ä½¿ç”¨å›ºå®šçš„ breakpoint æ¥åˆ¤æ–­æ–¹å‘,è€Œæ˜¯åŸºäº**å®¹å™¨å®é™…å®½åº¦**:

ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„äº¤äº’åŸºå…ƒï¼Œç”¨äºå®ç°â€œå…‹éš†-å±•å¼€â€æ•ˆæœçš„é€šç”¨å®¹å™¨ã€‚

```typescript

// è®¡ç®—æ‰€æœ‰å¡ç‰‡éœ€è¦çš„æœ€å°æ€»å®½åº¦* **Slots:**

const totalMinWidth = cards.reduce((sum, card) => {  * `trigger`: ç”¨äºå®šä¹‰æŠ˜å çŠ¶æ€ä¸‹å¯è§çš„è§¦å‘å™¨å†…å®¹ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå›¾æ ‡æˆ–æŒ‰é’®ã€‚

  return sum + card.headerWidth + card.minContentWidth;  * `content`: ç”¨äºå®šä¹‰å±•å¼€çŠ¶æ€ä¸‹æ˜¾ç¤ºçš„å†…å®¹ã€‚å¯ä»¥æ˜¯è¾“å…¥æ¡†ã€ä¸‹æ‹‰åˆ—è¡¨æˆ–ä»»ä½•è‡ªå®šä¹‰ç»„ä»¶ã€‚

}, 0);

---

// å¦‚æœå®¹å™¨æ— æ³•å®¹çº³,åˆ‡æ¢åˆ°å‚ç›´å¸ƒå±€

const orientation = totalMinWidth > containerWidth ? 'vertical' : 'horizontal';### **3. æ•°æ®æ¨¡å‹ (Data Model)**

```

è¿™æ˜¯ä½¿ç”¨è€…ä¸æœ¬åº“äº¤äº’çš„**å”¯ä¸€æ•°æ®å¥‘çº¦**ã€‚

### 3.2 å°ºå¯¸è®¡ç®—

```typescript

#### 3.2.1 æ°´å¹³å¸ƒå±€ (æ¡Œé¢ç«¯)/**

 * @description å®šä¹‰å•ä¸ªå¡ç‰‡çš„æ ¸å¿ƒå¸ƒå±€é…ç½®ã€‚

``` * è¿™æ˜¯é©±åŠ¨ `LayeredLayoutContainer` å¸ƒå±€ç®—æ³•çš„å”¯ä¸€è¾“å…¥ã€‚

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” */

â”‚    â”‚                     â”‚export interface CardConfig {

â”‚ H1 â”‚   Content 1         â”‚  /**

â”‚    â”‚                     â”‚   * å¡ç‰‡çš„å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äº Vue çš„ `key` ç»‘å®šå’Œå†…éƒ¨çŠ¶æ€ç®¡ç†ã€‚

â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   * @example 'ip-list-card'

     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   */

     â”‚          â”‚                   â”‚  id: string;

     â”‚    H2    â”‚    Content 2      â”‚

     â”‚          â”‚                   â”‚  /**

     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   * [æ¡Œé¢ç«¯] å¡ç‰‡å†…å®¹åŒºåŸŸçš„æœ€å°æœŸæœ›å®½åº¦ã€‚

```   * ä»…æ”¯æŒåƒç´ å€¼ï¼Œæ—¢å¯ä»¥æ˜¯æ•°å€¼ï¼ˆé»˜è®¤è§†ä¸º pxï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ `'600px'` å½¢å¼ã€‚

   * è¿™æ˜¯å¤šè¡Œæ‰“åŒ…ç®—æ³•è¿›è¡Œæ¢è¡Œå†³ç­–çš„æ ¸å¿ƒä¾æ®ã€‚

- æ¯ä¸ªå¡ç‰‡å ç”¨å®½åº¦ = `headerWidth + mainSize`   */

- æœªèšç„¦æ—¶æ˜¾ç¤ºå®½åº¦ = `headerWidth` (æŠ˜å çŠ¶æ€)  minContentWidth?: number | `${number}px`;

- èšç„¦æ—¶æ˜¾ç¤ºå®½åº¦ = `headerWidth + mainSize + activeBuffer`

  /**

#### 3.2.2 å‚ç›´å¸ƒå±€ (ç§»åŠ¨ç«¯)   * [ç§»åŠ¨ç«¯å¯é€‰] å¡ç‰‡å†…å®¹åŒºåŸŸçš„ç›®æ ‡é«˜åº¦ã€‚

   * æ”¯æŒåƒç´ å’Œè§†å£é«˜åº¦å•ä½ï¼Œç”¨äºå‚ç›´å †å æ¨¡å¼ã€‚

```   */

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  contentHeight?: number | `${number}px` | `${number}vh`;

â”‚         Header 1         â”‚

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  /**

â”‚                          â”‚   * [å¯é€‰] å†…å®¹åŒºä¸Šé™ï¼Œé‡‡ç”¨ä¸ `minContentWidth` ç›¸åŒçš„åƒç´ è§„åˆ™ã€‚

â”‚        Content 1         â”‚   */

â”‚                          â”‚  maxContentWidth?: number | `${number}px`;

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚         Header 2         â”‚  /**

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   * [å¯é€‰] å®šä¹‰è¯¥å¡ç‰‡æ˜¯å¦åº”åœ¨åˆå§‹åŠ è½½æ—¶è¢«èšç„¦ã€‚

```   */

  initialFocus?: boolean;

  /**

   * [å¯é€‰] è‡ªå®šä¹‰æ ˆå é¡ºåºã€‚

   */

  zIndex?: number;
}

### 3.3 CSS å•ä½è§£æ

```typescript
function resolvePxLength(value: number | string | null | undefined, fallback: number): number {
  if (value == null) return fallback;
  if (typeof value === 'number') return value >= 0 ? value : fallback;

  const normalized = String(value).trim().toLowerCase();
  if (!normalized) return fallback;

  if (/^-?\d+(\.\d+)?$/.test(normalized)) {
    return Math.max(0, Number.parseFloat(normalized));
  }

  if (normalized.endsWith('px')) {
    return Math.max(0, Number.parseFloat(normalized.slice(0, -2)));
  }

  return fallback;
}

function resolveContentHeightSize(
  value: number | string | null | undefined,
  viewportHeight: number,
  fallback: number
): number {
  if (value == null) return fallback;
  if (typeof value === 'number') return value >= 0 ? value : fallback;

  const normalized = String(value).trim().toLowerCase();
  if (!normalized) return fallback;

  if (/^-?\d+(\.\d+)?$/.test(normalized)) {
    return Math.max(0, Number.parseFloat(normalized));
  }

  if (normalized.endsWith('px')) {
    return Math.max(0, Number.parseFloat(normalized.slice(0, -2)));
  }

  if (normalized.endsWith('vh')) {
    const ratio = Number.parseFloat(normalized.slice(0, -2));
    if (!Number.isFinite(ratio) || viewportHeight <= 0) return fallback;
    return Math.max(0, (ratio / 100) * viewportHeight);
  }

  return fallback;
}
```

> å®½åº¦å­—æ®µæ‹’ç» `%` æˆ– `vw`ï¼Œä»¥ç¡®ä¿åœ¨å¤æ‚åµŒå¥—å®¹å™¨ä¸­ä»ç„¶å¯é¢„æµ‹ï¼›`vh` ä¼šåœ¨è§†å£é«˜åº¦å˜åŒ–æ—¶é€šè¿‡ `setViewport` é‡æ–°è®¡ç®—ã€‚

## 4. æ•°æ®ç»“æ„å¸ƒå±€ç®—æ³•ä¾èµ–äºç²¾ç¡®çš„å¡ç‰‡å¤´éƒ¨å°ºå¯¸ã€‚ä¸ºæ­¤ï¼Œç»„ä»¶é—´éœ€è¦ä¸€å¥—å¯é çš„é€šä¿¡åè®®

### 4.1 CardConfig1. **`LayeredLayoutContainer` (çˆ¶):**

    * åˆ›å»ºä¸€ä¸ªå“åº”å¼ `Map` å¯¹è±¡ `headerSizes` ç”¨äºå­˜å‚¨æ‰€æœ‰å­å¡ç‰‡çš„å¤´éƒ¨å°ºå¯¸ï¼š`const headerSizes = reactive(new Map<string, { width: number; height: number }>())`ã€‚

```typescript    * é€šè¿‡ Vue çš„ `provide` APIï¼Œå‘æ‰€æœ‰åä»£ç»„ä»¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•° `reportHeaderSize`ã€‚

interface CardConfig {

  id: string;    ```typescript

  minContentWidth?: CSSSize;     // é»˜è®¤: 500    provide('reportHeaderSize', (id: string, size: { width: number; height: number }) => {

  minContentHeight?: CSSSize;    // é»˜è®¤: 500      headerSizes.set(id, size);

  maxContentWidth?: CSSSize;     // å¯é€‰    });

  maxContentHeight?: CSSSize;    // å¯é€‰    ```

  headerWidth?: number;          // è‡ªå®šä¹‰å¤´éƒ¨å®½åº¦(px)

  headerHeight?: number;         // è‡ªå®šä¹‰å¤´éƒ¨é«˜åº¦(px)2. **`LayeredLayoutCard` (å­):**

  initialFocus?: boolean;        // æ˜¯å¦åˆå§‹èšç„¦    * é€šè¿‡ `inject` API è·å– `reportHeaderSize` å‡½æ•°ã€‚

  zIndex?: number;               // å±‚çº§    * åœ¨å…¶ `header` æ’æ§½çš„æ ¹å…ƒç´ ä¸ŠæŒ‚è½½ä¸€ä¸ª `ResizeObserver`ã€‚

}    * å½“å¤´éƒ¨å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ `reportHeaderSize` å‡½æ•°ï¼Œå°†è‡ªèº«çš„ `id` å’Œæ–°çš„å°ºå¯¸ä¸ŠæŠ¥ç»™çˆ¶å®¹å™¨ã€‚

```

#### **4.2. å“åº”å¼å¸ƒå±€å¼•æ“**

### 4.2 CardGroupConfig

- **è§¦å‘ï¼š** åœ¨ `LayeredLayoutContainer` çš„æ ¹å…ƒç´ ä¸ŠæŒ‚è½½ `ResizeObserver`ï¼Œå®æ—¶ç›‘å¬å®¹å™¨å°ºå¯¸å˜åŒ–ã€‚

```typescript* **æ¨¡å¼åˆ‡æ¢ï¼š** æ ¹æ®é¢„è®¾çš„æ–­ç‚¹ï¼ˆä¾‹å¦‚ `960px`ï¼‰å’Œå®¹å™¨å®½åº¦ï¼Œè®¡ç®—å‡ºä¸€ä¸ªå“åº”å¼çš„ `layoutMode` çŠ¶æ€ (`'desktop'` æˆ– `'mobile'`)ã€‚

interface CardGroupConfig {* **çŠ¶æ€é‡ç½®ï¼š** å½“ `layoutMode` å‘ç”Ÿåˆ‡æ¢æ—¶ï¼Œå¿…é¡»æ¸…ç©º `headerSizes` Mapï¼Œå¼ºåˆ¶æ‰€æœ‰å­å¡ç‰‡é‡æ–°æµ‹é‡å¹¶ä¸ŠæŠ¥å…¶åœ¨æ–°æ¨¡å¼ä¸‹çš„å°ºå¯¸ï¼Œé˜²æ­¢å°ºå¯¸æ±¡æŸ“ã€‚

  id: string;

  cards: CardConfig[];#### **4.3. å•è¡Œå±‚å å¸ƒå±€ç®—æ³• (Layered Stack Algorithm)**

  className?: string;

  style?: Record<string, string | number>;æ ¸å¿ƒå¸ƒå±€é€»è¾‘ç”± `useLayeredLayout` Composable æä¾›ã€‚ç®—æ³•ä»¥**å•è¡Œå±‚å **ä¸ºåŸºç¡€ï¼Œé€šè¿‡ä¸Šå±‚å¡ç‰‡åœ¨ä¸»è½´æ–¹å‘å‰ç§»é®æŒ¡ä¸‹å±‚å¡ç‰‡çš„ä¸»ä½“åŒºåŸŸæ¥åˆ¶é€ å±‚å æ„Ÿï¼Œå¤´éƒ¨åŒºåŸŸå§‹ç»ˆä¿æŒå¯è§ï¼Œä»è§†è§‰ä¸Šçœ‹ä¼¼â€œæŠ˜å â€ã€‚

  breakpoint?: number;           // é»˜è®¤: 960

  activeBuffer?: number;         // é»˜è®¤: 20* **è¾“å…¥ï¼š**

}  * å®¹å™¨å°ºå¯¸ï¼ˆç”± `ResizeObserver` æä¾›ï¼‰ã€‚

```  * `CardConfig` æ•°ç»„ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¸»è½´/äº¤å‰è½´çš„å°ºå¯¸çº¦æŸä¸å¯é€‰å›ºå®šå€¼ã€‚

- å¡ç‰‡å¤´éƒ¨çš„å®æ—¶å°ºå¯¸ï¼ˆé€šè¿‡ `updateCardHeader` ä¸ŠæŠ¥ï¼‰ã€‚

## 5. çŠ¶æ€ç®¡ç†

- **ä¸»è½´å°ºå¯¸å†³ç­–ï¼š**

æ¯ä¸ª `LayeredLayoutGroup` ç»´æŠ¤ç‹¬ç«‹çš„å†…éƒ¨çŠ¶æ€:  1. é’ˆå¯¹å½“å‰æ–­ç‚¹ï¼ˆæ¡Œé¢ `horizontal` / ç§»åŠ¨ `vertical`ï¼‰è§£ææ‰€æœ‰ CSS é•¿åº¦ï¼š

     * æ•°å­—é»˜è®¤è§†ä¸º pxã€‚

```typescript     * `vw/vh/%` ä¼šè¢«è½¬æ¢ä¸ºå¯¹åº”çš„è§†å£æˆ–å®¹å™¨åƒç´ å€¼ã€‚

interface InternalCardState {  2. è®¡ç®—æ¯å¼ å¡ç‰‡åœ¨è¢«é®æŒ¡çŠ¶æ€ä¸‹ä»éœ€ä¿ç•™åœ¨è§†å£ä¸­çš„ä¸»è½´å ä½ï¼š`collapsedSpan_i = max(headerSize_i, baseMin_i)`ï¼Œå®ƒå¯¹åº”çš„æ˜¯å¡ç‰‡åœ¨è¢«ä¸Šå±‚é¢æ¿é®ä½ä¸»ä½“æ—¶ä»èƒ½éœ²å‡ºçš„å¤´éƒ¨å®½åº¦ã€‚

  id: string;  3. ç¡®å®šå½“å‰èšç„¦å¡ç‰‡ï¼ˆæ˜¾å¼ç„¦ç‚¹ä¼˜å…ˆï¼Œç¼ºçœæ—¶å›é€€åˆ°æœ€åä¸€ä¸ªå¡ç‰‡ï¼‰ã€‚

  zIndex: number;  4. å¯¹èšç„¦å¡ç‰‡è®¡ç®—å±•å¼€å®½åº¦/é«˜åº¦ï¼š`expandedSpan = min(max(fixed, measured, min, fallback), containerMain)`ï¼Œå…¶ä¸­ `fallback = containerMain - Î£(collapsedSpan_j)`ï¼ˆæ’é™¤è‡ªèº«ï¼‰ï¼Œå¹¶ç¡®ä¿ä¸å°äº `minExpandedWidth`ï¼ˆæ¡Œé¢ï¼‰æˆ– `minVerticalHeight`ï¼ˆç§»åŠ¨ï¼‰ã€‚

  headerWidth: number;          // å®é™…æµ‹é‡æˆ–ç”¨æˆ·æŒ‡å®š  5. å¯¹æœ€åä¸€ä¸ªå¡ç‰‡å¼ºåˆ¶æ ¡æ­£ï¼š`mainSpan_last = max(expandedSpan_last, containerMain - offset_last)`ï¼Œä¿è¯æœ€åä¸€ä¸ªå¡ç‰‡çš„ä¸»è½´å°ºå¯¸æ€»æ˜¯ç²¾ç¡®å¯¹é½å®¹å™¨è¾¹ç•Œï¼Œä¸äº§ç”Ÿæ®‹ä½™ç©ºç™½ã€‚

  headerHeight: number;         // å®é™…æµ‹é‡æˆ–ç”¨æˆ·æŒ‡å®š

  contentWidth: number;         // ResizeObserver æµ‹é‡* **äº¤å‰è½´å°ºå¯¸ï¼š**

  contentHeight: number;        // ResizeObserver æµ‹é‡  * æ”¯æŒ `fixed/min/max` CSS é•¿åº¦è§£æï¼›

  isFocused: boolean;  * åœ¨æ¡Œé¢æ¨¡å¼ä¸‹è‡³å°‘ä¿æŒ `minVerticalHeight`ï¼Œé¿å…ç§»åŠ¨ç«¯é«˜åº¦å¡Œé™·ã€‚

  config: CardConfig;

}#### **4.4. å¸ƒå±€ç»“æœè®¡ç®—**

```

å¯¹æ¯ä¸€ä¸ªå¡ç‰‡ç”Ÿæˆå¦‚ä¸‹æ´¾ç”ŸçŠ¶æ€ï¼š

## 6. CSS å˜é‡

1. **åç§»é‡ (offset)ï¼š** æ¥è‡ªä¹‹å‰æ‰€æœ‰å¡ç‰‡çš„ `activeMin` ä¹‹å’Œã€‚

ç»„ä»¶æš´éœ²ä»¥ä¸‹ CSS å˜é‡ä¾›æ ·å¼å®šåˆ¶:2. **æ¿€æ´»å ä½ (activeMin)ï¼š** ç”¨äºæ§åˆ¶ä¸‹ä¸€å¼ å¡ç‰‡çš„å †å ä½ç½®ä¸ç¼“å†²é—´éš™ã€‚èšç„¦å¡ç‰‡ä½¿ç”¨ `activeMin_i = mainSpan_i + activeBuffer`ï¼Œå…¶ä»–å¡ç‰‡ä½¿ç”¨ `activeMin_i = collapsedSpan_i`ï¼Œè¡¨ç¤ºä»…åœ¨å¤´éƒ¨åŒºåŸŸå¯è§ã€ä¸»ä½“è¢«é®æŒ¡ã€‚

```css3. **æ ·å¼ç”Ÿæˆï¼š** è¾“å‡º `style` å¯¹è±¡ï¼ŒåŒ…å«ï¼š

--vl-total-span       /*å¸ƒå±€æ€»è·¨åº¦*/   * ä¸»è½´å°ºå¯¸ï¼ˆ`width` æˆ– `height`ï¼‰â€”â€”ä¼˜å…ˆä½¿ç”¨è§£æåçš„ CSS é•¿åº¦ï¼›

--panel-header-size   /*å¤´éƒ¨å°ºå¯¸*/   * åç§»å®šä½ï¼ˆ`left/top`ï¼‰ï¼›

--panel-main-size     /*ä¸»ä½“å°ºå¯¸*/   * æ ‡å‡†åŒ–çš„ CSS è‡ªå®šä¹‰å±æ€§ï¼š`--panel-main-size`ã€`--panel-collapsed-main`ã€`--panel-active-min`ã€`--panel-cross-size`ã€‚

--panel-collapsed-main /*æŠ˜å æ—¶å°ºå¯¸*/4. **æ€»è·¨åº¦ (`totalSpan`)ï¼š** `max(offset + mainSpan)`ï¼Œç”¨äºå®¹å™¨å°ºå¯¸çš„æ»šåŠ¨æˆ–åŠ¨ç”»åŸºå‡†ã€‚

--panel-active-min    /*æ¿€æ´»æ—¶æœ€å°å°ºå¯¸*/

```#### **4.5. ç„¦ç‚¹ç®¡ç† (`initialFocus` ä¸äº¤äº’åˆ‡æ¢)**

## 7. äº‹ä»¶ä¸äº¤äº’* åˆå§‹èšç„¦ä¼˜å…ˆå– `cards.find(c => c.initialFocus)`ï¼Œå¦åˆ™å›é€€åˆ°æ•°ç»„æœ€åä¸€ä¸ªå¡ç‰‡ï¼Œç¡®ä¿æ¡Œé¢ç«¯ä¸»å†…å®¹åŒºå§‹ç»ˆå±•å¼€

- `setFocusedCard(id)` æ¥æ”¶ç”¨æˆ·äº¤äº’å¹¶ç«‹å³æ›´æ–°å†…éƒ¨ `isFocused` æ ‡è®°ï¼›ä¼ å…¥ `null` æ—¶ï¼ŒåŒæ ·å›é€€åˆ°æœ€åä¸€ä¸ªå¡ç‰‡ã€‚

### 7.1 ç„¦ç‚¹ç®¡ç†* å¸ƒå±€è®¡ç®—å§‹ç»ˆå¼•ç”¨å½“å‰ `isFocused` çŠ¶æ€ç”Ÿæˆ `activeCardId`ï¼Œä¾› UI åŒæ­¥æ¸²æŸ“

- ç‚¹å‡»å¡ç‰‡å¤´éƒ¨åˆ‡æ¢ç„¦ç‚¹#### **4.6. `HoverExpandContainer` çš„â€œå…‹éš†-ä¼ é€-å˜å½¢â€æœºåˆ¶**

- åŒä¸€ç»„å†…åªæœ‰ä¸€ä¸ªå¡ç‰‡å¯ä»¥èšç„¦

- ä¸åŒç»„ä¹‹é—´çš„ç„¦ç‚¹äº’ä¸å½±å“è¿™æ˜¯å®ç°æ— å¸ƒå±€æŠ–åŠ¨åŠ¨ç”»çš„æ ¸å¿ƒã€‚

### 7.2 å°ºå¯¸ç›‘å¬1. **çŠ¶æ€ï¼š** ç»„ä»¶å†…éƒ¨ç»´æŠ¤ `isExpanded` çŠ¶æ€

2. **è§¦å‘ (`mouseenter` on `#trigger` slot):**

- ä½¿ç”¨ ResizeObserver ç›‘å¬:    a. è·å– `#trigger` æ ¹å…ƒç´ çš„ `getBoundingClientRect()`ã€‚

  - å¡ç‰‡ç»„å®¹å™¨å°ºå¯¸    b. **æ˜¾ç¤ºä¼ é€é—¨ï¼š** æ¿€æ´»ä¸€ä¸ª `Teleport` åˆ° `body` çš„å†…éƒ¨ `div` (`.clone`)ã€‚

  - æ¯ä¸ªå¡ç‰‡çš„å¤´éƒ¨å°ºå¯¸    c. **å…‹éš†ä¸å®šä½ï¼š** å°† `.clone` çš„æ ·å¼ï¼ˆ`width`, `height`, `top`, `left`ï¼‰è®¾ç½®ä¸ºä¸ `getBoundingClientRect()` å®Œå…¨åŒ¹é…ï¼Œå¹¶å°†å…¶å†…å®¹å¡«å……ä¸º `#trigger` æ’æ§½çš„å†…å®¹ã€‚

  - æ¯ä¸ªå¡ç‰‡çš„å†…å®¹å°ºå¯¸    d. **éšè—æœ¬ä½“ï¼š** å°† `#trigger` æ’æ§½çš„æ ¹å…ƒç´ è®¾ç½®ä¸º `visibility: hidden`ã€‚

- å°ºå¯¸å˜åŒ–è‡ªåŠ¨è§¦å‘å¸ƒå±€é‡ç®—    e. **å±•å¼€ï¼š** åœ¨ `nextTick` ä¸­ï¼Œå°† `isExpanded` è®¾ä¸º `true`ã€‚`.clone` å…ƒç´ ç›‘å¬æ­¤çŠ¶æ€å˜åŒ–ï¼Œé€šè¿‡ CSS `transition` å¹³æ»‘åœ°æ”¹å˜å…¶ `width` å’Œå†…éƒ¨å†…å®¹çš„ `opacity`ï¼Œå¹¶åˆ‡æ¢å…¶å†…å®¹ä¸º `#content` æ’æ§½ã€‚

3. **æ”¶èµ· (`mouseleave` from `.clone`):**

## 8. é»˜è®¤å€¼    a. å°† `isExpanded` è®¾ä¸º `false`ï¼Œè§¦å‘é€†å‘ CSS `transition`

    b. ç›‘å¬ `transitionend` äº‹ä»¶ã€‚åŠ¨ç”»ç»“æŸåï¼Œéšè— `.clone`ï¼Œå¹¶å°† `#trigger` æ ¹å…ƒç´ çš„ `visibility` æ¢å¤ä¸º `visible`ã€‚

```typescript

const DEFAULTS = {---

  minContentSize: 500,          // æœ€å°å†…å®¹å°ºå¯¸

  breakpoint: 960,              // æ–­ç‚¹å®½åº¦### **5. æ„å»ºä¸åˆ†å‘ç­–ç•¥ (Build & Distribution Strategy)**ï¼ˆè·³è¿‡åˆ†å‘ï¼‰

  activeBuffer: 20,             // æ¿€æ´»ç¼“å†²

  minHeaderHorizontal: 72,      // æœ€å°å¤´éƒ¨å®½åº¦* **æ„å»ºå·¥å…·ï¼š** Viteï¼Œå¯ç”¨**åº“æ¨¡å¼ (Library Mode)**ã€‚

  minHeaderVertical: 56,        // æœ€å°å¤´éƒ¨é«˜åº¦* **å…¥å£æ–‡ä»¶ (`src/index.ts`):** å¯¼å‡ºæ‰€æœ‰å…¬å…±ç»„ä»¶ (`LayeredLayoutContainer`, `LayeredLayoutCard`, `HoverExpandContainer`) å’Œç±»å‹ (`CardConfig`)ã€‚

  maxHeaderHorizontal: 960,     // æœ€å¤§å¤´éƒ¨å®½åº¦* **`package.json`:**

  maxHeaderVertical: 640        // æœ€å¤§å¤´éƒ¨é«˜åº¦  * **`"main"`, `"module"`, `"exports"`:** æ­£ç¡®æŒ‡å‘ `dist/` ç›®å½•ä¸‹çš„ CJS å’Œ ESM æ„å»ºäº§ç‰©ã€‚

};  * **`"types"`:** æŒ‡å‘ `dist/index.d.ts`ã€‚

```  * **`"files"`:** `["dist"]`ã€‚

  * **`"peerDependencies"`:** `{"vue": "^3.2.0"}`ï¼Œæ˜ç¡®å‘ŠçŸ¥ä½¿ç”¨è€…æœ¬åº“éœ€è¦å®¿ä¸»é¡¹ç›®æä¾› Vueã€‚

## 9. ä½¿ç”¨ç¤ºä¾‹* **ç±»å‹å®šä¹‰ï¼š** ä½¿ç”¨ `vite-plugin-dts` æ’ä»¶åœ¨æ„å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆ `.d.ts` æ–‡ä»¶ï¼Œæä¾›å®Œæ•´çš„ TypeScript æ”¯æŒã€‚

* **æ ·å¼ï¼š** æ‰€æœ‰ç»„ä»¶æ ·å¼ä½¿ç”¨ `<style scoped>` å°è£…ã€‚Vite ä¼šå°†æ‰€æœ‰ CSS æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„ `style.css` æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨è€…éœ€è¦æ‰‹åŠ¨å¼•å…¥ã€‚

### 9.1 å•å¡ç‰‡ç»„

---

```vue

<template>æ­¤æ–‡æ¡£è¯¦å°½åœ°é˜è¿°äº† `vue-layered-layout` ç»„ä»¶åº“çš„è®¾è®¡ç†å¿µã€æ¶æ„ã€æ ¸å¿ƒç®—æ³•å’Œäº¤ä»˜æ ‡å‡†ï¼Œæ—¨åœ¨ä¸ºå·¥ç¨‹å®ç°æä¾›ä¸€ä»½æ¸…æ™°ã€å®Œæ•´ã€æ— æ­§ä¹‰çš„æŒ‡å¯¼è“å›¾ã€‚

  <LayeredLayoutContainer :groups="groups">
    <template #default="{ group }">
      <LayeredLayoutGroup v-bind="group">
        <template #default="{ card, layout, focus, updateMetrics }">
          <LayeredLayoutCard
            :card-id="card.id"
            :style="layout.style"
            :is-focused="layout.isFocused"
            @focus="focus"
            @resize="updateMetrics"
          >
            <template #header>
              <div>{{ card.id }}</div>
            </template>
            <template #body>
              <div>Content for {{ card.id }}</div>
            </template>
          </LayeredLayoutCard>
        </template>
      </LayeredLayoutGroup>
    </template>
  </LayeredLayoutContainer>
</template>

<script setup>
import { ref } from 'vue';

const groups = ref([
  {
    id: 'main-group',
    cards: [
      { id: 'card1', minContentWidth: 400 },
      { id: 'card2', minContentWidth: 500, initialFocus: true },
      { id: 'card3', minContentWidth: 600 }
    ]
  }
]);
</script>
```

### 9.2 å¤šå¡ç‰‡ç»„

```vue
<template>
  <LayeredLayoutContainer :groups="groups">
    <template #default="{ group }">
      <LayeredLayoutGroup 
        v-bind="group"
        :class="group.className"
      >
        <!-- å¡ç‰‡å†…å®¹ -->
      </LayeredLayoutGroup>
    </template>
  </LayeredLayoutContainer>
</template>

<script setup>
const groups = ref([
  {
    id: 'top-group',
    className: 'top-panels',
    style: { borderBottom: '1px solid #ccc' },
    cards: [/* ... */]
  },
  {
    id: 'bottom-group',
    className: 'bottom-panels',
    breakpoint: 768,  // ç‹¬ç«‹çš„æ–­ç‚¹
    cards: [/* ... */]
  }
]);
</script>
```

## 10. æŠ€æœ¯æ ˆ

- **Vue 3.4+**: Composition API
- **TypeScript 5.5+**: ç±»å‹å®‰å…¨
- **Vite 7**: æ„å»ºå·¥å…·
- **Vitest 2**: å•å…ƒæµ‹è¯•

## 11. å˜æ›´å†å²

### v0.2.0 (2025-10-01)

- âœ¨ æ–°å¢å¤šå¡ç‰‡ç»„æ”¯æŒ
- âœ¨ æ–°å¢ `LayeredLayoutGroup` ç»„ä»¶
- ğŸ”„ é‡æ„å¸ƒå±€ç®—æ³•,ç§»é™¤å¤šè¡Œæ‰“åŒ…
- ğŸ”„ åŸºäºå®¹å™¨å®é™…å®½åº¦åˆ¤æ–­å¸ƒå±€æ–¹å‘
- âŒ ç§»é™¤ `fixedContentWidth/Height`
- âœ¨ æ”¯æŒè‡ªå®šä¹‰å¤´éƒ¨å°ºå¯¸ `headerWidth/Height`
- âœ¨ `minContentWidth/Height` é»˜è®¤å€¼æ”¹ä¸º 500px
- âœ¨ æ¯ä¸ªå¡ç‰‡ç»„å¯ç‹¬ç«‹è®¾ç½® CSS ç±»åå’Œæ ·å¼

### v0.1.0

- åˆå§‹ç‰ˆæœ¬
