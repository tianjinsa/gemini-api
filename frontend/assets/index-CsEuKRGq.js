import{d as zt,r as R,a as ie,u as rt,c as p,w as fe,b as Ut,e as hn,f as ce,g as gn,h as d,o as i,m as yn,i as S,t as b,j as _n,k as bn,l as ct,n as Wt,p as ae,q as e,s as z,v as le,x as P,y as Q,z as gt,A as Ot,B as We,C as ve,F as ue,D as _e,E as bt,G as we,T as kn,H as Oe,I as wn,J as et,K as an,L as Ne,M as Tn,N as kt,O as Dt,P as Yt,Q as Cn,R as $n,S as Sn,U as Mn,V as In,W as Pn}from"./vendor-vue-_LDqFLRs.js";import{d as tt,r as xn,a as An}from"./vendor-dayjs-CC1MZq2R.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))u(y);new MutationObserver(y=>{for(const a of y)if(a.type==="childList")for(const C of a.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&u(C)}).observe(document,{childList:!0,subtree:!0});function l(y){const a={};return y.integrity&&(a.integrity=y.integrity),y.referrerPolicy&&(a.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?a.credentials="include":y.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(y){if(y.ep)return;y.ep=!0;const a=l(y);fetch(y.href,a)}})();const En="/dashboard/api";function rn(){return typeof window>"u"?null:window.__DASHBOARD_INIT__??null}function Rn(){return rn()?.aDashkey??null}function qn(){return En}const Ln=1e4;class Jt extends Error{status;payload;constructor(n,l,u){super(n),this.name="DashboardRequestError",this.status=l,this.payload=u}}class Dn{baseUrl;token;constructor(n=qn()){this.baseUrl=n.replace(/\/$/,""),this.token=Rn()}setToken(n){this.token=n}buildUrl(n,l){const u=n.startsWith("/")?n:`/${n}`,y=`${this.baseUrl}${u}`;if(!l||Object.keys(l).length===0)return y;const a=new URLSearchParams;Object.entries(l).forEach(([f,w])=>{w!=null&&a.append(f,String(w))});const C=a.toString();return C?`${y}?${C}`:y}async request(n,l,u={}){const{params:y,signal:a,headers:C={},body:f}=u,w=this.buildUrl(n,y),U=f!==void 0?JSON.stringify(f):void 0,x=await fetch(w,{method:l,signal:a,headers:{Accept:"application/json;charset=UTF-8",...U?{"Content-Type":"application/json;charset=UTF-8"}:{},...this.token?{"x-dashboard-token":this.token}:{},...C},credentials:"same-origin",body:U}),m=(x.headers.get("content-type")||"").includes("application/json");let _=null;if(m)try{_=await x.json()}catch{if(x.ok)throw new Jt("无法解析服务器响应",x.status,null)}if(!x.ok){const V=_,K=V?.error||x.statusText||"请求失败";throw new Jt(K,x.status,V??null)}return _}get(n,l){return this.request(n,"GET",l)}post(n,l,u){return this.request(n,"POST",{...u,body:l})}}const de=new Dn,Hn=()=>de.get("/lightStats"),Bn=()=>de.get("/fullStats"),Fn=r=>de.get("/globalDelta",{params:{since:r}}),zn=r=>de.get("/iptopics",{params:{ip:r}}),Un=(r,n,l={})=>de.get("/topic",{params:{ip:r,tid:n,start:l.start,limit:l.limit}}),Wn=r=>de.get("/messageRequestBody",{params:{id:r}}),On=r=>de.get("/messageRequestHeaders",{params:{id:r}}),Nn=r=>de.get("/modelError",{params:{id:r}}),Kn=r=>de.post("/deleteTopics",r),jn=r=>de.post("/deleteIP",r),Vn=()=>de.get("/blockedIPs"),Gn=r=>de.post("/banIP",r),Yn=r=>de.post("/unbanIP",r),Jn=()=>de.get("/aliasKeys"),Qn=r=>de.post("/deleteAliasKey",r),Xn=r=>{de.setToken(r)},De=zt("dashboard",()=>{const r=R(!1),n=R(null),l=ie(new Map),u=ie(new Map),y=ie(new Map),a=ie(new Map),C=ie(new Map),f=ie(new Map),w=ie(new Map);ie(new Map);const U=R(null),x=R(null),m=rt("dashboard:selected-ip",null),_=rt("dashboard:selected-topic",null),V=rt("dashboard:topic-filter",""),K=rt("dashboard:ip-filter",""),E=rt("dashboard:ip-sort","recent"),k=R(1),D=R(25),h=R(1),H=R(25),j=R(0),ee=R(null),O=R("connected"),M=R(null),I=R(null),T=R(!1),L=R(!1),A=R(!1),J=R(!1),ne=ie(new Map),X=ie(new Map),se=ie(new Map);ie(new Map);const q=R(null),o=p(()=>{for(const t of l.values())if(t.unread)return!0;for(const t of u.values())if(t.unreadTopicIds.size>0)return!0;return!1}),s=p(()=>Array.from(l.entries()).map(([t,c])=>{const{summary:$}=c,W=$.lModReqAt??$.lTopUpdAt??0;return{ip:t,entry:c,summary:$,unread:c.unread,dirtyTopics:c.dirtyTopics,lastActive:W,sortValue:Ce(c.summary,E.value)}})),v=p(()=>{const t=[...s.value],c=E.value;return t.sort(($,W)=>c==="recent"?(W.lastActive||0)-($.lastActive||0):c==="reqs"?(W.summary.reqs||0)-($.summary.reqs||0):c==="in"?(W.summary.inTfc||0)-($.summary.inTfc||0):c==="out"?(W.summary.outTfc||0)-($.summary.outTfc||0):0),t}),Z=p(()=>{const t=K.value.trim().toLowerCase(),$=t?v.value.filter(N=>N.ip.toLowerCase().includes(t)):v.value,W=Math.max(1,Math.ceil($.length/D.value));k.value>W&&(k.value=W);const te=(k.value-1)*D.value;return $.slice(te,te+D.value)});fe(K,()=>{k.value=1});const B=p(()=>{const t=m.value;return t?l.get(t)?.dirtyTopics??!1:!1});fe(B,t=>{t&&m.value&&qe(m.value)});const G=p(()=>{const t=m.value;if(!t)return[];const c=u.get(t);if(!c)return[];const $=[...c.items];$.sort((te,N)=>(N.upAt||0)-(te.upAt||0));const W=V.value.trim().toLowerCase();return W?$.filter(te=>te.tid.toLowerCase().includes(W)||(te.hKey||"").toLowerCase().includes(W)||(te.title||"").toLowerCase().includes(W)):$}),me=p(()=>{const t=G.value,c=Math.max(1,Math.ceil(t.length/H.value));h.value>c&&(h.value=c);const $=(h.value-1)*H.value;return t.slice($,$+H.value)}),Te=p(()=>{const t=_.value;if(!t)return[];const c=y.get(t);return c?c.items:[]}),he=p(()=>{const t=_.value;return t?y.get(t)?.dirty??!1:!1});fe(he,t=>{if(!t)return;const c=_.value;if(!c)return;const $=m.value??ft(c);$&&je($,c)});const be=p(()=>{const t=_.value;if(!t)return null;const c=y.get(t);return c?{total:c.total,dirty:c.dirty,fullyLoaded:c.fullyLoaded,topicHashNoReason:c.topicHashNoReason??null,topicHashWithReason:c.topicHashWithReason??null}:null});function Ce(t,c){return c==="recent"?t.lModReqAt??t.lTopUpdAt??0:c==="reqs"?t.reqs:c==="in"?t.inTfc:c==="out"?t.outTfc:0}function Y(t,c={}){const $=l.get(t.ip),W={ip:t.ip,reqs:t.reqs??$?.summary.reqs??0,inTfc:t.inTfc??$?.summary.inTfc??0,outTfc:t.outTfc??$?.summary.outTfc??0,lTopUpdAt:t.lTopUpdAt??$?.summary.lTopUpdAt,lModReqAt:t.lModReqAt??$?.summary.lModReqAt,realIPs:t.realIPs??$?.summary.realIPs};l.set(t.ip,{summary:W,dirtyTopics:c.markDirty??$?.dirtyTopics??!1,unread:c.markUnread?!0:$?.unread??!1})}function Pe(t){for(const c of l.keys())t.has(c)||(l.delete(c),u.delete(c))}function xe(t){const c=l.get(t);c&&l.set(t,{...c,unread:!1});const $=u.get(t);$&&($.unreadTopicIds=new Set)}function Ae(t,c){const $=u.get(t);if($&&$.unreadTopicIds.has(c)){const W=new Set($.unreadTopicIds);W.delete(c),$.unreadTopicIds=W}}async function Ke(){if(r.value)return;const t=rn();if(q.value=t,t){n.value={totReqs:t.totReqs,totInTfc:t.totInTfc,totOutTfc:t.totOutTfc,ts:t.ts,sTime:t.sTime,lGMsgAt:t.lGMsgAt??null},j.value=t.lGMsgAt??0,Xn(t.aDashkey??null);const c=new Set;t.ipStats.forEach(W=>{c.add(W.ip),Y(W)}),Pe(c);const $=t.ipStats.map(W=>W.ip);m.value&&!$.includes(m.value)&&(m.value=null,_.value=null),!m.value&&$.length>0?pt($[0]):m.value&&qe(m.value)}r.value=!0}async function Ee(){if(!T.value){T.value=!0;try{const t=await Hn();n.value=t,O.value="connected",I.value=null,M.value=Date.now(),t.lGMsgAt&&t.lGMsgAt>j.value&&await Re()}catch(t){O.value="disconnected",I.value=t instanceof Error?t.message:String(t)}finally{T.value=!1}}}async function $e(){if(!L.value){L.value=!0;try{const t=await Bn();n.value={totReqs:t.totReqs,totInTfc:t.totInTfc,totOutTfc:t.totOutTfc,ts:t.ts,sTime:t.sTime,lGMsgAt:t.lGMsgAt};const c=new Set;t.ipStats.forEach($=>{c.add($.ip),Y($)}),Pe(c),O.value="connected",I.value=null}catch(t){O.value="disconnected",I.value=t instanceof Error?t.message:String(t)}finally{L.value=!1}}}async function Re(t){const c=t??j.value,$=await Fn(c);$.lGMsgAt&&(j.value=$.lGMsgAt,ee.value=$.lGMsgAt);const W=new Set,te=Date.now();$.chgIPs.forEach(N=>{W.add(N.ip),Y({ip:N.ip,reqs:N.reqs,inTfc:N.inTfc,outTfc:N.outTfc,lTopUpdAt:N.ipUpdAt,lModReqAt:N.ipUpdAt,realIPs:N.realIPs},{markUnread:!0})}),$.chgTop.forEach(N=>{W.add(N.ip);const Fe=u.get(N.ip),ze=Fe?new Set(Fe.unreadTopicIds):new Set,Ge=m.value===N.ip&&_.value===N.tid;Ge?ze.delete(N.tid):ze.add(N.tid);let Se=Fe?[...Fe.items]:[];const st=Se.findIndex(Me=>Me.tid===N.tid),ge=Me=>{const re=Me?{...Me}:{tid:N.tid,hKey:N.tid,ctAt:N.ctAt??N.upAt??te,upAt:N.upAt??te,msgCnt:N.msgCnt??0,inBytes:N.inBytes??0,outBytes:N.outBytes??0,status:"",hist:!1,title:null};return re.ctAt=N.ctAt??re.ctAt,re.upAt=N.upAt??re.upAt,re.msgCnt=N.msgCnt??re.msgCnt,re.inBytes=N.inBytes??re.inBytes,re.outBytes=N.outBytes??re.outBytes,Object.prototype.hasOwnProperty.call(N,"status")&&(re.status=N.status??re.status),Object.prototype.hasOwnProperty.call(N,"hist")&&(re.hist=N.hist??re.hist),Object.prototype.hasOwnProperty.call(N,"title")&&(re.title=N.title??null),re};st>=0?Se[st]=ge(Se[st]):Se=[ge(),...Se],Se.sort((Me,re)=>(re.upAt||0)-(Me.upAt||0)),u.set(N.ip,{items:Se,fetchedAt:te,dirty:!1,unreadTopicIds:ze});const Ue=y.get(N.tid);Ue&&y.set(N.tid,{...Ue,dirty:!0,fullyLoaded:!1}),Y({ip:N.ip,lTopUpdAt:N.upAt,lModReqAt:N.upAt},{markUnread:!Ge})}),W.size>0&&(O.value="connected",I.value=null)}async function qe(t,c=!1){if(!t)return;const $=u.get(t);if(!(!c&&$&&!$.dirty)&&!ne.get(t)){ne.set(t,!0);try{const W=await zn(t);u.set(t,{items:W.topics,fetchedAt:Date.now(),dirty:!1,unreadTopicIds:$?$.unreadTopicIds:new Set}),_.value&&!W.topics.some(te=>te.tid===_.value)&&(_.value=null),Y({ip:t,lTopUpdAt:W.topics[0]?.upAt??$?.items[0]?.upAt??0},{markDirty:!1,markUnread:!!$?.unreadTopicIds.size})}finally{ne.delete(t)}}}async function je(t,c,$=!1){if(!c)return;const W=y.get(c);if(!(!$&&W&&!W.dirty)&&!X.get(c)){X.set(c,!0);try{const te=await Un(t,c,{start:0,limit:200});y.set(c,{items:te.msgs,total:te.total,fetchedAt:Date.now(),dirty:!1,fullyLoaded:te.msgs.length>=te.total,topicHashNoReason:te.topicHashNoReason??null,topicHashWithReason:te.topicHashWithReason??null}),Ae(t,c),xe(t)}finally{X.delete(c)}}}async function dt(t,c=!1){if(!t)return;const $=C.get(t);if(!c&&$)return $.data;const W=await Wn(t);return C.set(t,{data:W,fetchedAt:Date.now()}),W}async function Tt(t,c=!1){if(!t)return;const $=f.get(t);if(!c&&$)return $.data;const W=await On(t);return f.set(t,{data:W,fetchedAt:Date.now()}),W}async function Ct(t,c=!1){if(!t)return;const $=w.get(t);if(!c&&$)return $.data;const W=await Nn(t);return w.set(t,{data:W,fetchedAt:Date.now()}),W}async function $t(t,c){if(!c.length)return;await Kn({ip:t,topicIds:c});const $=u.get(t);if($){const W=$.items.filter(N=>!c.includes(N.tid)),te=new Set($.unreadTopicIds);c.forEach(N=>te.delete(N)),u.set(t,{items:W,fetchedAt:Date.now(),dirty:!1,unreadTopicIds:te})}c.forEach(W=>y.delete(W)),_.value&&c.includes(_.value)&&(_.value=null),await $e()}async function St(t){await jn({ip:t}),l.delete(t),u.delete(t),Array.from(y.keys()).forEach($=>{ft($)===t&&y.delete($)}),m.value===t&&(m.value=null,_.value=null),await $e()}async function Mt(t,c,$){await Gn({ip:t,durationMs:c,reason:$}),await Be(!0)}async function It(t){await Yn({ip:t}),await Be(!0)}async function He(t){await Qn({aliasName:t}),await Ve(!0)}async function Be(t=!1){if(!A.value&&!(!t&&U.value&&Date.now()-(U.value.now||0)<3e4)){A.value=!0;try{U.value=await Vn()}finally{A.value=!1}}}async function Ve(t=!1){if(J.value)return;const c=x.value?.aliasKeys?.[0];if(!(!t&&x.value&&c&&Date.now()-c.upAt<3e4)){J.value=!0;try{x.value=await Jn()}finally{J.value=!1}}}function pt(t){t!==m.value&&(m.value=t,h.value=1,_.value=null,t&&(qe(t),xe(t)))}function vt(t){t!==_.value&&(_.value=t,t&&m.value&&(je(m.value,t),Ae(m.value,t)))}function ft(t){for(const[c,$]of u.entries())if($.items.some(W=>W.tid===t))return c;return null}function mt(){m.value&&xe(m.value)}function Pt(t,c){const $=u.get(t);return $?$.unreadTopicIds.has(c):!1}function xt(t){return a.get(t)?.data??null}function At(t){return C.get(t)?.data??null}function Et(t){return f.get(t)?.data??null}function Rt(t){return w.get(t)?.data??null}const{pause:qt,resume:g}=Ut(()=>{document.hidden||Ee()},Ln,{immediate:!1});return hn(document,"visibilitychange",()=>{document.hidden?qt():(Ee(),g())}),fe(r,t=>{t&&g()},{immediate:!0}),{initialized:r,stats:n,ipSortKey:E,ipPage:k,ipPageSize:D,topicPage:h,topicPageSize:H,selectedIp:m,selectedTopic:_,topicFilter:V,ipFilter:K,connectionStatus:O,lastSuccessfulPoll:M,pollError:I,hasUnreadUpdates:o,paginatedIps:Z,sortedIpList:v,currentIpTopics:G,paginatedTopics:me,currentTopicMessages:Te,currentTopicMeta:be,blockedIPs:U,aliasKeys:x,bootstrapData:q,globalDeltaSince:j,lastDeltaAt:ee,loadingLightStats:T,loadingFullStats:L,loadingBlockedIPs:A,loadingAliasKeys:J,loadingTopics:ne,loadingMessages:X,loadingMessageDetail:se,initialize:Ke,refreshLightStats:Ee,refreshFullStats:$e,applyGlobalDelta:Re,ensureTopics:qe,ensureMessages:je,loadMessageRequestBody:dt,loadMessageRequestHeaders:Tt,loadModelErrorDetails:Ct,removeTopics:$t,removeIp:St,banIp:Mt,unbanIp:It,removeAlias:He,refreshBlockedIPs:Be,refreshAliasKeys:Ve,setSelectedIp:pt,setSelectedTopic:vt,acknowledgeUpdates:mt,isTopicUnread:Pt,getMessageDetail:xt,getMessageRequestBody:At,getMessageRequestHeaders:Et,getModelErrorDetails:Rt}}),Zn=ce({inheritAttrs:!1,__name:"IconSymbol",props:{name:{}},setup(r){const n=gn(),l=r,u={assistant:"🤖",check_circle:"✔",chevron_left:"‹",chevron_right:"›",close:"✕",content_copy:"⧉",description:"📝",data_object:"{}",delete:"🗑",download:"⬇",error:"⛔",expand_more:"⌄",filter_alt:"⛃",gavel:"🔨",gpp_maybe:"⚠",help:"？",info:"ℹ",key:"🔑",image:"🖼",list:"≡",attach_file:"📎",open_in_new:"↗",psychology:"🧠",psychology_alt:"🧠",refresh:"⟳",search:"🔍",sort:"⇅",sync:"⟳",visibility:"👁",warning:"⚠",zoom_in:"＋",default:"•"},y=p(()=>u[l.name]??u.default);return(a,C)=>(i(),d("span",yn({class:"material-symbols-outlined icon-symbol",role:"img","aria-hidden":"true"},S(n)),b(y.value),17))}}),pe=(r,n)=>{const l=r.__vccOpts||r;for(const[u,y]of n)l[u]=y;return l},F=pe(Zn,[["__scopeId","data-v-ba526ecf"]]),es="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ts=(r=21)=>{let n="",l=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)n+=es[l[r]&63];return n};const ye=zt("ui",()=>{const r=R([]),n=ie({open:!1,payload:null}),l=ie({open:!1,src:"",name:void 0}),u=ie({open:!1,options:null,resolve:null}),y=R(!1),a=R(!1),C=R(!1);function f(h){const H={id:ts(8),type:h.type,title:h.title,message:h.message,duration:h.duration??5e3,createdAt:Date.now()};r.value=[...r.value,H],window.setTimeout(()=>w(H.id),H.duration)}function w(h){r.value=r.value.filter(H=>H.id!==h)}function U(h){n.open=!0,n.payload=h}function x(){n.open=!1,n.payload=null}function m(h,H){l.open=!0,l.src=h,l.name=H}function _(){l.open=!1,l.src="",l.name=void 0}function V(h){return u.open&&u.resolve&&u.resolve(!1),new Promise(H=>{u.open=!0,u.options=h,u.resolve=H})}function K(h){u.resolve&&u.resolve(h),u.open=!1,u.options=null,u.resolve=null}function E(h){y.value=h??!y.value}function k(h){a.value=h??!a.value}function D(h){C.value=h??!C.value}return{toasts:r,preview:n,imagePreview:l,confirmDialog:u,banManagerOpen:y,aliasManagerOpen:a,helpPanelOpen:C,pushToast:f,dismissToast:w,showPreview:U,closePreview:x,showImagePreview:m,closeImagePreview:_,confirm:V,resolveConfirm:K,toggleBanManager:E,toggleAliasManager:k,toggleHelpPanel:D}});tt.extend(xn);tt.extend(An);tt.locale("zh-cn");const Qt=["B","KB","MB","GB","TB"];function ke(r,n=1){if(!Number.isFinite(r))return"0 B";const l=Math.abs(r);if(l===0)return"0 B";const u=Math.min(Math.floor(Math.log10(l)/3),Qt.length-1),y=r/Math.pow(1024,u);return`${y.toFixed(y>=10?0:n)} ${Qt[u]}`}function un(r){return Number.isFinite(r)?new Intl.NumberFormat("zh-CN").format(r):"0"}function Ie(r){return tt(r).format("YYYY-MM-DD HH:mm:ss")}function Nt(r){return tt(r).fromNow()}function cn(r){if(r<=0)return"0秒";const n=tt.duration(r),l=[];n.days()&&l.push(`${n.days()}天`),n.hours()&&l.push(`${n.hours()}小时`),n.minutes()&&l.push(`${n.minutes()}分`);const u=n.seconds();return(u||l.length===0)&&l.push(`${u}秒`),l.join("")}const dn=_n(()=>{const r=R(Date.now());return Ut(()=>{r.value=Date.now()},3e4,{immediate:!0}),r}),Kt=dn;function jt(r){const n=dn();return p(()=>{n.value;const l=bn(r);return l==null?"—":Nt(l)})}const ns={class:"stats-header__pinned"},ss={class:"stats-header__pinned-row"},os={key:0,class:"badge badge--success"},ls={key:0,class:"stats-header__pinned-banner"},as={class:"status-banner status-banner--error status-banner--compact"},rs=["disabled"],is={class:"stats-header__content"},us={class:"stats-header__top"},cs={class:"stats-header__title"},ds={class:"stats-header__badges"},ps={key:0,class:"badge badge--success"},vs={class:"stats-header__actions"},fs=["disabled"],ms={key:0,class:"stats-header__banner status-banner status-banner--error"},hs=["disabled"],gs={key:1,class:"stats-header__grid"},ys={class:"metric-card"},_s={class:"metric-value"},bs={class:"metric-card"},ks={class:"metric-value"},ws={class:"metric-card"},Ts={class:"metric-value"},Cs={class:"metric-card"},$s={class:"metric-value"},Ss={class:"metric-card"},Ms={class:"metric-value"},Is={class:"metric-card"},Ps={class:"metric-value"},xs=ce({__name:"StatsHeader",setup(r){const n=De(),l=ye(),u=R(!1),y=R(!1);let a=null;const C=p(()=>n.hasUnreadUpdates),f=p(()=>n.connectionStatus==="connected"?"已连接":"连接中断"),w=p(()=>["badge",n.connectionStatus==="connected"?"badge--success":"badge--danger"]),U=p(()=>n.loadingLightStats||n.loadingFullStats),x=p(()=>n.pollError),m=Kt(),_=jt(()=>n.lastDeltaAt??null),V=R(Date.now()),{pause:K}=Ut(()=>{V.value=Date.now()},1e3,{immediate:!0}),E=p(()=>{const I=n.stats;if(!I)return null;m.value;const T=V.value,L=I.sTime?Number(I.sTime):T,A=I.ts?Ie(I.ts):"—",J=n.lastDeltaAt?_.value:"—";return{totalRequests:un(I.totReqs??0),totalIn:ke(I.totInTfc??0),totalOut:ke(I.totOutTfc??0),uptime:cn(T-L),lastUpdate:A,lastDelta:J}});function k(){n.refreshFullStats(),n.refreshLightStats()}function D(){k()}function h(){a!==null&&(window.clearTimeout(a),a=null),u.value=!0}function H(I=500){a!==null&&window.clearTimeout(a),a=window.setTimeout(()=>{y.value||(u.value=!1)},I)}function j(I){I.clientY<=110?h():H()}function ee(I){const T=I.touches[0];T&&(T.clientY<=120?h():H())}function O(){y.value=!0,h()}function M(){y.value=!1,H(350)}return ct(()=>{window.addEventListener("mousemove",j),window.addEventListener("touchstart",ee,{passive:!0}),H(0)}),Wt(()=>{K(),window.removeEventListener("mousemove",j),window.removeEventListener("touchstart",ee),a!==null&&window.clearTimeout(a)}),(I,T)=>(i(),d("header",{class:ae(["stats-header",{"stats-header--collapsed":!u.value}]),onMouseenter:O,onMouseleave:M},[e("div",ns,[e("div",ss,[e("span",{class:ae(["badge",w.value])},[T[1]||(T[1]=e("span",{class:"dot"},null,-1)),le(" "+b(f.value),1)],2),C.value?(i(),d("span",os,[...T[2]||(T[2]=[e("span",{class:"dot"},null,-1),le(" 有新消息 ",-1)])])):z("",!0)]),x.value?(i(),d("div",ls,[e("div",as,[P(F,{name:"error"}),e("div",null,[T[3]||(T[3]=e("strong",null,"同步异常",-1)),e("p",null,b(x.value),1)]),e("button",{class:"ghost-button",type:"button",disabled:U.value,onClick:Q(D,["stop"])},[P(F,{name:"refresh"}),T[4]||(T[4]=e("span",null,"重试",-1))],8,rs)])])):z("",!0)]),e("div",is,[e("div",us,[e("div",cs,[T[7]||(T[7]=e("h1",null,"Gemini Proxy 控制台",-1)),e("div",ds,[e("span",{class:ae(["badge",w.value])},[T[5]||(T[5]=e("span",{class:"dot"},null,-1)),le(" "+b(f.value),1)],2),C.value?(i(),d("span",ps,[...T[6]||(T[6]=[e("span",{class:"dot"},null,-1),le(" 有新消息 ",-1)])])):z("",!0)])]),e("div",vs,[e("button",{class:"ghost-button",onClick:k,disabled:U.value},[P(F,{name:"refresh"}),T[8]||(T[8]=e("span",null,"刷新",-1))],8,fs),e("button",{class:"ghost-button",onClick:T[0]||(T[0]=L=>S(l).toggleHelpPanel(!0))},[P(F,{name:"help"}),T[9]||(T[9]=e("span",null,"帮助",-1))])])]),x.value?(i(),d("div",ms,[P(F,{name:"error"}),e("div",null,[T[10]||(T[10]=e("strong",null,"同步异常",-1)),e("p",null,b(x.value),1)]),e("button",{class:"ghost-button",type:"button",disabled:U.value,onClick:D},[P(F,{name:"refresh"}),T[11]||(T[11]=e("span",null,"重试",-1))],8,hs)])):z("",!0),E.value?(i(),d("div",gs,[e("div",ys,[T[12]||(T[12]=e("p",{class:"metric-title"},"总请求数",-1)),e("p",_s,b(E.value.totalRequests),1)]),e("div",bs,[T[13]||(T[13]=e("p",{class:"metric-title"},"入站流量",-1)),e("p",ks,b(E.value.totalIn),1)]),e("div",ws,[T[14]||(T[14]=e("p",{class:"metric-title"},"出站流量",-1)),e("p",Ts,b(E.value.totalOut),1)]),e("div",Cs,[T[15]||(T[15]=e("p",{class:"metric-title"},"运行时长",-1)),e("p",$s,b(E.value.uptime),1)]),e("div",Ss,[T[16]||(T[16]=e("p",{class:"metric-title"},"最后更新检查时间",-1)),e("p",Ms,b(E.value.lastUpdate),1)]),e("div",Is,[T[17]||(T[17]=e("p",{class:"metric-title"},"上次增量",-1)),e("p",Ps,b(E.value.lastDelta),1)])])):z("",!0)])],34))}}),As=pe(xs,[["__scopeId","data-v-15fbcf86"]]),Qe=500,Es=72,Rs=56,qs=960,Ls=640,Ht=1440,it=900,Xt=.75,yt=1,Zt=6,pn=.75,en=64,tn=(r,n,l)=>Math.min(Math.max(r,n),l),Xe=r=>typeof r=="number"&&Number.isFinite(r),Le=(r,n,l=pn)=>Math.abs(r-n)>l,vn=/^-?\d+(\.\d+)?$/;function ut(r){const n=Number.parseFloat(r);return Number.isFinite(n)?Math.max(0,n):null}function Ze(r,n){if(r==null)return n;if(typeof r=="number")return r>=0?r:n;const l=String(r).trim().toLowerCase();return l?vn.test(l)?ut(l)??n:l.endsWith("px")?ut(l.slice(0,-2))??n:n:n}function nn(r,{viewportHeight:n,fallback:l}){if(r==null)return l;if(typeof r=="number")return r>=0?r:l;const u=String(r).trim().toLowerCase();if(!u)return l;if(vn.test(u))return ut(u)??l;if(u.endsWith("px"))return ut(u.slice(0,-2))??l;if(u.endsWith("vh")){const y=n>0?n:typeof window<"u"?window.innerHeight:it,a=ut(u.slice(0,-2));return y<=0||a==null?l:Math.max(0,a/100*y)}return l}function Ds(r){const n=r.cards,l=r.activeBuffer,u=r.defaultStackDirection??"right",y=r.minHeader??{horizontal:Es,vertical:Rs},a=r.maxHeader??{horizontal:qs,vertical:Ls},C=n.find(k=>k.initialFocus)?.id??(n.length>0?n[n.length-1].id:null),f=ie({viewport:{width:1440,height:900},container:{width:1280,height:800},cards:n.map((k,D)=>({id:k.id,zIndex:k.zIndex??D+1,rightStackHeaderWidth:k.rightStackHeaderWidth??y.horizontal,downStackHeaderHeight:k.downStackHeaderHeight??y.vertical,isFocused:k.initialFocus??!1,contentWidth:Ze(k.minContentWidth,Qe),contentHeight:nn(k.contentHeight,{viewportHeight:it,fallback:Qe}),config:k}))});let w;if(r.breakpointWidth!=null)w=r.breakpointWidth;else{let k=0,D=0;for(let h=f.cards.length-1;h>=0;h--){const H=f.cards[h],j=Ze(H.config.minContentWidth,Qe)+D;k=Math.max(k,j),D+=H.rightStackHeaderWidth}w=k}let U=u;const x=p(()=>{const k=f.container.width||f.viewport.width||Ht,D=f.container.height||f.viewport.height||it,h=f.viewport.width||Ht,H=f.viewport.height||it;let j=u;if(u==="right"){const T=Math.max(0,w-en),L=w+en,A=()=>{let X=0;for(let se=0;se<f.cards.length;se++){const q=f.cards[se],o=Ze(q.config.minContentWidth,Qe),s=k-X;if(o>s+pn)return!0;X+=q.rightStackHeaderWidth}return!1},J=h<T,ne=k<T;if(U==="down"){const X=h>L,se=k>L&&!A();j=X&&se?"right":"down"}else j=J||ne||A()?"down":"right"}U=j;let ee=0,O=0;const M=[];if(j==="right"){let T=0;for(let L=0;L<f.cards.length;L++)M[L]=Math.max(0,k-T),T+=f.cards[L].rightStackHeaderWidth}const I=f.cards.map((T,L)=>{const{config:A}=T,J=j==="right",ne=J?T.rightStackHeaderWidth:T.downStackHeaderHeight;let X;if(J){const s=Ze(A.minContentWidth,Qe),v=Math.max(0,M[L]??k);let Z=s;A.minContentWidth!=null&&(Z=Math.max(Z,Ze(A.minContentWidth,0)));const B=A.maxContentWidth!=null?Ze(A.maxContentWidth,1/0):1/0;if(Number.isFinite(B)&&(Z=Math.min(Z,B)),L===f.cards.length-1){const G=Math.min(v,B);Z=Math.max(Z,G)}X=Math.min(Z,v)}else{const s=nn(A.contentHeight,{viewportHeight:H,fallback:Qe});X=Math.min(s,D)}const se=ne,q=T.isFocused?X+l:se,o={zIndex:String(T.zIndex)};return J?(o.left=`${ee}px`,o.top="0px",o.width=`${X}px`,o.height="100%"):(o.left="0px",o.top=`${ee}px`,o.width="100%",o.height=`${X}px`),o["--panel-header-size"]=`${ne}px`,o["--panel-main-size"]=`${X}px`,o["--panel-collapsed-main"]=`${se}px`,o["--panel-active-min"]=`${q}px`,O=Math.max(O,ee+X),ee+=q,{...T,activeMin:q,mainSpan:X,style:o}});return{stackDirection:j,cards:I,totalSpan:O,activeCardId:f.cards.find(T=>T.isFocused)?.id??C}});function m(k,D){const h=k||(typeof window<"u"?window.innerWidth:Ht),H=D||(typeof window<"u"?window.innerHeight:it);Le(f.viewport.width,h,yt)&&(f.viewport.width=h),Le(f.viewport.height,H,yt)&&(f.viewport.height=H)}function _(k,D){Xe(k)&&k>0&&Le(f.container.width,k,yt)&&(f.container.width=k),Xe(D)&&D>0&&Le(f.container.height,D,yt)&&(f.container.height=D)}function V(k){f.cards.forEach(D=>{D.isFocused=k?D.id===k:!1})}function K(k,D,h){const H=f.cards.find(j=>j.id===k);H&&(Xe(D)&&D>0&&Le(H.contentWidth,D,Zt)&&(H.contentWidth=D),Xe(h)&&h>0&&Le(H.contentHeight,h,Zt)&&(H.contentHeight=h))}function E(k,D,h){const H=f.cards.find(j=>j.id===k);if(H){if(Xe(D)&&D>0){const j=tn(D,y.horizontal,a.horizontal);Le(H.rightStackHeaderWidth,j,Xt)&&(H.rightStackHeaderWidth=j)}if(Xe(h)&&h>0){const j=tn(h,y.vertical,a.vertical);Le(H.downStackHeaderHeight,j,Xt)&&(H.downStackHeaderHeight=j)}}}return{layout:x,setViewport:m,setContainerSize:_,setFocusedCard:V,updateCardMetrics:K,updateCardHeader:E}}const wt=Symbol("panel-layout-hooks"),Hs={ipList:{id:"ipList",minContentWidth:500,contentHeight:"60vh",zIndex:1},topicList:{id:"topicList",minContentWidth:560,contentHeight:"60vh",zIndex:2},messageList:{id:"messageList",minContentWidth:720,contentHeight:"80vh",zIndex:3}};function Bs(r){return{...r}}function Fs(r){const n=r.map(y=>Bs(Hs[y])),l=Ds({cards:n,defaultStackDirection:"right",activeBuffer:20});return{layout:p(()=>{const y=l.layout.value;return{stackDirection:y.stackDirection,panels:y.cards.map(a=>({...a,id:a.id})),totalSpan:y.totalSpan,activePanelId:y.activeCardId?y.activeCardId:null}}),setViewport:l.setViewport,setContainerSize:l.setContainerSize,setFocusedPanel:l.setFocusedCard,updatePanelMetrics:l.updateCardMetrics,updatePanelHeader:l.updateCardHeader}}let Bt=null,Ft=null;function sn(r,n){const l=Math.max(n*1.6,220);if(typeof window>"u")return l;Bt||(Bt=document.createElement("canvas")),Ft||(Ft=Bt.getContext("2d"));const u=Ft;if(!u)return l;const a=window.getComputedStyle(document.body).font||'14px "Inter", "Segoe UI", system-ui, sans-serif';u.font=a;let C=0;return r.forEach(w=>{if(!w?.label)return;const U=u.measureText(w.label);C=Math.max(C,U.width)}),Math.max(l,Math.ceil(C+96))}const on="control-button--overlay-hidden",_t="__overlay__none__",Vt=zt("controlOverlay",()=>{const r=ie({top:0,left:0,width:0,height:0}),n=R(!1),l=R(!1),u=R(!1),y=R(""),a=R("filter"),C=R(""),f=R(""),w=R(""),U=R([]),x=R("left"),m=R(0),_=R(220),V=R(!1),K=R(!1),E=gt(null),k=R(!1);let D=null;const h=gt(null),H=gt(null),j=gt(null);function ee(B){const G=B.getBoundingClientRect();r.top=G.top,r.left=G.left,r.width=G.width,r.height=G.height}let O=null;function M(){O!==null&&(window.clearTimeout(O),O=null)}function I(){D!==null&&(window.clearTimeout(D),D=null),k.value=!1}function T(B=260){I(),k.value=!0,D=window.setTimeout(()=>{k.value=!1,D=null},B)}function L(B){if(!B)return;const G=B.dataset;G.overlayPrevAria||(G.overlayPrevAria=B.getAttribute("aria-hidden")??_t),G.overlayPrevTabindex||(G.overlayPrevTabindex=B.getAttribute("tabindex")??_t),B.setAttribute("aria-hidden","true"),B.setAttribute("tabindex","-1"),G.overlayHidden="true",B.classList.add(on)}function A(B){if(!B)return;const G=B.dataset;B.classList.remove(on),G.overlayHidden&&delete G.overlayHidden,G.overlayPrevAria?(G.overlayPrevAria===_t?B.removeAttribute("aria-hidden"):B.setAttribute("aria-hidden",G.overlayPrevAria),delete G.overlayPrevAria):B.removeAttribute("aria-hidden"),G.overlayPrevTabindex?(G.overlayPrevTabindex===_t?B.removeAttribute("tabindex"):B.setAttribute("tabindex",G.overlayPrevTabindex),delete G.overlayPrevTabindex):B.removeAttribute("tabindex")}function J(B){const G=E.value,me=G!==null&&G!==B.anchorEl,Te=n.value;me&&A(G),E.value=B.anchorEl,ee(B.anchorEl),L(B.anchorEl),y.value=B.controlId,a.value=B.variant,C.value=B.label,f.value=B.icon,w.value=B.value,U.value=B.options?.slice()??[],x.value=B.align??"left";const he=B.collapsedWidth??r.width;m.value=he,V.value=B.collapsedWidth!=null,B.expandedWidth!=null?(_.value=Math.max(B.expandedWidth,he),K.value=!0):B.variant==="sort"?(_.value=Math.max(sn(U.value,he),he),K.value=!1):(_.value=Math.max(r.width*4,220,he),K.value=!1),h.value=B.onInput??null,H.value=B.onCommit??null,j.value=B.onCancel??null,M();const be=me&&Te;u.value=!1,be?(T(),l.value=!0,n.value=!0):(I(),l.value=!1,n.value=!0)}function ne(B){w.value=B,h.value?.(B)}function X(B){const G=B??w.value;w.value=G,H.value?.(G),o()}function se(){n.value&&(M(),u.value=!1,l.value=!0)}function q(B=160){n.value&&(M(),O=window.setTimeout(()=>{O=null,o()},B))}function o(B=!1){if(n.value&&(M(),!(u.value&&!B))){if(B){l.value=!1,u.value=!1,n.value=!1,v();return}u.value||(l.value=!1,u.value=!0)}}function s(){j.value?.(),o()}function v(){M(),I(),E.value&&A(E.value),E.value=null,n.value=!1,u.value=!1,l.value=!1,y.value="",V.value=!1,K.value=!1,h.value=null,H.value=null,j.value=null}function Z(){E.value&&(ee(E.value),V.value||(m.value=r.width),K.value||(a.value==="sort"?_.value=Math.max(sn(U.value,m.value),m.value):_.value=Math.max(r.width*4,220,m.value)))}return{rect:r,visible:n,expanded:l,closing:u,relocating:k,controlId:y,variant:a,label:C,icon:f,value:w,options:U,align:x,collapsedWidth:m,expandedWidth:_,open:J,updateValue:ne,commit:X,requestClose:o,cancel:s,finalize:v,refreshAnchorRect:Z,beginInteraction:se,scheduleClose:q}}),zs={key:0,class:"panel-rail__meta"},Us={class:"panel-rail__controls"},Ws={class:"panel-rail__actions"},Os=["title"],Ns=["title"],Ks=["disabled"],js=["disabled"],Vs={class:"panel-main"},Gs={class:"panel-header__primary"},Ys={key:0,class:"panel-header__count"},Js={class:"panel-header__controls"},Qs={class:"panel-header__actions"},Xs=["title"],Zs=["title"],eo=["disabled"],to=["disabled"],no={class:"panel-content ip-list"},so=["onClick"],oo={class:"ip-item__header"},lo={class:"ip-item__identity"},ao={class:"ip-item__name"},ro={key:0,class:"ip-item__alias"},io={class:"ip-item__alias-text"},uo={class:"ip-item__alias-popover"},co=["title"],po={class:"ip-item__metrics"},vo={key:0,class:"empty-state"},fo={class:"panel-footer"},mo=["disabled"],ho={class:"page-info"},go=["disabled"],yo=ce({__name:"IpListPanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(r,{expose:n,emit:l}){const u=r,y=l,a=De(),C=ye(),f=p(()=>a.paginatedIps),w=p(()=>a.selectedIp),U=p(()=>Math.max(1,Math.ceil(a.sortedIpList.length/a.ipPageSize))),x=p(()=>a.sortedIpList.length),m=p(()=>a.ipFilter.trim().length>0),_=Kt(),V=[{value:"recent",label:"最近活跃"},{value:"reqs",label:"请求数"},{value:"in",label:"入流量"},{value:"out",label:"出流量"}],K=V[0]?.value??"",E=R(null),k=R(null),D=Ot(wt,null),h=Vt(),H=R(null),j=R(null),ee=p(()=>u.collapsed===!0),O=p(()=>V.find(o=>o.value===a.ipSortKey)?.label??"最近活跃");D?.ipList&&(We(E,q=>{const o=q[0];if(!o)return;const s=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize,v=s?s.inlineSize:o.contentRect.width;v>0&&D.ipList.reportHeaderSize({width:v,height:0})}),We(k,q=>{const o=q[0];if(!o)return;const s=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize,v=s?s.blockSize:o.contentRect.height;v>0&&D.ipList.reportHeaderSize({width:0,height:v})}));function M(q){a.setSelectedIp(q)}function I(){y("request-focus")}function T(q,o){const s=q?.currentTarget;return s instanceof HTMLElement?s:o}function L(q){const o=T(q,H.value);if(!o)return;if(h.visible&&h.controlId==="ip-filter")if(h.closing)h.finalize();else{h.refreshAnchorRect();return}const s=a.ipFilter;h.open({controlId:"ip-filter",anchorEl:o,variant:"filter",label:"过滤 IP",icon:"search",value:s,expandedWidth:280,onInput(v){a.ipFilter=v},onCommit(v){a.ipFilter=v.trim()},onCancel(){a.ipFilter=s}})}function A(q){const o=T(q,j.value);if(!o)return;if(h.visible&&h.controlId==="ip-sort")if(h.closing)h.finalize();else{h.refreshAnchorRect();return}const s=a.ipSortKey;h.open({controlId:"ip-sort",anchorEl:o,variant:"sort",label:"排序方式",icon:"sort",value:a.ipSortKey,options:V,onCommit(v){a.ipSortKey=v},onCancel(){a.ipSortKey=s}})}function J(q){const{lModReqAt:o,lTopUpdAt:s}=q.summary,v=o??s;return _.value,v?Nt(v):"—"}function ne(q){const{lModReqAt:o,lTopUpdAt:s}=q.summary,v=o??s;return v?Ie(v):"—"}async function X(){if(!(!w.value||!await C.confirm({title:"删除 IP 数据",message:`确定要删除 IP “${w.value}” 的所有话题和消息吗？该操作不可恢复。`,confirmLabel:"删除",destructive:!0})))try{await a.removeIp(w.value),C.pushToast({type:"success",title:"删除成功",message:"IP 数据已清理。"})}catch(o){C.pushToast({type:"error",title:"删除失败",message:o instanceof Error?o.message:String(o)})}}function se(){h.visible&&(h.controlId==="ip-filter"||h.controlId==="ip-sort")&&h.requestClose()}return n({resetToCollapsedState:se}),(q,o)=>(i(),d("section",{class:ae(["panel panel--ip",{"panel--collapsed":ee.value}]),onMouseenter:I,onFocusin:I,onPointerdownCapture:I},[r.stackDirection==="right"?(i(),d("aside",{key:0,ref_key:"desktopHeaderEl",ref:E,class:"panel-rail panel-rail--desktop"},[o[29]||(o[29]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"IP 列表",-1)),x.value?(i(),d("div",zs,[e("strong",null,b(x.value),1),o[28]||(o[28]=e("span",null,"IP",-1))])):z("",!0),e("div",Us,[e("div",Ws,[e("button",{ref_key:"filterTriggerEl",ref:H,class:ae(["control-button control-button--icon",{"control-button--active":m.value}]),type:"button","aria-label":"过滤 IP",title:m.value?`过滤：${S(a).ipFilter}`:"过滤 IP",onMouseenter:o[0]||(o[0]=s=>L(s)),onFocus:o[1]||(o[1]=s=>L(s)),onClick:o[2]||(o[2]=s=>L(s)),onKeydown:[o[3]||(o[3]=ve(Q(s=>L(s),["prevent"]),["enter"])),o[4]||(o[4]=ve(Q(s=>L(s),["prevent"]),["space"]))]},[P(F,{name:"search"})],42,Os),e("button",{ref_key:"sortTriggerEl",ref:j,class:ae(["control-button control-button--icon",{"control-button--active":S(a).ipSortKey!==S(K)}]),type:"button","aria-label":"排序方式",title:`排序：${O.value}`,onMouseenter:o[5]||(o[5]=s=>A(s)),onFocus:o[6]||(o[6]=s=>A(s)),onClick:o[7]||(o[7]=s=>A(s)),onKeydown:[o[8]||(o[8]=ve(Q(s=>A(s),["prevent"]),["enter"])),o[9]||(o[9]=ve(Q(s=>A(s),["prevent"]),["space"]))]},[P(F,{name:"sort"})],42,Ns),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新","aria-label":"刷新",disabled:S(a).loadingFullStats,onClick:o[10]||(o[10]=(...s)=>S(a).refreshFullStats&&S(a).refreshFullStats(...s))},[P(F,{name:"sync"})],8,Ks),e("button",{class:"control-button control-button--icon",type:"button",title:"封禁管理","aria-label":"封禁管理",onClick:o[11]||(o[11]=s=>S(C).toggleBanManager(!0))},[P(F,{name:"gpp_maybe"})]),e("button",{class:"control-button control-button--icon",type:"button",title:"别名管理","aria-label":"别名管理",onClick:o[12]||(o[12]=s=>S(C).toggleAliasManager(!0))},[P(F,{name:"key"})]),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除当前 IP","aria-label":"删除当前 IP",disabled:!w.value,onClick:X},[P(F,{name:"delete"})],8,js)])])],512)):z("",!0),e("div",Vs,[r.stackDirection==="down"?(i(),d("header",{key:0,ref_key:"mobileHeaderEl",ref:k,class:"panel-header panel-header--mobile"},[e("div",Gs,[o[30]||(o[30]=e("h2",null,"IP 列表",-1)),x.value?(i(),d("span",Ys,b(x.value),1)):z("",!0)]),e("div",Js,[e("div",Qs,[e("button",{class:ae(["control-button control-button--icon",{"control-button--active":m.value}]),type:"button","aria-label":"过滤 IP",title:m.value?`过滤：${S(a).ipFilter}`:"过滤 IP",onMouseenter:o[13]||(o[13]=s=>L(s)),onFocus:o[14]||(o[14]=s=>L(s)),onClick:o[15]||(o[15]=s=>L(s)),onKeydown:[o[16]||(o[16]=ve(Q(s=>L(s),["prevent"]),["enter"])),o[17]||(o[17]=ve(Q(s=>L(s),["prevent"]),["space"]))]},[P(F,{name:"search"})],42,Xs),e("button",{class:ae(["control-button control-button--icon",{"control-button--active":S(a).ipSortKey!==S(K)}]),type:"button","aria-label":"排序方式",title:`排序：${O.value}`,onMouseenter:o[18]||(o[18]=s=>A(s)),onFocus:o[19]||(o[19]=s=>A(s)),onClick:o[20]||(o[20]=s=>A(s)),onKeydown:[o[21]||(o[21]=ve(Q(s=>A(s),["prevent"]),["enter"])),o[22]||(o[22]=ve(Q(s=>A(s),["prevent"]),["space"]))]},[P(F,{name:"sort"})],42,Zs),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新","aria-label":"刷新",disabled:S(a).loadingFullStats,onClick:o[23]||(o[23]=(...s)=>S(a).refreshFullStats&&S(a).refreshFullStats(...s))},[P(F,{name:"sync"})],8,eo),e("button",{class:"control-button control-button--icon",type:"button",title:"封禁管理","aria-label":"封禁管理",onClick:o[24]||(o[24]=s=>S(C).toggleBanManager(!0))},[P(F,{name:"gpp_maybe"})]),e("button",{class:"control-button control-button--icon",type:"button",title:"别名管理","aria-label":"别名管理",onClick:o[25]||(o[25]=s=>S(C).toggleAliasManager(!0))},[P(F,{name:"key"})]),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除当前 IP","aria-label":"删除当前 IP",disabled:!w.value,onClick:X},[P(F,{name:"delete"})],8,to)])])],512)):z("",!0),e("div",no,[(i(!0),d(ue,null,_e(f.value,s=>(i(),d("article",{key:s.ip,class:ae(["ip-item",{"ip-item--active":s.ip===w.value,"ip-item--unread":s.unread}]),onClick:v=>M(s.ip)},[e("div",oo,[e("div",lo,[e("span",ao,b(s.ip),1),s.summary.realIPs?.length?(i(),d("span",ro,[e("span",io,"真实 IP ×"+b(s.summary.realIPs.length),1),e("span",uo,[o[31]||(o[31]=e("strong",null,"真实 IP",-1)),e("ul",null,[(i(!0),d(ue,null,_e(s.summary.realIPs,v=>(i(),d("li",{key:v},b(v),1))),128))])])])):z("",!0)]),e("span",{class:"badge badge--ghost",title:ne(s)},b(J(s)),9,co)]),e("div",po,[e("dl",null,[o[32]||(o[32]=e("dt",null,"请求",-1)),e("dd",null,b(S(un)(s.summary.reqs)),1)]),e("dl",null,[o[33]||(o[33]=e("dt",null,"入流量",-1)),e("dd",null,b(S(ke)(s.summary.inTfc)),1)]),e("dl",null,[o[34]||(o[34]=e("dt",null,"出流量",-1)),e("dd",null,b(S(ke)(s.summary.outTfc)),1)])])],10,so))),128)),f.value.length?z("",!0):(i(),d("div",vo,[...o[35]||(o[35]=[e("p",null,"暂无 IP 数据",-1)])]))]),e("footer",fo,[e("button",{class:"control-button control-button--icon",disabled:S(a).ipPage<=1,"aria-label":"上一页",title:"上一页",onClick:o[26]||(o[26]=s=>S(a).ipPage--)},[P(F,{name:"chevron_left"})],8,mo),e("span",ho,"第 "+b(S(a).ipPage)+" 页 / 共 "+b(U.value)+" 页",1),e("button",{class:"control-button control-button--icon",disabled:S(a).ipPage>=U.value,"aria-label":"下一页",title:"下一页",onClick:o[27]||(o[27]=s=>S(a).ipPage++)},[P(F,{name:"chevron_right"})],8,go)])])],34))}}),_o=pe(yo,[["__scopeId","data-v-3a2bb42f"]]),bo={key:0,class:"panel-rail__meta"},ko=["title"],wo={key:1,class:"panel-rail__meta panel-rail__meta--empty"},To={class:"panel-rail__controls"},Co={class:"panel-rail__actions"},$o=["title","disabled"],So=["disabled"],Mo=["disabled"],Io={class:"panel-main"},Po={class:"panel-header__title"},xo={class:"panel-header__primary"},Ao={key:0,class:"panel-header__count"},Eo={key:0,class:"panel-header__hint"},Ro={key:1,class:"panel-header__hint"},qo={class:"panel-header__controls"},Lo={class:"panel-header__actions"},Do=["title","disabled"],Ho=["disabled"],Bo=["disabled"],Fo={class:"panel-content topic-list"},zo=["onClick"],Uo={class:"topic-item__header"},Wo={class:"topic-item__identity"},Oo={class:"topic-item__title-group"},No=["title"],Ko={key:0,class:"badge badge--ghost"},jo=["title"],Vo={class:"topic-item__stats"},Go={key:0,class:"empty-state"},Yo={class:"panel-footer"},Jo=["disabled"],Qo={class:"page-info"},Xo=["disabled"],Zo=ce({__name:"TopicListPanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(r,{expose:n,emit:l}){const u=r,y=l,a=De(),C=ye(),f=p(()=>a.selectedIp),w=p(()=>a.selectedTopic),U=p(()=>a.paginatedTopics),x=p(()=>Math.max(1,Math.ceil(a.currentIpTopics.length/a.topicPageSize))),m=p(()=>a.currentIpTopics.length),_=p(()=>a.topicFilter.trim().length>0),V=p(()=>{const o=f.value;return o?a.loadingTopics.get(o)===!0:!1}),K=Kt(),E=R(null),k=R(null),D=Ot(wt,null),h=Vt(),H=R(null),j=p(()=>u.collapsed===!0);fe(f,o=>{!o&&h.visible&&h.controlId==="topic-filter"&&h.cancel()}),D?.topicList&&(We(E,o=>{const s=o[0];if(!s)return;const v=Array.isArray(s.borderBoxSize)?s.borderBoxSize[0]:s.borderBoxSize,Z=v?v.inlineSize:s.contentRect.width;Z>0&&D.topicList.reportHeaderSize({width:Z,height:0})}),We(k,o=>{const s=o[0];if(!s)return;const v=Array.isArray(s.borderBoxSize)?s.borderBoxSize[0]:s.borderBoxSize,Z=v?v.blockSize:s.contentRect.height;Z>0&&D.topicList.reportHeaderSize({width:0,height:Z})}));function ee(o){a.setSelectedTopic(o)}function O(){y("request-focus")}function M(o,s){const v=o?.currentTarget;return v instanceof HTMLElement?v:s}function I(o){if(!f.value)return;const s=M(o,H.value);if(!s)return;if(h.visible&&h.controlId==="topic-filter")if(h.closing)h.finalize();else{h.refreshAnchorRect();return}const v=a.topicFilter;h.open({controlId:"topic-filter",anchorEl:s,variant:"filter",label:"过滤话题",icon:"search",value:v,expandedWidth:280,onInput(Z){a.topicFilter=Z},onCommit(Z){a.topicFilter=Z.trim()},onCancel(){a.topicFilter=v}})}function T(o){return K.value,Nt(o)}function L(o){const s=o.title;return typeof s=="string"&&s.trim().length>0?s.trim():null}function A(o){return L(o)??o.tid}function J(o){const s=L(o);return s?`${s} (ID: ${o.tid})`:o.tid}function ne(o){const s=f.value;return s?a.isTopicUnread(s,o.tid):!1}async function X(){f.value&&await a.ensureTopics(f.value,!0)}async function se(){if(!(!f.value||!w.value||!await C.confirm({title:"删除话题",message:`确定永久删除话题 “${w.value}” 吗？该操作不可恢复。`,confirmLabel:"删除",destructive:!0})))try{await a.removeTopics(f.value,[w.value]),C.pushToast({type:"success",title:"删除成功",message:"话题已删除。"})}catch(s){C.pushToast({type:"error",title:"删除失败",message:s instanceof Error?s.message:String(s)})}}function q(){h.visible&&h.controlId==="topic-filter"&&h.requestClose()}return n({resetToCollapsedState:q}),(o,s)=>(i(),d("section",{class:ae(["panel panel--topic",{"panel--collapsed":j.value}]),onMouseenter:O,onFocusin:O,onPointerdownCapture:O},[r.stackDirection==="right"?(i(),d("aside",{key:0,ref_key:"desktopRailEl",ref:E,class:"panel-rail panel-rail--desktop"},[s[14]||(s[14]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"话题列表",-1)),f.value?(i(),d("div",bo,[e("strong",null,b(m.value),1),s[12]||(s[12]=e("span",null,"话题",-1)),e("div",{class:"panel-rail__hint",title:f.value},"IP "+b(f.value),9,ko)])):(i(),d("div",wo,[...s[13]||(s[13]=[e("span",null,"等待",-1),e("span",null,"选择 IP",-1)])])),e("div",To,[e("div",Co,[e("button",{ref_key:"filterTriggerEl",ref:H,class:ae(["control-button control-button--icon",{"control-button--active":_.value}]),type:"button","aria-label":"过滤话题",title:_.value?`过滤：${S(a).topicFilter}`:"过滤话题",disabled:!f.value,onMouseenter:s[0]||(s[0]=v=>I(v)),onFocus:s[1]||(s[1]=v=>I(v)),onClick:s[2]||(s[2]=v=>I(v)),onKeydown:[s[3]||(s[3]=ve(Q(v=>I(v),["prevent"]),["enter"])),s[4]||(s[4]=ve(Q(v=>I(v),["prevent"]),["space"]))]},[P(F,{name:"search"})],42,$o),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新话题","aria-label":"刷新话题",disabled:!f.value||V.value,onClick:X},[P(F,{name:"sync"})],8,So),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除话题","aria-label":"删除话题",disabled:!w.value,onClick:se},[P(F,{name:"delete"})],8,Mo)])])],512)):z("",!0),e("div",Io,[r.stackDirection==="down"?(i(),d("header",{key:0,ref_key:"mobileHeaderEl",ref:k,class:"panel-header panel-header--mobile"},[e("div",Po,[e("div",xo,[s[15]||(s[15]=e("h2",null,"话题列表",-1)),f.value?(i(),d("span",Ao,b(m.value),1)):z("",!0)]),f.value?(i(),d("p",Eo,b(m.value)+" 个话题 · IP "+b(f.value),1)):(i(),d("p",Ro,"等待选择 IP"))]),e("div",qo,[e("div",Lo,[e("button",{class:ae(["control-button control-button--icon",{"control-button--active":_.value}]),type:"button","aria-label":"过滤话题",title:_.value?`过滤：${S(a).topicFilter}`:"过滤话题",disabled:!f.value,onMouseenter:s[5]||(s[5]=v=>I(v)),onFocus:s[6]||(s[6]=v=>I(v)),onClick:s[7]||(s[7]=v=>I(v)),onKeydown:[s[8]||(s[8]=ve(Q(v=>I(v),["prevent"]),["enter"])),s[9]||(s[9]=ve(Q(v=>I(v),["prevent"]),["space"]))]},[P(F,{name:"search"})],42,Do),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新话题","aria-label":"刷新话题",disabled:!f.value||V.value,onClick:X},[P(F,{name:"sync"})],8,Ho),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除话题","aria-label":"删除话题",disabled:!w.value,onClick:se},[P(F,{name:"delete"})],8,Bo)])])],512)):z("",!0),e("div",Fo,[(i(!0),d(ue,null,_e(U.value,v=>(i(),d("article",{key:v.tid,class:ae(["topic-item",{"topic-item--active":v.tid===w.value,"topic-item--unread":ne(v)}]),onClick:Z=>ee(v.tid)},[e("header",Uo,[e("div",Wo,[e("div",Oo,[e("span",{class:"topic-item__title",title:J(v)},b(A(v)),9,No)]),v.status?(i(),d("span",Ko,b(v.status),1)):z("",!0)]),e("span",{class:"badge badge--ghost",title:S(Ie)(v.upAt)},b(T(v.upAt)),9,jo)]),e("div",Vo,[e("dl",null,[s[16]||(s[16]=e("dt",null,"消息",-1)),e("dd",null,b(v.msgCnt),1)]),e("dl",null,[s[17]||(s[17]=e("dt",null,"入流量",-1)),e("dd",null,b(S(ke)(v.inBytes)),1)]),e("dl",null,[s[18]||(s[18]=e("dt",null,"出流量",-1)),e("dd",null,b(S(ke)(v.outBytes)),1)]),e("dl",null,[s[19]||(s[19]=e("dt",null,"创建",-1)),e("dd",null,b(S(Ie)(v.ctAt)),1)])])],10,zo))),128)),U.value.length?z("",!0):(i(),d("div",Go,[...s[20]||(s[20]=[e("p",null,"请选择左侧 IP 以查看话题。",-1)])]))]),e("footer",Yo,[e("button",{class:"control-button control-button--icon",type:"button",title:"上一页","aria-label":"上一页",disabled:S(a).topicPage<=1,onClick:s[10]||(s[10]=v=>S(a).topicPage--)},[P(F,{name:"chevron_left"})],8,Jo),e("span",Qo,"第 "+b(S(a).topicPage)+" 页 / 共 "+b(x.value)+" 页",1),e("button",{class:"control-button control-button--icon",type:"button",title:"下一页","aria-label":"下一页",disabled:S(a).topicPage>=x.value,onClick:s[11]||(s[11]=v=>S(a).topicPage++)},[P(F,{name:"chevron_right"})],8,Xo)])])],34))}}),el=pe(Zo,[["__scopeId","data-v-0fd30b99"]]),tl={class:"message-card__header"},nl={class:"message-card__meta"},sl={class:"badge badge--role"},ol=["title"],ll={key:0,class:"badge badge--ghost",title:"Tokens"},al={key:0,class:"message-card__request-info"},rl={class:"request-info__label"},il={class:"request-info__content"},ul=["data-open"],cl={key:0,class:"request-body__loading"},dl={key:1,class:"request-body__error"},pl={key:3,class:"request-body__empty"},vl=["data-open"],fl={key:0,class:"request-body__loading"},ml={key:1,class:"request-body__error"},hl={key:3,class:"request-body__empty"},gl={key:0,class:"message-card__model-meta"},yl={key:0,class:"meta-item"},_l={class:"meta-value"},bl={key:1,class:"meta-item"},kl={class:"meta-value"},wl={key:2,class:"meta-item"},Tl={class:"meta-value"},Cl={key:3,class:"meta-item"},$l={class:"token-details"},Sl={key:0},Ml={key:1},Il={key:2},Pl={key:3},xl={key:4,class:"token-breakdown"},Al={class:"token-breakdown__list"},El={class:"token-breakdown__item-label"},Rl={class:"token-breakdown__item-value"},ql={key:4,class:"meta-item"},Ll={class:"meta-value"},Dl={key:1,class:"message-card__model-error"},Hl={class:"model-error__header"},Bl={key:0,class:"model-error__summary"},Fl=["data-open"],zl={key:0,class:"loading-dot loading-dot--inline"},Ul=["data-loading"],Wl={key:0,class:"model-json__loading"},Ol={key:1,class:"model-json__error"},Nl={key:3,class:"model-json__empty"},Kl={key:4,class:"model-json__placeholder"},jl=ce({__name:"MessageCard",props:{message:{},rootEl:{}},setup(r){const n=r,l=De(),u=ye();R(!1);const y=R(!1),a=R(!1),C=R(null),f=R(null),w=R(!1),U=R(!1),x=R(null),m=ie({loading:!1,loaded:!1,error:null,data:null,raw:null}),_=ie({loading:!1,loaded:!1,error:null,data:null,raw:null}),V=p(()=>l.getMessageDetail(n.message.id)),K=p(()=>V.value?.meta?.tokens?.totTokCnt??n.message.meta?.tokens?.totTokCnt??null),E=p(()=>l.getMessageRequestBody(n.message.id)),k=p(()=>l.getMessageRequestHeaders(n.message.id)),D=p(()=>V.value?.reqUrl??n.message.reqUrl??E.value?.requestUrl??k.value?.requestUrl??x.value??null),h=p(()=>V.value?.hasReqBody??n.message.hasReqBody??!1),H=p(()=>V.value?.hasReqHeaders??n.message.hasReqHeaders??!1),j=p(()=>{if(m.loaded)return m.data??m.raw??null;const g=E.value;return g?g.requestBody??g.rawRequestBody??null:null}),ee=p(()=>_.loaded?_.data:k.value?.requestHeaders??null),O=p(()=>_.loaded?_.raw:k.value?.rawRequestHeaders??null),M=p(()=>ee.value??O.value),I=p(()=>{const g=ee.value;return g?Object.keys(g).length:null}),T=p(()=>_.loading||_.error||H.value?!0:He(M.value)),L=p(()=>m.loading||m.error||h.value?!0:He(j.value)),A=p(()=>m.loading),J=p(()=>m.error),ne=p(()=>_.loading),X=p(()=>_.error),se=p(()=>He(j.value)),q=p(()=>He(M.value)),o=p(()=>se.value?Be(j.value):""),s=p(()=>q.value?Be(M.value):""),v=p(()=>{if(n.message.role!=="model")return null;const g=V.value?.meta??n.message.meta;if(!g)return null;const t=g.tokens??null,c=(oe,ot)=>{if(!oe||typeof oe!="object")return null;for(const ht of ot){const Je=oe[ht];if(Je==null)continue;const lt=Number(Je);if(Number.isFinite(lt))return lt;if(typeof Je=="number")return Je}return null},$=c(t,["promptTokenCount","pTokCnt","promptTokensCount"]),W=c(t,["candidatesTokenCount","candTokCnt"]),te=c(t,["thoughtsTokenCount","thgtTokCnt","thinkingTokenCount"]),N=c(t,["totalTokenCount","totTokCnt","totalTokensCount"]),Fe=t?.promptTokensDetails??t?.promptTokenDetails??t?.prompt_tokens_details??null,ze=Array.isArray(Fe)?Fe.map(oe=>{if(!oe||typeof oe!="object")return null;const ot=oe.modality??oe.type??oe.modalityType??oe.name,ht=typeof ot=="string"&&ot.trim().length?ot.trim():null,lt=(()=>{for(const at of["tokenCount","tokens","count","value","tokenCounts"]){if(oe[at]===void 0||oe[at]===null)continue;const Gt=Number(oe[at]);if(Number.isFinite(Gt))return Gt;if(typeof oe[at]=="number")return oe[at]}return null})();return!ht&&lt===null?null:{label:ht??"Prompt",tokenCount:lt}}).filter(oe=>!!oe):null,Ge={promptTokenCount:$,candidatesTokenCount:W,thoughtsTokenCount:te,totalTokenCount:N,promptTokensDetails:ze&&ze.length?ze:null},Se=[$,W,te,N].some(oe=>oe!=null)||!!(Ge.promptTokensDetails&&Ge.promptTokensDetails.length),st=g.finishReason??t?.finishReason??null,ge=g.status;let Ue=null;if(typeof ge=="number"&&Number.isFinite(ge))Ue=ge;else if(typeof ge=="string"){const oe=Number(ge);Ue=Number.isFinite(oe)?oe:ge}else ge!=null&&(Ue=ge);const Me=typeof g.statusText=="string"&&g.statusText.trim().length?g.statusText:null,re=g.modelName??g.modelVer??g.model??null,Ye=g.errCode;let Lt=null;typeof Ye=="string"||typeof Ye=="number"?Lt=Ye:Ye!=null&&(Lt=String(Ye));const mn=!!(g.hasErrDetails??g.hasErrorDetails??g.hasErrDetail??!1);return{status:Ue,statusText:Me,modelName:re,tokens:Se?Ge:null,finishReason:st??null,errMsg:typeof g.errMsg=="string"?g.errMsg:null,errStatus:typeof g.errStatus=="string"?g.errStatus:null,errCode:Lt,hasErrorDetails:mn}}),Z=p(()=>v.value?.status??null),B=p(()=>{const g=Z.value,t=Number(g);return Number.isFinite(t)?t:null}),G=p(()=>{const g=Z.value,t=v.value?.statusText?.trim()??"",c=g!=null?String(g):"";return c&&t?c.toLowerCase()===t.toLowerCase()?c:`${c} ${t}`:c||t||null}),me=p(()=>!!v.value?.hasErrorDetails),Te=p(()=>{const g=v.value;if(!g)return!1;const t=B.value;return!!(t!==null&&t>=400||typeof g.errStatus=="string"&&g.errStatus.trim().length||typeof g.errMsg=="string"&&g.errMsg.trim().length||(g.finishReason??"").toString().toLowerCase()==="error")}),he=p(()=>{if(Te.value)return"badge--error";const g=B.value;return g==null?"badge--ghost":g>=200&&g<300?"badge--success":"badge--ghost"}),be=p(()=>{const g=v.value;if(!g)return null;const t=[];return g.errStatus&&t.push(g.errStatus),g.errCode!==null&&g.errCode!==void 0&&`${g.errCode}`.length&&t.push(`code ${g.errCode}`),g.errMsg&&t.push(g.errMsg),t.length?t.join(" · "):null}),Ce=p(()=>l.getModelErrorDetails(n.message.id)),Y=ie({loading:!1,loaded:!1,error:null,data:null,hasError:!1}),Pe=R(!1),xe=p(()=>{if(Y.loaded)return{hasError:Y.hasError,error:Y.data??null};const g=Ce.value;return g?{hasError:g.hasError??!1,error:g.error??null}:null}),Ae=p(()=>Y.loading),Ke=p(()=>Y.error),Ee=p(()=>Y.loaded||!!Ce.value),$e=p(()=>{const g=xe.value;return!g||!g.hasError?!1:He(g.error??null)}),Re=p(()=>$e.value?Be(xe.value?.error??null):""),qe=p(()=>v.value?.tokens?.promptTokensDetails??null);function je(){Y.loading=!1,Y.loaded=!1,Y.error=null,Y.data=null,Y.hasError=!1,Pe.value=!1}async function dt(g=!1){if(me.value&&!Y.loading){if(!g){const t=Ce.value;if(t){Y.data=t.error??null,Y.hasError=t.hasError??!1,Y.loaded=!0,Y.error=null;return}if(Y.loaded)return}Y.loading=!0,Y.error=null;try{const t=await l.loadModelErrorDetails(n.message.id,g);t?(Y.data=t.error??null,Y.hasError=t.hasError??!1,Y.loaded=!0):(Y.data=null,Y.hasError=!1,Y.loaded=!0)}catch(t){const c=t instanceof Error?t.message:String(t);Y.error=c,Y.loaded=!1,u.pushToast({type:"error",title:"错误详情加载失败",message:c})}finally{Y.loading=!1}}}function Tt(g){const c=g.currentTarget?.open??!1;Pe.value=c,c&&dt()}function Ct(){dt(!0)}function $t(){!$e.value||!Re.value||Ve(Re.value)}const St=p(()=>n.message.role==="user"?"用户":n.message.role==="model"?"模型":n.message.role==="system"?"系统":n.message.role),Mt=p(()=>({"message-card--user":n.message.role==="user","message-card--model":n.message.role==="model","message-card--state-error":n.message.role==="model"&&Te.value}));jt(()=>n.message.ctAt??n.message.meta?.ctAt??null),p(()=>Ie(n.message.ctAt??n.message.meta?.ctAt??Date.now()));const It=p(()=>n.message.id.slice(0,8));p(()=>{const g=n.rootEl;return g?S(g)??void 0:void 0}),fe(()=>n.message.id,()=>{a.value=!1,y.value=!1,pt(),ft(),je()}),fe(me,g=>{g||je()});function He(g){return g==null?!1:Array.isArray(g)?g.length>0:typeof g=="object"?Object.keys(g).length>0:typeof g=="string"?g.trim().length>0:!0}function Be(g){try{return typeof g=="string"?g:JSON.stringify(g,null,2)}catch{return String(g)}}async function Ve(g){try{await navigator.clipboard.writeText(g),u.pushToast({type:"success",title:"已复制到剪贴板"})}catch(t){u.pushToast({type:"error",title:"复制失败",message:t instanceof Error?t.message:String(t)})}}function pt(){w.value=!1,m.loading=!1,m.loaded=!1,m.error=null,m.data=null,m.raw=null,x.value=null}async function vt(g=!1){if(!m.loading){if(!g){const t=E.value;if(t){m.data=t.requestBody??null,m.raw=t.rawRequestBody??null,m.loaded=!0,m.error=null,x.value=t.requestUrl??x.value;return}if(m.loaded||!h.value)return}m.loading=!0,m.error=null;try{const t=await l.loadMessageRequestBody(n.message.id,g);t?(m.data=t.requestBody??null,m.raw=t.rawRequestBody??null,x.value=t.requestUrl??x.value):(m.data=null,m.raw=null),m.loaded=!0}catch(t){const c=t instanceof Error?t.message:String(t);m.error=c,u.pushToast({type:"error",title:"请求体加载失败",message:c}),m.loaded=!1,m.data=null,m.raw=null}finally{m.loading=!1}}}function ft(){U.value=!1,_.loading=!1,_.loaded=!1,_.error=null,_.data=null,_.raw=null}async function mt(g=!1){if(!_.loading){if(!g){const t=k.value;if(t){_.data=t.requestHeaders??null,_.raw=t.rawRequestHeaders??null,_.loaded=!0,_.error=null,x.value=t.requestUrl??x.value;return}if(_.loaded||!H.value)return}_.loading=!0,_.error=null;try{const t=await l.loadMessageRequestHeaders(n.message.id,g);t?(_.data=t.requestHeaders??null,_.raw=t.rawRequestHeaders??null,x.value=t.requestUrl??x.value):(_.data=null,_.raw=null),_.loaded=!0}catch(t){const c=t instanceof Error?t.message:String(t);_.error=c,u.pushToast({type:"error",title:"请求头加载失败",message:c}),_.loaded=!1,_.data=null,_.raw=null}finally{_.loading=!1}}}function Pt(g){const c=g.currentTarget?.open??!1;w.value=c,c&&vt()}function xt(){vt(!0)}function At(){se.value&&Ve(o.value)}function Et(g){const c=g.currentTarget?.open??!1;U.value=c,c&&mt()}function Rt(){mt(!0)}function qt(){q.value&&Ve(s.value)}return(g,t)=>(i(),d("article",{ref_key:"cardEl",ref:C,class:ae(["message-card",Mt.value])},[e("header",tl,[e("div",nl,[e("span",sl,b(St.value),1),e("span",{class:"badge badge--id",title:r.message.id},b(It.value),9,ol),K.value?(i(),d("span",ll,b(K.value)+" tokens ",1)):z("",!0),G.value?(i(),d("span",{key:1,class:ae(["badge",he.value])},b(G.value),3)):z("",!0)])]),r.message.role==="user"?(i(),d(ue,{key:0},[D.value?(i(),d("section",al,[e("header",rl,[P(F,{name:"link"}),t[0]||(t[0]=le(" 请求 URL ",-1))]),e("div",il,[e("code",null,b(D.value),1)])])):z("",!0),T.value?(i(),d("details",{key:1,class:"message-card__request-section",onToggle:Et},[e("summary",null,[P(F,{name:"http"}),e("span",null,[t[1]||(t[1]=le(" 请求头部 ",-1)),I.value!==null?(i(),d(ue,{key:0},[le(" ("+b(I.value)+")",1)],64)):z("",!0)])]),e("div",{class:"request-section__content","data-open":U.value},[ne.value?(i(),d("div",cl,[...t[2]||(t[2]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载请求头…",-1)])])):X.value?(i(),d("div",dl,[P(F,{name:"error"}),e("span",null,b(X.value),1),e("button",{class:"ghost-button",onClick:Q(Rt,["stop"])},[P(F,{name:"refresh"}),t[3]||(t[3]=le(" 重试加载 ",-1))])])):q.value?(i(),d(ue,{key:2},[e("pre",null,[e("code",null,b(s.value),1)]),e("button",{class:"ghost-button",onClick:qt},[P(F,{name:"content_copy"}),t[4]||(t[4]=le(" 复制 ",-1))])],64)):(i(),d("div",pl,[...t[5]||(t[5]=[e("span",null,"没有可显示的请求头内容。",-1)])]))],8,ul)],32)):z("",!0),L.value?(i(),d("details",{key:2,ref_key:"requestBodyDetailsEl",ref:f,class:"message-card__request-section message-card__request-section--body",onToggle:Pt},[e("summary",null,[P(F,{name:"data_object"}),t[6]||(t[6]=e("span",null,"请求 Body",-1))]),e("div",{class:"request-section__content","data-open":w.value},[A.value?(i(),d("div",fl,[...t[7]||(t[7]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载请求体…",-1)])])):J.value?(i(),d("div",ml,[P(F,{name:"error"}),e("span",null,b(J.value),1),e("button",{class:"ghost-button",onClick:Q(xt,["stop"])},[P(F,{name:"refresh"}),t[8]||(t[8]=le(" 重试加载 ",-1))])])):se.value?(i(),d(ue,{key:2},[e("pre",null,[e("code",null,b(o.value),1)]),e("button",{class:"ghost-button",onClick:At},[P(F,{name:"content_copy"}),t[9]||(t[9]=le(" 复制 ",-1))])],64)):(i(),d("div",hl,[...t[10]||(t[10]=[e("span",null,"没有可显示的请求体内容。",-1)])]))],8,vl)],544)):z("",!0)],64)):z("",!0),r.message.role==="model"?(i(),d(ue,{key:1},[v.value?(i(),d("section",gl,[v.value.modelName?(i(),d("div",yl,[P(F,{name:"smart_toy"}),t[11]||(t[11]=e("span",{class:"meta-label"},"模型:",-1)),e("span",_l,b(v.value.modelName),1)])):z("",!0),v.value.status!==null&&v.value.status!==void 0?(i(),d("div",bl,[P(F,{name:"info"}),t[12]||(t[12]=e("span",{class:"meta-label"},"状态码:",-1)),e("span",kl,b(v.value.status),1)])):z("",!0),v.value.statusText?(i(),d("div",wl,[P(F,{name:"description"}),t[13]||(t[13]=e("span",{class:"meta-label"},"状态说明:",-1)),e("span",Tl,b(v.value.statusText),1)])):z("",!0),v.value.tokens?(i(),d("div",Cl,[P(F,{name:"bar_chart"}),t[15]||(t[15]=e("span",{class:"meta-label"},"Token统计:",-1)),e("div",$l,[v.value.tokens.promptTokenCount!==null&&v.value.tokens.promptTokenCount!==void 0?(i(),d("span",Sl,"Prompt: "+b(v.value.tokens.promptTokenCount),1)):z("",!0),v.value.tokens.candidatesTokenCount!==null&&v.value.tokens.candidatesTokenCount!==void 0?(i(),d("span",Ml,"Response: "+b(v.value.tokens.candidatesTokenCount),1)):z("",!0),v.value.tokens.thoughtsTokenCount!==null&&v.value.tokens.thoughtsTokenCount!==void 0?(i(),d("span",Il,"Thinking: "+b(v.value.tokens.thoughtsTokenCount),1)):z("",!0),v.value.tokens.totalTokenCount!==null&&v.value.tokens.totalTokenCount!==void 0?(i(),d("span",Pl,"Total: "+b(v.value.tokens.totalTokenCount),1)):z("",!0),qe.value&&qe.value.length?(i(),d("div",xl,[t[14]||(t[14]=e("span",{class:"token-breakdown__label"},"Prompt 详情:",-1)),e("ul",Al,[(i(!0),d(ue,null,_e(qe.value,(c,$)=>(i(),d("li",{key:$,class:"token-breakdown__item"},[e("span",El,b(c.label),1),e("span",Rl,b(c.tokenCount??"—"),1)]))),128))])])):z("",!0)])])):z("",!0),v.value.finishReason?(i(),d("div",ql,[P(F,{name:"flag"}),t[16]||(t[16]=e("span",{class:"meta-label"},"结束原因:",-1)),e("span",Ll,b(v.value.finishReason),1)])):z("",!0)])):z("",!0),be.value||me.value?(i(),d("section",Dl,[e("header",Hl,[P(F,{name:"error"}),t[17]||(t[17]=e("span",{class:"model-section__title"},"错误信息",-1))]),be.value?(i(),d("p",Bl,b(be.value),1)):z("",!0),me.value?(i(),d("details",{key:1,class:"message-card__model-json","data-tone":"error","data-open":Pe.value,onToggle:Tt},[e("summary",null,[P(F,{name:"bug_report"}),t[18]||(t[18]=e("span",null,"错误详情",-1)),Ae.value?(i(),d("span",zl)):z("",!0)]),e("div",{class:"model-json-body","data-loading":Ae.value},[Ae.value?(i(),d("div",Wl,[...t[19]||(t[19]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载错误详情…",-1)])])):Ke.value?(i(),d("div",Ol,[P(F,{name:"error"}),e("span",null,b(Ke.value),1),e("button",{class:"ghost-button ghost-button--alert",type:"button",onClick:Q(Ct,["stop"])},[P(F,{name:"refresh"}),t[20]||(t[20]=le(" 重试加载 ",-1))])])):$e.value?(i(),d(ue,{key:2},[e("pre",null,[e("code",null,b(Re.value),1)]),e("button",{class:"ghost-button ghost-button--alert",type:"button",onClick:Q($t,["stop"])},[P(F,{name:"content_copy"}),t[21]||(t[21]=le(" 复制 ",-1))])],64)):Ee.value?(i(),d("div",Nl,[...t[22]||(t[22]=[e("span",null,"暂无可显示的错误详情。",-1)])])):(i(),d("div",Kl,[...t[23]||(t[23]=[e("span",null,"展开以加载错误详情。",-1)])]))],8,Ul)],40,Fl)):z("",!0)])):z("",!0)],64)):z("",!0)],2))}}),Vl=pe(jl,[["__scopeId","data-v-5c9615c2"]]),Gl={key:0,class:"panel-rail__meta"},Yl=["title"],Jl=["title"],Ql=["title"],Xl={key:1,class:"panel-rail__meta panel-rail__meta--empty"},Zl={key:2,class:"panel-rail__stats"},ea={class:"badge badge--ghost"},ta={class:"badge badge--ghost"},na=["title"],sa={class:"panel-rail__controls"},oa={class:"panel-rail__actions"},la=["disabled"],aa={class:"panel-main"},ra={class:"panel-header__title"},ia={class:"panel-header__primary"},ua={key:0,class:"panel-header__count"},ca={key:0,class:"panel-header__hint"},da=["title"],pa={key:1,class:"panel-header__hint"},va={class:"panel-header__controls"},fa={key:0,class:"panel-header__meta"},ma={class:"badge badge--ghost"},ha={class:"badge badge--ghost"},ga=["title"],ya={class:"panel-header__actions"},_a=["disabled"],ba={key:0,class:"topic-hash-card"},ka={class:"topic-hash-card__header"},wa={class:"topic-hash-card__title"},Ta={class:"topic-hash-card__content"},Ca={key:0,class:"hash-item"},$a=["title"],Sa={key:1,class:"hash-item"},Ma=["title"],Ia={key:1,class:"empty-state"},Pa={key:2,class:"panel-content empty-state"},xa=ce({__name:"MessagePanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(r,{expose:n,emit:l}){const u=r,y=l,a=p(()=>{if(u.stackDirection==="right"&&typeof u.mainSpan=="number"&&u.mainSpan>=0)return{width:`${Math.max(u.mainSpan,0)}px`}}),C=De();ye();const f=p(()=>C.selectedIp),w=p(()=>C.selectedTopic),U=p(()=>C.currentTopicMessages),x=R(null),m=R(null),_=R(null),V=Ot(wt,null),K=p(()=>u.collapsed===!0);V?.messageList&&(We(m,L=>{const A=L[0];if(!A)return;const J=Array.isArray(A.borderBoxSize)?A.borderBoxSize[0]:A.borderBoxSize,ne=J?J.inlineSize:A.contentRect.width;ne>0&&V.messageList.reportHeaderSize({width:ne,height:0})}),We(_,L=>{const A=L[0];if(!A)return;const J=Array.isArray(A.borderBoxSize)?A.borderBoxSize[0]:A.borderBoxSize,ne=J?J.blockSize:A.contentRect.height;ne>0&&V.messageList.reportHeaderSize({width:0,height:ne})}));const E=p(()=>w.value?C.currentIpTopics.find(A=>A.tid===w.value)??null:null),k=p(()=>{const L=E.value?.title;return typeof L=="string"&&L.trim().length>0?L.trim():null}),D=p(()=>({hashNoReason:C.currentTopicMeta?.topicHashNoReason??null,hashWithReason:C.currentTopicMeta?.topicHashWithReason??null})),h=p(()=>{const L=D.value;return L.hashNoReason||L.hashWithReason?{title:"话题哈希",hashNoReason:L.hashNoReason,hashWithReason:L.hashWithReason,messageId:null}:null}),H=p(()=>U.value),j=p(()=>{const L=f.value,A=w.value;return!L||!A?!1:C.loadingMessages.get(`${L}:${A}`)===!0}),ee=jt(()=>E.value?.upAt??null);function O(L){return L?L.length>16?`${L.slice(0,8)}...${L.slice(-8)}`:L:""}async function M(){!f.value||!w.value||await C.ensureMessages(f.value,w.value,!0)}function I(){y("request-focus")}function T(){}return n({resetToCollapsedState:T}),(L,A)=>(i(),d("section",{class:ae(["panel panel--message",{"panel--collapsed":K.value}]),style:bt(a.value),onMouseenter:I,onFocusin:I,onPointerdownCapture:I},[r.stackDirection==="right"?(i(),d("aside",{key:0,ref_key:"desktopRailEl",ref:m,class:"panel-rail panel-rail--desktop"},[A[2]||(A[2]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"消息详情",-1)),w.value?(i(),d("div",Gl,[e("strong",null,b(E.value?.msgCnt??H.value.length),1),A[0]||(A[0]=e("span",null,"消息",-1)),k.value?(i(),d("div",{key:0,class:"panel-rail__hint",title:k.value}," 标题 "+b(k.value),9,Yl)):z("",!0),e("div",{class:"panel-rail__hint",title:w.value},"话题 "+b(w.value),9,Jl),f.value?(i(),d("div",{key:1,class:"panel-rail__hint",title:f.value},"IP "+b(f.value),9,Ql)):z("",!0)])):(i(),d("div",Xl,[...A[1]||(A[1]=[e("span",null,"等待",-1),e("span",null,"选择话题",-1)])])),E.value?(i(),d("div",Zl,[e("span",ea,"入 "+b(S(ke)(E.value.inBytes)),1),e("span",ta,"出 "+b(S(ke)(E.value.outBytes)),1),e("span",{class:"badge badge--ghost",title:S(Ie)(E.value.upAt)}," 更新 "+b(S(ee)),9,na)])):z("",!0),e("div",sa,[e("div",oa,[e("button",{class:"control-button control-button--icon",type:"button",title:"刷新消息","aria-label":"刷新消息",disabled:!w.value||j.value,onClick:M},[P(F,{name:"sync"})],8,la)])])],512)):z("",!0),e("div",aa,[r.stackDirection==="down"?(i(),d("header",{key:0,ref_key:"mobileHeaderEl",ref:_,class:"panel-header panel-header--mobile"},[e("div",ra,[e("div",ia,[A[3]||(A[3]=e("h2",null,"消息详情",-1)),w.value?(i(),d("span",ua,b(E.value?.msgCnt??H.value.length),1)):z("",!0)]),w.value?(i(),d("p",ca,[k.value?(i(),d("span",{key:0,class:"topic-header__title",title:k.value},b(k.value),9,da)):z("",!0),e("span",null,"话题 "+b(w.value),1),A[4]||(A[4]=le(" · ",-1)),e("span",null,"IP "+b(f.value??"—"),1)])):(i(),d("p",pa,"等待选择话题"))]),e("div",va,[E.value?(i(),d("div",fa,[e("span",ma,"入 "+b(S(ke)(E.value.inBytes)),1),e("span",ha,"出 "+b(S(ke)(E.value.outBytes)),1),e("span",{class:"badge badge--ghost",title:S(Ie)(E.value.upAt)},"更新 "+b(S(ee)),9,ga)])):z("",!0),e("div",ya,[e("button",{class:"control-button control-button--icon",type:"button",title:"刷新消息","aria-label":"刷新消息",disabled:!w.value||j.value,onClick:M},[P(F,{name:"sync"})],8,_a)])])],512)):z("",!0),w.value?(i(),d("div",{key:1,ref_key:"listEl",ref:x,class:"panel-content message-list"},[h.value?(i(),d("article",ba,[e("header",ka,[e("div",wa,[P(F,{name:"tag"}),e("span",null,b(h.value.title),1)])]),e("div",Ta,[h.value.hashNoReason?(i(),d("div",Ca,[A[5]||(A[5]=e("span",{class:"hash-label"},"无推理:",-1)),e("code",{class:"hash-value",title:h.value.hashNoReason},b(O(h.value.hashNoReason)),9,$a)])):z("",!0),h.value.hashWithReason?(i(),d("div",Sa,[A[6]||(A[6]=e("span",{class:"hash-label"},"含推理:",-1)),e("code",{class:"hash-value",title:h.value.hashWithReason},b(O(h.value.hashWithReason)),9,Ma)])):z("",!0)])])):z("",!0),(i(!0),d(ue,null,_e(H.value,J=>(i(),we(Vl,{key:J.id,message:J,"root-el":x.value},null,8,["message","root-el"]))),128)),H.value.length?z("",!0):(i(),d("div",Ia,[...A[7]||(A[7]=[e("p",null,"暂无消息。",-1)])]))],512)):(i(),d("div",Pa,[...A[8]||(A[8]=[e("p",null,"请选择话题查看消息详情。",-1)])]))])],38))}}),Aa=pe(xa,[["__scopeId","data-v-9a56742c"]]),Ea={class:"toast-container"},Ra={class:"toast__icon"},qa={class:"toast__body"},La={key:0},Da=["onClick"],Ha=ce({__name:"ToastContainer",setup(r){const n=ye();function l(u){switch(u){case"success":return"check_circle";case"error":return"error";case"warning":return"warning";default:return"info"}}return(u,y)=>(i(),d("div",Ea,[P(kn,{name:"toast",tag:"div"},{default:Oe(()=>[(i(!0),d(ue,null,_e(S(n).toasts,a=>(i(),d("div",{key:a.id,class:ae(["toast",a.type])},[e("div",Ra,[P(F,{name:l(a.type)},null,8,["name"])]),e("div",qa,[e("strong",null,b(a.title),1),a.message?(i(),d("p",La,b(a.message),1)):z("",!0)]),e("button",{class:"toast__close",onClick:C=>S(n).dismissToast(a.id)},[P(F,{name:"close"})],8,Da)],2))),128))]),_:1})]))}}),Ba=pe(Ha,[["__scopeId","data-v-e4c6c4f4"]]);function nt(r){if(typeof window>"u")return{onBackdropPointerDown:()=>{},onBackdropPointerUp:()=>{}};let n=!1,l=null;const u=()=>{n=!1,l=null,window.removeEventListener("pointerup",y,!0),window.removeEventListener("pointercancel",a,!0)},y=w=>{n&&l===w.pointerId&&r(),u()},a=()=>{u()},C=w=>{w.button===0&&(n=!0,l=w.pointerId,window.addEventListener("pointerup",y,!0),window.addEventListener("pointercancel",a,!0))},f=w=>{if(w.button!==0){u();return}if(!n||l!==w.pointerId){u();return}r(),u()};return wn()&&Wt(()=>{u()}),{onBackdropPointerDown:C,onBackdropPointerUp:f}}const Fa={class:"modal"},za={class:"actions"},Ua=ce({__name:"PreviewModal",setup(r){const n=ye(),l=n.preview,y=ce({name:"PlainRenderer",props:{source:{type:String,required:!0}},setup(x){return()=>Tn("pre",{class:"plain"},x.source)}}),a=R(null),{onBackdropPointerDown:C,onBackdropPointerUp:f}=nt(w);fe(()=>!l.open||!l.payload?.downloadableName?null:{content:l.payload.content,mimeType:l.payload.mimeType},(x,m,_)=>{if(a.value&&(URL.revokeObjectURL(a.value),a.value=null),x){const V=new Blob([x.content],{type:x.mimeType??"text/plain"}),K=URL.createObjectURL(V);a.value=K,_(()=>{URL.revokeObjectURL(K)})}});function w(){n.closePreview()}function U(){if(!a.value||!l.payload?.downloadableName)return;const x=document.createElement("a");x.href=a.value,x.download=l.payload.downloadableName,x.click()}return(x,m)=>(i(),we(Ne,{to:"body"},[P(et,{name:"fade"},{default:Oe(()=>[S(l).open&&S(l).payload?(i(),d("div",{key:0,class:"overlay",onPointerdown:m[0]||(m[0]=Q((..._)=>S(C)&&S(C)(..._),["self"])),onPointerup:m[1]||(m[1]=Q((..._)=>S(f)&&S(f)(..._),["self"]))},[e("div",Fa,[e("header",null,[e("h3",null,b(S(l).payload.title),1),e("div",za,[a.value?(i(),d("button",{key:0,class:"ghost",onClick:U},[P(F,{name:"download"}),m[2]||(m[2]=le(" 导出 ",-1))])):z("",!0),e("button",{class:"icon",onClick:w},[P(F,{name:"close"})])])]),e("section",null,[(i(),we(an(S(y)),{source:S(l).payload.content},null,8,["source"]))])])],32)):z("",!0)]),_:1})]))}}),Wa=pe(Ua,[["__scopeId","data-v-4161bfb1"]]),Oa={class:"modal"},Na={class:"content"},Ka=["src","alt"],ja=ce({__name:"ImagePreviewModal",setup(r){const n=ye(),l=n.imagePreview,{onBackdropPointerDown:u,onBackdropPointerUp:y}=nt(a);function a(){n.closeImagePreview()}return(C,f)=>(i(),we(Ne,{to:"body"},[P(et,{name:"fade"},{default:Oe(()=>[S(l).open?(i(),d("div",{key:0,class:"overlay",onPointerdown:f[0]||(f[0]=Q((...w)=>S(u)&&S(u)(...w),["self"])),onPointerup:f[1]||(f[1]=Q((...w)=>S(y)&&S(y)(...w),["self"]))},[e("div",Oa,[e("header",null,[e("h3",null,b(S(l).name??"图片预览"),1),e("button",{class:"icon",onClick:a},[P(F,{name:"close"})])]),e("div",Na,[e("img",{src:S(l).src,alt:S(l).name??"attachment"},null,8,Ka)])])],32)):z("",!0)]),_:1})]))}}),Va=pe(ja,[["__scopeId","data-v-470c8bfc"]]),Ga={class:"dialog"},Ya={class:"actions"},Ja=ce({__name:"ConfirmDialog",setup(r){const n=ye(),{confirmDialog:l}=kt(n),u=p(()=>l.value.open?l.value.options:null),{onBackdropPointerDown:y,onBackdropPointerUp:a}=nt(C);function C(){n.resolveConfirm(!1)}function f(){n.resolveConfirm(!0)}return(w,U)=>(i(),we(Ne,{to:"body"},[P(et,{name:"fade"},{default:Oe(()=>[u.value?(i(),d("div",{key:0,class:"overlay",onPointerdown:U[0]||(U[0]=Q((...x)=>S(y)&&S(y)(...x),["self"])),onPointerup:U[1]||(U[1]=Q((...x)=>S(a)&&S(a)(...x),["self"]))},[e("div",Ga,[e("h3",null,b(u.value.title),1),e("p",null,b(u.value.message),1),e("div",Ya,[e("button",{class:"ghost",onClick:C},b(u.value.cancelLabel??"取消"),1),e("button",{class:"danger",onClick:f},b(u.value.confirmLabel??"确认"),1)])])],32)):z("",!0)]),_:1})]))}}),Qa=pe(Ja,[["__scopeId","data-v-d1092b8d"]]),Xa={class:"panel"},Za={class:"actions"},er=["disabled"],tr={class:"form-section"},nr={class:"field"},sr={class:"field-inline"},or={class:"field"},lr=["value"],ar={class:"field"},rr=["disabled"],ir={class:"list-section"},ur={key:0,class:"loading"},cr={key:1,class:"empty"},dr={key:2},pr={class:"mono"},vr=["onClick"],fr=ce({__name:"BanManager",setup(r){const n=De(),l=ye(),{blockedIPs:u,loadingBlockedIPs:y}=kt(n),a=[{label:"1 小时",value:3600*1e3},{label:"6 小时",value:360*60*1e3},{label:"1 天",value:1440*60*1e3},{label:"7 天",value:10080*60*1e3},{label:"30 天",value:720*60*60*1e3},{label:"永久",value:null}],C=R(""),f=R(a[2].value),w=R(""),U=R(!1),x=p(()=>y.value),m=p(()=>u.value?.blocked??[]),_=p(()=>u.value?.now??Date.now());async function V(O=!1){await n.refreshBlockedIPs(O)}async function K(){if(C.value){U.value=!0;try{await n.banIp(C.value,f.value??void 0,w.value||void 0),l.pushToast({type:"success",title:"封禁成功",message:`${C.value} 已被封禁`}),C.value="",w.value="",await V(!0)}catch(O){l.pushToast({type:"error",title:"封禁失败",message:O instanceof Error?O.message:String(O)})}finally{U.value=!1}}}async function E(){await V(!0)}function k(){l.toggleBanManager(!1)}const{onBackdropPointerDown:D,onBackdropPointerUp:h}=nt(k);async function H(O){await n.unbanIp(O),l.pushToast({type:"success",title:"已解除封禁",message:`${O} 已解除`}),await V(!0)}function j(O){return O?Ie(O):"永久封禁"}function ee(O){if(!O)return"永久";const M=O-_.value;return M<=0?"即将解除":cn(M)}return fe(()=>l.banManagerOpen,O=>{O&&V()}),ct(()=>{l.banManagerOpen&&V()}),(O,M)=>(i(),we(Ne,{to:"body"},[P(et,{name:"overlay-dialog"},{default:Oe(()=>[S(l).banManagerOpen?(i(),d("div",{key:0,class:"overlay",onPointerdown:M[3]||(M[3]=Q((...I)=>S(D)&&S(D)(...I),["self"])),onPointerup:M[4]||(M[4]=Q((...I)=>S(h)&&S(h)(...I),["self"]))},[e("div",Xa,[e("header",null,[M[5]||(M[5]=e("h3",null,"IP 封禁管理",-1)),e("div",Za,[e("button",{class:"ghost",disabled:x.value,onClick:E},"刷新",8,er),e("button",{class:"icon",onClick:k},[P(F,{name:"close"})])])]),e("section",tr,[M[10]||(M[10]=e("h4",null,"新增封禁",-1)),e("form",{onSubmit:Q(K,["prevent"])},[e("div",nr,[M[6]||(M[6]=e("label",null,"IP 地址",-1)),Dt(e("input",{"onUpdate:modelValue":M[0]||(M[0]=I=>C.value=I),type:"text",placeholder:"例如 192.168.0.1",required:""},null,512),[[Yt,C.value,void 0,{trim:!0}]])]),e("div",sr,[e("div",or,[M[7]||(M[7]=e("label",null,"封禁时长",-1)),Dt(e("select",{"onUpdate:modelValue":M[1]||(M[1]=I=>f.value=I)},[(i(),d(ue,null,_e(a,I=>e("option",{key:I.value??"perm",value:I.value},b(I.label),9,lr)),64))],512),[[Cn,f.value]])]),e("div",ar,[M[8]||(M[8]=e("label",null,"原因（可选）",-1)),Dt(e("input",{"onUpdate:modelValue":M[2]||(M[2]=I=>w.value=I),type:"text",placeholder:"记录封禁原因"},null,512),[[Yt,w.value,void 0,{trim:!0}]])]),e("button",{class:"primary",type:"submit",disabled:U.value},[P(F,{name:"gavel"}),M[9]||(M[9]=le(" 封禁 ",-1))],8,rr)])],32)]),e("section",ir,[M[12]||(M[12]=e("h4",null,"已封禁 IP",-1)),x.value?(i(),d("div",ur,"正在加载...")):m.value.length===0?(i(),d("div",cr,"暂无封禁记录")):(i(),d("table",dr,[M[11]||(M[11]=e("thead",null,[e("tr",null,[e("th",null,"IP"),e("th",null,"解除时间"),e("th",null,"剩余"),e("th",null,"原因"),e("th",null,"操作")])],-1)),e("tbody",null,[(i(!0),d(ue,null,_e(m.value,I=>(i(),d("tr",{key:I.ip},[e("td",pr,b(I.ip),1),e("td",null,b(j(I.unblockAt)),1),e("td",null,b(ee(I.unblockAt)),1),e("td",null,b(I.reason||"—"),1),e("td",null,[e("button",{class:"danger",onClick:T=>H(I.ip)},"解除封禁",8,vr)])]))),128))])]))])])],32)):z("",!0)]),_:1})]))}}),mr=pe(fr,[["__scopeId","data-v-9de310ce"]]),hr={class:"panel"},gr={class:"actions"},yr=["disabled"],_r={key:0,class:"loading"},br={key:1,class:"empty"},kr={key:2},wr={class:"mono"},Tr={class:"row-actions"},Cr=["onClick"],$r=["onClick"],Sr=ce({__name:"AliasManager",setup(r){const n=ye(),l=De(),{aliasKeys:u,loadingAliasKeys:y}=kt(l),a=p(()=>u.value?.aliasKeys??[]),C=p(()=>y.value);function f(){n.toggleAliasManager(!1)}const{onBackdropPointerDown:w,onBackdropPointerUp:U}=nt(f);async function x(K=!0){await l.refreshAliasKeys(K)}async function m(K){await n.confirm({title:"删除别名",message:`确定要删除别名 ${K} 吗？`})&&(await l.removeAlias(K),n.pushToast({type:"success",title:"删除成功",message:`${K} 已删除`}),await x(!0))}async function _(K){try{await navigator.clipboard.writeText(K),n.pushToast({type:"success",title:"已复制",message:K})}catch(E){n.pushToast({type:"error",title:"复制失败",message:E instanceof Error?E.message:String(E)})}}function V(K){return K?Ie(K):"—"}return fe(()=>n.aliasManagerOpen,K=>{K&&x(!1)}),ct(()=>{n.aliasManagerOpen&&x(!1)}),(K,E)=>(i(),we(Ne,{to:"body"},[P(et,{name:"overlay-dialog"},{default:Oe(()=>[S(n).aliasManagerOpen?(i(),d("div",{key:0,class:"overlay",onPointerdown:E[1]||(E[1]=Q((...k)=>S(w)&&S(w)(...k),["self"])),onPointerup:E[2]||(E[2]=Q((...k)=>S(U)&&S(U)(...k),["self"]))},[e("div",hr,[e("header",null,[E[3]||(E[3]=e("h3",null,"别名密钥管理",-1)),e("div",gr,[e("button",{class:"ghost",disabled:C.value,onClick:E[0]||(E[0]=k=>x())},"刷新",8,yr),e("button",{class:"icon",onClick:f},[P(F,{name:"close"})])])]),e("section",null,[C.value?(i(),d("div",_r,"正在加载别名密钥...")):a.value.length===0?(i(),d("div",br,"暂无别名密钥")):(i(),d("table",kr,[E[6]||(E[6]=e("thead",null,[e("tr",null,[e("th",null,"别名"),e("th",null,"创建时间"),e("th",null,"最近使用"),e("th",null,"使用次数"),e("th",null,"操作")])],-1)),e("tbody",null,[(i(!0),d(ue,null,_e(a.value,k=>(i(),d("tr",{key:k.aliasName},[e("td",wr,b(k.aliasName),1),e("td",null,b(V(k.ctAt)),1),e("td",null,b(V(k.upAt||k.firstUsedAt)),1),e("td",null,b(k.usageCount),1),e("td",null,[e("div",Tr,[e("button",{class:"ghost",onClick:D=>_(k.aliasName)},[P(F,{name:"content_copy"}),E[4]||(E[4]=le(" 复制 ",-1))],8,Cr),e("button",{class:"danger",onClick:D=>m(k.aliasName)},[P(F,{name:"delete"}),E[5]||(E[5]=le(" 删除 ",-1))],8,$r)])])]))),128))])]))])])],32)):z("",!0)]),_:1})]))}}),Mr=pe(Sr,[["__scopeId","data-v-8cd9c6d4"]]),Ir={class:"panel"},Pr=ce({__name:"HelpPanel",setup(r){const n=ye(),{onBackdropPointerDown:l,onBackdropPointerUp:u}=nt(y);function y(){n.toggleHelpPanel(!1)}return(a,C)=>(i(),we(Ne,{to:"body"},[P(et,{name:"fade"},{default:Oe(()=>[S(n).helpPanelOpen?(i(),d("div",{key:0,class:"overlay",onPointerdown:C[0]||(C[0]=Q((...f)=>S(l)&&S(l)(...f),["self"])),onPointerup:C[1]||(C[1]=Q((...f)=>S(u)&&S(u)(...f),["self"]))},[e("div",Ir,[e("header",null,[C[2]||(C[2]=e("h3",null,"操作帮助",-1)),e("button",{class:"icon",onClick:y},[P(F,{name:"close"})])]),C[3]||(C[3]=e("section",null,[e("article",null,[e("h4",null,"基础用法"),e("ul",null,[e("li",null,"左侧 IP 面板支持按请求数、流量等排序，单击选择后即可加载相关主题。"),e("li",null,"主题列表支持快速筛选，可通过右上角搜索框按主题 ID 或别名过滤。"),e("li",null,"消息面板会自动缓存已加载的数据，再次打开时秒级响应，顶部按钮可强制刷新。")])]),e("article",null,[e("h4",null,"操作快捷键"),e("ul",null,[e("li",null,[e("kbd",null,"R"),le("：刷新当前主题消息。")]),e("li",null,[e("kbd",null,"Shift"),le(" + "),e("kbd",null,"R"),le("：请求全量增量同步。")]),e("li",null,[e("kbd",null,"Ctrl"),le(" + "),e("kbd",null,"F"),le("：定位浏览器原生搜索，结合消息折叠功能快速定位。")])]),e("p",{class:"hint"},"提示：快捷键操作会在浏览器焦点位于页面内时生效。")]),e("article",null,[e("h4",null,"封禁与别名"),e("ul",null,[e("li",null,"封禁和别名管理在右上角菜单中打开，支持实时刷新。"),e("li",null,"封禁记录支持自定义时长和原因，解除后相关状态实时更新。"),e("li",null,"别名密钥展示实时使用次数，删除操作需二次确认以避免误删。")])]),e("article",null,[e("h4",null,"异常处理"),e("ul",null,[e("li",null,"若出现请求失败，可通过右上角的告警信息查看错误详情并重试。"),e("li",null,"若发现数据与服务端不一致，可点击“强制全量刷新”重新同步缓存。")])])],-1))])],32)):z("",!0)]),_:1})]))}}),xr=pe(Pr,[["__scopeId","data-v-5468cd4f"]]),Ar={class:"overlay-control__surface"},Er=["value","placeholder","aria-label","onKeydown"],Rr=["value","aria-label"],qr=["value","disabled"],ln=56,Lr=ce({__name:"OverlayControl",setup(r){const n=Vt(),l=p(()=>n.visible),u=p(()=>n.expanded),y=p(()=>n.closing),a=p(()=>n.rect),C=p(()=>n.icon),f=p(()=>n.variant),w=p(()=>n.label),U=p(()=>n.relocating),x=p({get:()=>n.value,set:q=>n.updateValue(q)}),m=p(()=>n.options),_=p(()=>n.align),V=p(()=>n.collapsedWidth),K=p(()=>n.expandedWidth),E=R(null),k=R(null),D=p(()=>[`overlay-control--${f.value}`,{"overlay-control--expanded":u.value,"overlay-control--relocating":U.value}]),h=p(()=>({"overlay-control__icon":!0,"panel-control__icon":!0,"panel-filter__icon":f.value==="filter","panel-select__icon":f.value==="sort"})),H=p(()=>{const q=a.value,o=V.value||q.width||0,s=o>0?o:0,v=K.value||s,Z=v>0?Math.max(v,s):s,B=q.left,G=q.left+q.width,me=_.value==="right"?G-Z:B,Te=_.value==="right"?G-s:B;let he=me,be=Te;if(typeof window<"u"){const Ee=window.innerWidth??Z,$e=Math.max(Ee-Z,0),Re=Math.max(Ee-s,0);he=Math.min(Math.max(me,0),$e),be=Math.min(Math.max(Te,0),Re)}const Ce=u.value&&!y.value,Y=Ce?Z:s,Pe=Ce?he:be,xe=Math.max(s-ln,0),Ae=Math.max(Z-ln,0),Ke=Ce?Ae:xe;return{top:`${q.top}px`,left:`${Pe}px`,width:`${Y}px`,height:`${q.height}px`,"--overlay-field-width":`${Math.max(Ke,0)}px`}});function j(){n.beginInteraction()}function ee(){n.scheduleClose()}function O(){n.beginInteraction()}function M(q){const o=q.currentTarget,s=q.relatedTarget;o&&s&&o.contains(s)||n.scheduleClose(200)}function I(q){y.value&&(q.propertyName==="width"||q.propertyName==="left")&&n.finalize()}function T(q){l.value&&(q.key==="Escape"&&n.cancel(),q.key==="Enter"&&f.value==="filter"&&n.requestClose())}function L(){l.value&&n.refreshAnchorRect()}function A(){$n(()=>{const q=f.value==="filter"?E.value:k.value;if(q?.focus({preventScroll:!0}),q instanceof HTMLInputElement){const o=q.value.length;q.setSelectionRange(o,o)}})}function J(q){n.updateValue(q.target.value)}function ne(){n.commit()}function X(){n.cancel()}function se(q){const o=q.target.value;n.commit(o)}return fe(l,q=>{q&&A()}),fe(u,(q,o)=>{q&&!o&&A()}),fe(U,q=>{q&&A()}),ct(()=>{window.addEventListener("keydown",T,!0),window.addEventListener("resize",L,!0),window.addEventListener("scroll",L,!0)}),Wt(()=>{window.removeEventListener("keydown",T,!0),window.removeEventListener("resize",L,!0),window.removeEventListener("scroll",L,!0)}),(q,o)=>(i(),we(Ne,{to:"body"},[l.value?(i(),d("div",{key:0,class:ae(["overlay-control",D.value]),style:bt(H.value),role:"dialog",onMouseenter:j,onMouseleave:ee,onFocusin:O,onFocusout:M,onTransitionend:I},[e("div",Ar,[P(F,{name:C.value,class:ae(h.value)},null,8,["name","class"]),f.value==="filter"?(i(),d("input",{key:0,ref_key:"filterInputRef",ref:E,class:"overlay-control__field overlay-control__input",type:"text",value:x.value,placeholder:w.value,"aria-label":w.value,onInput:J,onKeydown:[ve(Q(ne,["prevent"]),["enter"]),ve(Q(X,["prevent"]),["esc"])],onBlur:ne},null,40,Er)):(i(),d("select",{key:1,ref_key:"selectRef",ref:k,class:"overlay-control__field overlay-control__select",value:x.value,"aria-label":w.value,onChange:se},[(i(!0),d(ue,null,_e(m.value,s=>(i(),d("option",{key:s.value,value:s.value,disabled:s.disabled===!0},b(s.label),9,qr))),128))],40,Rr))])],38)):z("",!0)]))}}),Dr=pe(Lr,[["__scopeId","data-v-8be5915e"]]),Hr={key:1,class:"loading-state"},Br=ce({__name:"App",setup(r){const n=De(),{initialized:l}=kt(n),u=p(()=>l.value),y={ipList:_o,topicList:el,messageList:Aa},a=["ipList","topicList","messageList"],{layout:C,setViewport:f,setContainerSize:w,setFocusedPanel:U,updatePanelHeader:x}=Fs(a),m=p(()=>C.value.activePanelId),_=p(()=>C.value.stackDirection),V=p(()=>({"--layout-total":`${C.value.totalSpan}px`})),K=p(()=>({"app-shell--vertical":_.value==="down"})),E=p(()=>({"dashboard-grid--vertical":_.value==="down","dashboard-grid--horizontal":_.value==="right","dashboard-grid--focused":!!m.value})),k={ipList:R(null),topicList:R(null),messageList:R(null)},D={ipList(M){k.ipList.value=M},topicList(M){k.topicList.value=M},messageList(M){k.messageList.value=M}};function h(M){return[`panel-stack--${M.id}`,{"panel-stack--focused":M.id===m.value,"panel-stack--muted":!!m.value&&M.id!==m.value,"panel-stack--collapsed":!!m.value&&M.id!==m.value}]}function H(M){U(M),Object.entries(k).forEach(([I,T])=>{I!==M&&T.value?.resetToCollapsedState()})}const j=R(null);We(j,M=>{const I=M[0];if(!I)return;let T=I.contentRect.width;j.value?.closest(".app-shell")&&(T=T-1);const A=Math.max(0,Math.round(T*10)/10),J=Math.max(0,Math.round(I.contentRect.height*10)/10);w(A,J)}),Mn(wt,{ipList:{reportHeaderSize(M){x("ipList",M.width,M.height)}},topicList:{reportHeaderSize(M){x("topicList",M.width,M.height)}},messageList:{reportHeaderSize(M){x("messageList",M.width,M.height)}}});const{width:ee,height:O}=Sn();return fe([ee,O],([M,I])=>{f(M??0,I??0)},{immediate:!0}),ct(async()=>{await n.initialize(),await n.refreshLightStats()}),(M,I)=>(i(),d("div",{class:ae(["app-shell",K.value])},[P(As),u.value?(i(),d("section",{key:0,ref_key:"gridEl",ref:j,class:ae(["dashboard-grid",E.value]),style:bt(V.value)},[(i(!0),d(ue,null,_e(S(C).panels,T=>(i(),d("div",{key:T.id,class:ae(["panel-stack",h(T)]),style:bt(T.style)},[(i(),we(an(y[T.id]),{collapsed:!!m.value&&T.id!==m.value,"main-span":T.mainSpan,"stack-direction":_.value,ref_for:!0,ref:D[T.id],onRequestFocus:L=>H(T.id)},null,40,["collapsed","main-span","stack-direction","onRequestFocus"]))],6))),128))],6)):(i(),d("div",Hr,[...I[0]||(I[0]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在加载仪表板数据...",-1)])])),P(Ba),P(Wa),P(Va),P(Qa),P(mr),P(Mr),P(xr),P(Dr)],2))}}),Fr=pe(Br,[["__scopeId","data-v-d33ee2fd"]]),fn=In(Fr);fn.use(Pn());fn.mount("#app");typeof window<"u"&&(window.dispatchEvent(new CustomEvent("dashboard:mounted",{detail:Date.now()})),window.__hideDashboardLoading?.());
