import{d as Ft,r as E,a as re,u as st,c as p,w as pe,b as zt,e as hn,f as ce,g as gn,h as c,o as u,m as yn,i as x,t as _,j as bn,k as _n,l as at,n as Ut,p as le,q as e,s as B,v as oe,x as P,y as X,z as gt,A as Wt,B as Fe,C as de,F as ie,D as be,E as _t,G as Se,T as kn,H as Je,I as wn,J as rt,K as ln,L as Qe,M as Tn,N as kt,O as Lt,P as Gt,Q as Cn,R as $n,S as Sn,U as Mn,V as xn,W as In}from"./vendor-vue-_LDqFLRs.js";import{d as Xe,r as An,a as Pn}from"./vendor-dayjs-CC1MZq2R.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const r of y)if(r.type==="childList")for(const C of r.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&d(C)}).observe(document,{childList:!0,subtree:!0});function a(y){const r={};return y.integrity&&(r.integrity=y.integrity),y.referrerPolicy&&(r.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?r.credentials="include":y.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(y){if(y.ep)return;y.ep=!0;const r=a(y);fetch(y.href,r)}})();const En="/dashboard/api";function an(){return typeof window>"u"?null:window.__DASHBOARD_INIT__??null}function Rn(){return an()?.aDashkey??null}function qn(){return En}const Ln=1e4;class Yt extends Error{status;payload;constructor(s,a,d){super(s),this.name="DashboardRequestError",this.status=a,this.payload=d}}class Dn{baseUrl;token;constructor(s=qn()){this.baseUrl=s.replace(/\/$/,""),this.token=Rn()}setToken(s){this.token=s}buildUrl(s,a){const d=s.startsWith("/")?s:`/${s}`,y=`${this.baseUrl}${d}`;if(!a||Object.keys(a).length===0)return y;const r=new URLSearchParams;Object.entries(a).forEach(([m,T])=>{T!=null&&r.append(m,String(T))});const C=r.toString();return C?`${y}?${C}`:y}async request(s,a,d={}){const{params:y,signal:r,headers:C={},body:m}=d,T=this.buildUrl(s,y),z=m!==void 0?JSON.stringify(m):void 0,I=await fetch(T,{method:a,signal:r,headers:{Accept:"application/json;charset=UTF-8",...z?{"Content-Type":"application/json;charset=UTF-8"}:{},...this.token?{"x-dashboard-token":this.token}:{},...C},credentials:"same-origin",body:z}),h=(I.headers.get("content-type")||"").includes("application/json");let b=null;if(h)try{b=await I.json()}catch{if(I.ok)throw new Yt("无法解析服务器响应",I.status,null)}if(!I.ok){const j=b,N=j?.error||I.statusText||"请求失败";throw new Yt(N,I.status,j??null)}return b}get(s,a){return this.request(s,"GET",a)}post(s,a,d){return this.request(s,"POST",{...d,body:a})}}const ue=new Dn,Hn=()=>ue.get("/lightStats"),Bn=()=>ue.get("/fullStats"),Fn=i=>ue.get("/globalDelta",{params:{since:i}}),zn=i=>ue.get("/iptopics",{params:{ip:i}}),Un=(i,s,a={})=>ue.get("/topic",{params:{ip:i,tid:s,start:a.start,limit:a.limit}}),Wn=i=>ue.get("/messageRequestBody",{params:{id:i}}),On=i=>ue.get("/messageRequestHeaders",{params:{id:i}}),Nn=i=>ue.get("/modelError",{params:{id:i}}),Kn=i=>ue.post("/deleteTopics",i),jn=i=>ue.post("/deleteIP",i),Vn=()=>ue.get("/blockedIPs"),Gn=i=>ue.post("/banIP",i),Yn=i=>ue.post("/unbanIP",i),Jn=()=>ue.get("/aliasKeys"),Qn=i=>ue.post("/deleteAliasKey",i),Xn=i=>{ue.setToken(i)},qe=Ft("dashboard",()=>{const i=E(!1),s=E(null),a=re(new Map),d=re(new Map),y=re(new Map),r=re(new Map),C=re(new Map),m=re(new Map),T=re(new Map);re(new Map);const z=E(null),I=E(null),h=st("dashboard:selected-ip",null),b=st("dashboard:selected-topic",null),j=st("dashboard:topic-filter",""),N=st("dashboard:ip-filter",""),w=st("dashboard:ip-sort","recent"),g=E(1),D=E(25),M=E(1),U=E(25),K=E(0),Z=E(null),W=E("connected"),$=E(null),S=E(null),k=E(!1),q=E(!1),A=E(!1),Y=E(!1),te=re(new Map),J=re(new Map),ne=re(new Map);re(new Map);const R=E(null),l=p(()=>{for(const t of a.values())if(t.unread)return!0;for(const t of d.values())if(t.unreadTopicIds.size>0)return!0;return!1}),o=p(()=>Array.from(a.entries()).map(([t,n])=>{const{summary:v}=n,F=v.lModReqAt??v.lTopUpdAt??0;return{ip:t,entry:n,summary:v,unread:n.unread,dirtyTopics:n.dirtyTopics,lastActive:F,sortValue:Ce(n.summary,w.value)}})),f=p(()=>{const t=[...o.value],n=w.value;return t.sort((v,F)=>n==="recent"?(F.lastActive||0)-(v.lastActive||0):n==="reqs"?(F.summary.reqs||0)-(v.summary.reqs||0):n==="in"?(F.summary.inTfc||0)-(v.summary.inTfc||0):n==="out"?(F.summary.outTfc||0)-(v.summary.outTfc||0):0),t}),Q=p(()=>{const t=N.value.trim().toLowerCase(),v=t?f.value.filter(O=>O.ip.toLowerCase().includes(t)):f.value,F=Math.max(1,Math.ceil(v.length/D.value));g.value>F&&(g.value=F);const ee=(g.value-1)*D.value;return v.slice(ee,ee+D.value)});pe(N,()=>{g.value=1});const L=p(()=>{const t=h.value;return t?a.get(t)?.dirtyTopics??!1:!1});pe(L,t=>{t&&h.value&&Ee(h.value)});const V=p(()=>{const t=h.value;if(!t)return[];const n=d.get(t);if(!n)return[];const v=[...n.items];v.sort((ee,O)=>(O.upAt||0)-(ee.upAt||0));const F=j.value.trim().toLowerCase();return F?v.filter(ee=>ee.tid.toLowerCase().includes(F)||(ee.hKey||"").toLowerCase().includes(F)||(ee.title||"").toLowerCase().includes(F)):v}),fe=p(()=>{const t=V.value,n=Math.max(1,Math.ceil(t.length/U.value));M.value>n&&(M.value=n);const v=(M.value-1)*U.value;return t.slice(v,v+U.value)}),Te=p(()=>{const t=b.value;if(!t)return[];const n=y.get(t);return n?n.items:[]}),me=p(()=>{const t=b.value;return t?y.get(t)?.dirty??!1:!1});pe(me,t=>{if(!t)return;const n=b.value;if(!n)return;const v=h.value??pt(n);v&&Ue(v,n)});const ke=p(()=>{const t=b.value;if(!t)return null;const n=y.get(t);return n?{total:n.total,dirty:n.dirty,fullyLoaded:n.fullyLoaded,topicHashNoReason:n.topicHashNoReason??null,topicHashWithReason:n.topicHashWithReason??null}:null});function Ce(t,n){return n==="recent"?t.lModReqAt??t.lTopUpdAt??0:n==="reqs"?t.reqs:n==="in"?t.inTfc:n==="out"?t.outTfc:0}function G(t,n={}){const v=a.get(t.ip),F={ip:t.ip,reqs:t.reqs??v?.summary.reqs??0,inTfc:t.inTfc??v?.summary.inTfc??0,outTfc:t.outTfc??v?.summary.outTfc??0,lTopUpdAt:t.lTopUpdAt??v?.summary.lTopUpdAt,lModReqAt:t.lModReqAt??v?.summary.lModReqAt,realIPs:t.realIPs??v?.summary.realIPs};a.set(t.ip,{summary:F,dirtyTopics:n.markDirty??v?.dirtyTopics??!1,unread:n.markUnread?!0:v?.unread??!1})}function xe(t){for(const n of a.keys())t.has(n)||(a.delete(n),d.delete(n))}function Le(t){const n=a.get(t);n&&a.set(t,{...n,unread:!1});const v=d.get(t);v&&(v.unreadTopicIds=new Set)}function Ie(t,n){const v=d.get(t);if(v&&v.unreadTopicIds.has(n)){const F=new Set(v.unreadTopicIds);F.delete(n),v.unreadTopicIds=F}}async function ze(){if(i.value)return;const t=an();if(R.value=t,t){s.value={totReqs:t.totReqs,totInTfc:t.totInTfc,totOutTfc:t.totOutTfc,ts:t.ts,sTime:t.sTime,lGMsgAt:t.lGMsgAt??null},K.value=t.lGMsgAt??0,Xn(t.aDashkey??null);const n=new Set;t.ipStats.forEach(F=>{n.add(F.ip),G(F)}),xe(n);const v=t.ipStats.map(F=>F.ip);h.value&&!v.includes(h.value)&&(h.value=null,b.value=null),!h.value&&v.length>0?ct(v[0]):h.value&&Ee(h.value)}i.value=!0}async function Ae(){if(!k.value){k.value=!0;try{const t=await Hn();s.value=t,W.value="connected",S.value=null,$.value=Date.now(),t.lGMsgAt&&t.lGMsgAt>K.value&&await Pe()}catch(t){W.value="disconnected",S.value=t instanceof Error?t.message:String(t)}finally{k.value=!1}}}async function $e(){if(!q.value){q.value=!0;try{const t=await Bn();s.value={totReqs:t.totReqs,totInTfc:t.totInTfc,totOutTfc:t.totOutTfc,ts:t.ts,sTime:t.sTime,lGMsgAt:t.lGMsgAt};const n=new Set;t.ipStats.forEach(v=>{n.add(v.ip),G(v)}),xe(n),W.value="connected",S.value=null}catch(t){W.value="disconnected",S.value=t instanceof Error?t.message:String(t)}finally{q.value=!1}}}async function Pe(t){const n=t??K.value,v=await Fn(n);v.lGMsgAt&&(K.value=v.lGMsgAt,Z.value=v.lGMsgAt);const F=new Set,ee=Date.now();v.chgIPs.forEach(O=>{F.add(O.ip),G({ip:O.ip,reqs:O.reqs,inTfc:O.inTfc,outTfc:O.outTfc,lTopUpdAt:O.ipUpdAt,lModReqAt:O.ipUpdAt,realIPs:O.realIPs},{markUnread:!0})}),v.chgTop.forEach(O=>{F.add(O.ip);const Be=d.get(O.ip),Oe=Be?new Set(Be.unreadTopicIds):new Set,Ne=h.value===O.ip&&b.value===O.tid;Ne?Oe.delete(O.tid):Oe.add(O.tid);let ye=Be?[...Be.items]:[];const Ze=ye.findIndex(ge=>ge.tid===O.tid),mt=ge=>{const ae=ge?{...ge}:{tid:O.tid,hKey:O.tid,ctAt:O.ctAt??O.upAt??ee,upAt:O.upAt??ee,msgCnt:O.msgCnt??0,inBytes:O.inBytes??0,outBytes:O.outBytes??0,status:"",hist:!1,title:null};return ae.ctAt=O.ctAt??ae.ctAt,ae.upAt=O.upAt??ae.upAt,ae.msgCnt=O.msgCnt??ae.msgCnt,ae.inBytes=O.inBytes??ae.inBytes,ae.outBytes=O.outBytes??ae.outBytes,Object.prototype.hasOwnProperty.call(O,"status")&&(ae.status=O.status??ae.status),Object.prototype.hasOwnProperty.call(O,"hist")&&(ae.hist=O.hist??ae.hist),Object.prototype.hasOwnProperty.call(O,"title")&&(ae.title=O.title??null),ae};Ze>=0?ye[Ze]=mt(ye[Ze]):ye=[mt(),...ye],ye.sort((ge,ae)=>(ae.upAt||0)-(ge.upAt||0)),d.set(O.ip,{items:ye,fetchedAt:ee,dirty:!1,unreadTopicIds:Oe});const he=y.get(O.tid);he&&y.set(O.tid,{...he,dirty:!0,fullyLoaded:!1}),G({ip:O.ip,lTopUpdAt:O.upAt,lModReqAt:O.upAt},{markUnread:!Ne})}),F.size>0&&(W.value="connected",S.value=null)}async function Ee(t,n=!1){if(!t)return;const v=d.get(t);if(!(!n&&v&&!v.dirty)&&!te.get(t)){te.set(t,!0);try{const F=await zn(t);d.set(t,{items:F.topics,fetchedAt:Date.now(),dirty:!1,unreadTopicIds:v?v.unreadTopicIds:new Set}),b.value&&!F.topics.some(ee=>ee.tid===b.value)&&(b.value=null),G({ip:t,lTopUpdAt:F.topics[0]?.upAt??v?.items[0]?.upAt??0},{markDirty:!1,markUnread:!!v?.unreadTopicIds.size})}finally{te.delete(t)}}}async function Ue(t,n,v=!1){if(!n)return;const F=y.get(n);if(!(!v&&F&&!F.dirty)&&!J.get(n)){J.set(n,!0);try{const ee=await Un(t,n,{start:0,limit:200});y.set(n,{items:ee.msgs,total:ee.total,fetchedAt:Date.now(),dirty:!1,fullyLoaded:ee.msgs.length>=ee.total,topicHashNoReason:ee.topicHashNoReason??null,topicHashWithReason:ee.topicHashWithReason??null}),Ie(t,n),Le(t)}finally{J.delete(n)}}}async function ut(t,n=!1){if(!t)return;const v=C.get(t);if(!n&&v)return v.data;const F=await Wn(t);return C.set(t,{data:F,fetchedAt:Date.now()}),F}async function Tt(t,n=!1){if(!t)return;const v=m.get(t);if(!n&&v)return v.data;const F=await On(t);return m.set(t,{data:F,fetchedAt:Date.now()}),F}async function Ct(t,n=!1){if(!t)return;const v=T.get(t);if(!n&&v)return v.data;const F=await Nn(t);return T.set(t,{data:F,fetchedAt:Date.now()}),F}async function $t(t,n){if(!n.length)return;await Kn({ip:t,topicIds:n});const v=d.get(t);if(v){const F=v.items.filter(O=>!n.includes(O.tid)),ee=new Set(v.unreadTopicIds);n.forEach(O=>ee.delete(O)),d.set(t,{items:F,fetchedAt:Date.now(),dirty:!1,unreadTopicIds:ee})}n.forEach(F=>y.delete(F)),b.value&&n.includes(b.value)&&(b.value=null),await $e()}async function St(t){await jn({ip:t}),a.delete(t),d.delete(t),Array.from(y.keys()).forEach(v=>{pt(v)===t&&y.delete(v)}),h.value===t&&(h.value=null,b.value=null),await $e()}async function Mt(t,n,v){await Gn({ip:t,durationMs:n,reason:v}),await He(!0)}async function xt(t){await Yn({ip:t}),await He(!0)}async function De(t){await Qn({aliasName:t}),await We(!0)}async function He(t=!1){if(!A.value&&!(!t&&z.value&&Date.now()-(z.value.now||0)<3e4)){A.value=!0;try{z.value=await Vn()}finally{A.value=!1}}}async function We(t=!1){if(Y.value)return;const n=I.value?.aliasKeys?.[0];if(!(!t&&I.value&&n&&Date.now()-n.upAt<3e4)){Y.value=!0;try{I.value=await Jn()}finally{Y.value=!1}}}function ct(t){t!==h.value&&(h.value=t,M.value=1,b.value=null,t&&(Ee(t),Le(t)))}function dt(t){t!==b.value&&(b.value=t,t&&h.value&&(Ue(h.value,t),Ie(h.value,t)))}function pt(t){for(const[n,v]of d.entries())if(v.items.some(F=>F.tid===t))return n;return null}function vt(t,n){const v=d.get(t);return v?v.unreadTopicIds.has(n):!1}function It(t){return r.get(t)?.data??null}function At(t){return C.get(t)?.data??null}function Pt(t){return m.get(t)?.data??null}function Et(t){return T.get(t)?.data??null}const{pause:Rt,resume:ft}=zt(()=>{document.hidden||Ae()},Ln,{immediate:!1});return hn(document,"visibilitychange",()=>{document.hidden?Rt():(Ae(),ft())}),pe(i,t=>{t&&ft()},{immediate:!0}),{initialized:i,stats:s,ipSortKey:w,ipPage:g,ipPageSize:D,topicPage:M,topicPageSize:U,selectedIp:h,selectedTopic:b,topicFilter:j,ipFilter:N,connectionStatus:W,lastSuccessfulPoll:$,pollError:S,hasUnreadUpdates:l,paginatedIps:Q,sortedIpList:f,currentIpTopics:V,paginatedTopics:fe,currentTopicMessages:Te,currentTopicMeta:ke,blockedIPs:z,aliasKeys:I,bootstrapData:R,globalDeltaSince:K,lastDeltaAt:Z,loadingLightStats:k,loadingFullStats:q,loadingBlockedIPs:A,loadingAliasKeys:Y,loadingTopics:te,loadingMessages:J,loadingMessageDetail:ne,initialize:ze,refreshLightStats:Ae,refreshFullStats:$e,applyGlobalDelta:Pe,ensureTopics:Ee,ensureMessages:Ue,loadMessageRequestBody:ut,loadMessageRequestHeaders:Tt,loadModelErrorDetails:Ct,removeTopics:$t,removeIp:St,banIp:Mt,unbanIp:xt,removeAlias:De,refreshBlockedIPs:He,refreshAliasKeys:We,setSelectedIp:ct,setSelectedTopic:dt,isTopicUnread:vt,getMessageDetail:It,getMessageRequestBody:At,getMessageRequestHeaders:Pt,getModelErrorDetails:Et}}),Zn=ce({inheritAttrs:!1,__name:"IconSymbol",props:{name:{}},setup(i){const s=gn(),a=i,d={assistant:"🤖",check_circle:"✔",chevron_left:"‹",chevron_right:"›",close:"✕",content_copy:"⧉",description:"📝",data_object:"{}",delete:"🗑",download:"⬇",error:"⛔",expand_more:"⌄",filter_alt:"⛃",gavel:"🔨",gpp_maybe:"⚠",help:"？",info:"ℹ",key:"🔑",image:"🖼",list:"≡",attach_file:"📎",open_in_new:"↗",psychology:"🧠",psychology_alt:"🧠",refresh:"⟳",search:"🔍",sort:"⇅",sync:"⟳",visibility:"👁",warning:"⚠",zoom_in:"＋",default:"•"},y=p(()=>d[a.name]??d.default);return(r,C)=>(u(),c("span",yn({class:"material-symbols-outlined icon-symbol",role:"img","aria-hidden":"true"},x(s)),_(y.value),17))}}),ve=(i,s)=>{const a=i.__vccOpts||i;for(const[d,y]of s)a[d]=y;return a},H=ve(Zn,[["__scopeId","data-v-ba526ecf"]]),es="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ts=(i=21)=>{let s="",a=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)s+=es[a[i]&63];return s};const _e=Ft("ui",()=>{const i=E([]),s=re({open:!1,payload:null}),a=re({open:!1,options:null,resolve:null}),d=E(!1),y=E(!1),r=E(!1);function C(w){const g={id:ts(8),type:w.type,title:w.title,message:w.message,duration:w.duration??5e3,createdAt:Date.now()};i.value=[...i.value,g],window.setTimeout(()=>m(g.id),g.duration)}function m(w){i.value=i.value.filter(g=>g.id!==w)}function T(w){s.open=!0,s.payload=w}function z(){s.open=!1,s.payload=null}function I(w){return a.open&&a.resolve&&a.resolve(!1),new Promise(g=>{a.open=!0,a.options=w,a.resolve=g})}function h(w){a.resolve&&a.resolve(w),a.open=!1,a.options=null,a.resolve=null}function b(w){d.value=w??!d.value}function j(w){y.value=w??!y.value}function N(w){r.value=w??!r.value}return{toasts:i,preview:s,confirmDialog:a,banManagerOpen:d,aliasManagerOpen:y,helpPanelOpen:r,pushToast:C,dismissToast:m,showPreview:T,closePreview:z,confirm:I,resolveConfirm:h,toggleBanManager:b,toggleAliasManager:j,toggleHelpPanel:N}});Xe.extend(An);Xe.extend(Pn);Xe.locale("zh-cn");const Jt=["B","KB","MB","GB","TB"];function we(i,s=1){if(!Number.isFinite(i))return"0 B";const a=Math.abs(i);if(a===0)return"0 B";const d=Math.min(Math.floor(Math.log10(a)/3),Jt.length-1),y=i/Math.pow(1024,d);return`${y.toFixed(y>=10?0:s)} ${Jt[d]}`}function rn(i){return Number.isFinite(i)?new Intl.NumberFormat("zh-CN").format(i):"0"}function Me(i){return Xe(i).format("YYYY-MM-DD HH:mm:ss")}function Ot(i){return Xe(i).fromNow()}function un(i){if(i<=0)return"0秒";const s=Xe.duration(i),a=[];s.days()&&a.push(`${s.days()}天`),s.hours()&&a.push(`${s.hours()}小时`),s.minutes()&&a.push(`${s.minutes()}分`);const d=s.seconds();return(d||a.length===0)&&a.push(`${d}秒`),a.join("")}const cn=bn(()=>{const i=E(Date.now());return zt(()=>{i.value=Date.now()},3e4,{immediate:!0}),i}),Nt=cn;function Kt(i){const s=cn();return p(()=>{s.value;const a=_n(i);return a==null?"—":Ot(a)})}const ns={class:"stats-header__pinned"},ss={class:"stats-header__pinned-row"},os={key:0,class:"badge badge--success"},ls={key:0,class:"stats-header__pinned-banner"},as={class:"status-banner status-banner--error status-banner--compact"},rs=["disabled"],is={class:"stats-header__content"},us={class:"stats-header__top"},cs={class:"stats-header__title"},ds={class:"stats-header__badges"},ps={key:0,class:"badge badge--success"},vs={class:"stats-header__actions"},fs=["disabled"],ms={key:0,class:"stats-header__banner status-banner status-banner--error"},hs=["disabled"],gs={key:1,class:"stats-header__grid"},ys={class:"metric-card"},bs={class:"metric-value"},_s={class:"metric-card"},ks={class:"metric-value"},ws={class:"metric-card"},Ts={class:"metric-value"},Cs={class:"metric-card"},$s={class:"metric-value"},Ss={class:"metric-card"},Ms={class:"metric-value"},xs={class:"metric-card"},Is={class:"metric-value"},As=ce({__name:"StatsHeader",setup(i){const s=qe(),a=_e(),d=E(!1),y=E(!1);let r=null;const C=p(()=>s.hasUnreadUpdates),m=p(()=>s.connectionStatus==="connected"?"已连接":"连接中断"),T=p(()=>["badge",s.connectionStatus==="connected"?"badge--success":"badge--danger"]),z=p(()=>s.loadingLightStats||s.loadingFullStats),I=p(()=>s.pollError),h=Nt(),b=Kt(()=>s.lastDeltaAt??null),j=E(Date.now()),{pause:N}=zt(()=>{j.value=Date.now()},1e3,{immediate:!0}),w=p(()=>{const S=s.stats;if(!S)return null;h.value;const k=j.value,q=S.sTime?Number(S.sTime):k,A=S.ts?Me(S.ts):"—",Y=s.lastDeltaAt?b.value:"—";return{totalRequests:rn(S.totReqs??0),totalIn:we(S.totInTfc??0),totalOut:we(S.totOutTfc??0),uptime:un(k-q),lastUpdate:A,lastDelta:Y}});function g(){s.refreshFullStats(),s.refreshLightStats()}function D(){g()}function M(){r!==null&&(window.clearTimeout(r),r=null),d.value=!0}function U(S=500){r!==null&&window.clearTimeout(r),r=window.setTimeout(()=>{y.value||(d.value=!1)},S)}function K(S){S.clientY<=110?M():U()}function Z(S){const k=S.touches[0];k&&(k.clientY<=120?M():U())}function W(){y.value=!0,M()}function $(){y.value=!1,U(350)}return at(()=>{window.addEventListener("mousemove",K),window.addEventListener("touchstart",Z,{passive:!0}),U(0)}),Ut(()=>{N(),window.removeEventListener("mousemove",K),window.removeEventListener("touchstart",Z),r!==null&&window.clearTimeout(r)}),(S,k)=>(u(),c("header",{class:le(["stats-header",{"stats-header--collapsed":!d.value}]),onMouseenter:W,onMouseleave:$},[e("div",ns,[e("div",ss,[e("span",{class:le(["badge",T.value])},[k[1]||(k[1]=e("span",{class:"dot"},null,-1)),oe(" "+_(m.value),1)],2),C.value?(u(),c("span",os,[...k[2]||(k[2]=[e("span",{class:"dot"},null,-1),oe(" 有新消息 ",-1)])])):B("",!0)]),I.value?(u(),c("div",ls,[e("div",as,[P(H,{name:"error"}),e("div",null,[k[3]||(k[3]=e("strong",null,"同步异常",-1)),e("p",null,_(I.value),1)]),e("button",{class:"ghost-button",type:"button",disabled:z.value,onClick:X(D,["stop"])},[P(H,{name:"refresh"}),k[4]||(k[4]=e("span",null,"重试",-1))],8,rs)])])):B("",!0)]),e("div",is,[e("div",us,[e("div",cs,[k[7]||(k[7]=e("h1",null,"Gemini Proxy 控制台",-1)),e("div",ds,[e("span",{class:le(["badge",T.value])},[k[5]||(k[5]=e("span",{class:"dot"},null,-1)),oe(" "+_(m.value),1)],2),C.value?(u(),c("span",ps,[...k[6]||(k[6]=[e("span",{class:"dot"},null,-1),oe(" 有新消息 ",-1)])])):B("",!0)])]),e("div",vs,[e("button",{class:"ghost-button",onClick:g,disabled:z.value},[P(H,{name:"refresh"}),k[8]||(k[8]=e("span",null,"刷新",-1))],8,fs),e("button",{class:"ghost-button",onClick:k[0]||(k[0]=q=>x(a).toggleHelpPanel(!0))},[P(H,{name:"help"}),k[9]||(k[9]=e("span",null,"帮助",-1))])])]),I.value?(u(),c("div",ms,[P(H,{name:"error"}),e("div",null,[k[10]||(k[10]=e("strong",null,"同步异常",-1)),e("p",null,_(I.value),1)]),e("button",{class:"ghost-button",type:"button",disabled:z.value,onClick:D},[P(H,{name:"refresh"}),k[11]||(k[11]=e("span",null,"重试",-1))],8,hs)])):B("",!0),w.value?(u(),c("div",gs,[e("div",ys,[k[12]||(k[12]=e("p",{class:"metric-title"},"总请求数",-1)),e("p",bs,_(w.value.totalRequests),1)]),e("div",_s,[k[13]||(k[13]=e("p",{class:"metric-title"},"入站流量",-1)),e("p",ks,_(w.value.totalIn),1)]),e("div",ws,[k[14]||(k[14]=e("p",{class:"metric-title"},"出站流量",-1)),e("p",Ts,_(w.value.totalOut),1)]),e("div",Cs,[k[15]||(k[15]=e("p",{class:"metric-title"},"运行时长",-1)),e("p",$s,_(w.value.uptime),1)]),e("div",Ss,[k[16]||(k[16]=e("p",{class:"metric-title"},"最后更新检查时间",-1)),e("p",Ms,_(w.value.lastUpdate),1)]),e("div",xs,[k[17]||(k[17]=e("p",{class:"metric-title"},"上次增量",-1)),e("p",Is,_(w.value.lastDelta),1)])])):B("",!0)])],34))}}),Ps=ve(As,[["__scopeId","data-v-15fbcf86"]]),Ve=500,Es=72,Rs=56,qs=960,Ls=640,Dt=1440,ot=900,Qt=.75,yt=1,Xt=6,dn=.75,Zt=64,en=(i,s,a)=>Math.min(Math.max(i,s),a),Ge=i=>typeof i=="number"&&Number.isFinite(i),Re=(i,s,a=dn)=>Math.abs(i-s)>a,pn=/^-?\d+(\.\d+)?$/;function lt(i){const s=Number.parseFloat(i);return Number.isFinite(s)?Math.max(0,s):null}function Ye(i,s){if(i==null)return s;if(typeof i=="number")return i>=0?i:s;const a=String(i).trim().toLowerCase();return a?pn.test(a)?lt(a)??s:a.endsWith("px")?lt(a.slice(0,-2))??s:s:s}function tn(i,{viewportHeight:s,fallback:a}){if(i==null)return a;if(typeof i=="number")return i>=0?i:a;const d=String(i).trim().toLowerCase();if(!d)return a;if(pn.test(d))return lt(d)??a;if(d.endsWith("px"))return lt(d.slice(0,-2))??a;if(d.endsWith("vh")){const y=s>0?s:typeof window<"u"?window.innerHeight:ot,r=lt(d.slice(0,-2));return y<=0||r==null?a:Math.max(0,r/100*y)}return a}function Ds(i){const s=i.cards,a=i.activeBuffer,d=i.defaultStackDirection??"right",y=i.minHeader??{horizontal:Es,vertical:Rs},r=i.maxHeader??{horizontal:qs,vertical:Ls},C=s.find(g=>g.initialFocus)?.id??(s.length>0?s[s.length-1].id:null),m=re({viewport:{width:1440,height:900},container:{width:1280,height:800},cards:s.map((g,D)=>({id:g.id,zIndex:g.zIndex??D+1,rightStackHeaderWidth:g.rightStackHeaderWidth??y.horizontal,downStackHeaderHeight:g.downStackHeaderHeight??y.vertical,isFocused:g.initialFocus??!1,contentWidth:Ye(g.minContentWidth,Ve),contentHeight:tn(g.contentHeight,{viewportHeight:ot,fallback:Ve}),config:g}))});let T;if(i.breakpointWidth!=null)T=i.breakpointWidth;else{let g=0,D=0;for(let M=m.cards.length-1;M>=0;M--){const U=m.cards[M],K=Ye(U.config.minContentWidth,Ve)+D;g=Math.max(g,K),D+=U.rightStackHeaderWidth}T=g}let z=d;const I=p(()=>{const g=m.container.width||m.viewport.width||Dt,D=m.container.height||m.viewport.height||ot,M=m.viewport.width||Dt,U=m.viewport.height||ot;let K=d;if(d==="right"){const k=Math.max(0,T-Zt),q=T+Zt,A=()=>{let J=0;for(let ne=0;ne<m.cards.length;ne++){const R=m.cards[ne],l=Ye(R.config.minContentWidth,Ve),o=g-J;if(l>o+dn)return!0;J+=R.rightStackHeaderWidth}return!1},Y=M<k,te=g<k;if(z==="down"){const J=M>q,ne=g>q&&!A();K=J&&ne?"right":"down"}else K=Y||te||A()?"down":"right"}z=K;let Z=0,W=0;const $=[];if(K==="right"){let k=0;for(let q=0;q<m.cards.length;q++)$[q]=Math.max(0,g-k),k+=m.cards[q].rightStackHeaderWidth}const S=m.cards.map((k,q)=>{const{config:A}=k,Y=K==="right",te=Y?k.rightStackHeaderWidth:k.downStackHeaderHeight;let J;if(Y){const o=Ye(A.minContentWidth,Ve),f=Math.max(0,$[q]??g);let Q=o;A.minContentWidth!=null&&(Q=Math.max(Q,Ye(A.minContentWidth,0)));const L=A.maxContentWidth!=null?Ye(A.maxContentWidth,1/0):1/0;if(Number.isFinite(L)&&(Q=Math.min(Q,L)),q===m.cards.length-1){const V=Math.min(f,L);Q=Math.max(Q,V)}J=Math.min(Q,f)}else{const o=tn(A.contentHeight,{viewportHeight:U,fallback:Ve});J=Math.min(o,D)}const ne=te,R=k.isFocused?J+a:ne,l={zIndex:String(k.zIndex)};return Y?(l.left=`${Z}px`,l.top="0px",l.width=`${J}px`,l.height="100%"):(l.left="0px",l.top=`${Z}px`,l.width="100%",l.height=`${J}px`),l["--panel-header-size"]=`${te}px`,l["--panel-main-size"]=`${J}px`,l["--panel-collapsed-main"]=`${ne}px`,l["--panel-active-min"]=`${R}px`,W=Math.max(W,Z+J),Z+=R,{...k,activeMin:R,mainSpan:J,style:l}});return{stackDirection:K,cards:S,totalSpan:W,activeCardId:m.cards.find(k=>k.isFocused)?.id??C}});function h(g,D){const M=g||(typeof window<"u"?window.innerWidth:Dt),U=D||(typeof window<"u"?window.innerHeight:ot);Re(m.viewport.width,M,yt)&&(m.viewport.width=M),Re(m.viewport.height,U,yt)&&(m.viewport.height=U)}function b(g,D){Ge(g)&&g>0&&Re(m.container.width,g,yt)&&(m.container.width=g),Ge(D)&&D>0&&Re(m.container.height,D,yt)&&(m.container.height=D)}function j(g){m.cards.forEach(D=>{D.isFocused=g?D.id===g:!1})}function N(g,D,M){const U=m.cards.find(K=>K.id===g);U&&(Ge(D)&&D>0&&Re(U.contentWidth,D,Xt)&&(U.contentWidth=D),Ge(M)&&M>0&&Re(U.contentHeight,M,Xt)&&(U.contentHeight=M))}function w(g,D,M){const U=m.cards.find(K=>K.id===g);if(U){if(Ge(D)&&D>0){const K=en(D,y.horizontal,r.horizontal);Re(U.rightStackHeaderWidth,K,Qt)&&(U.rightStackHeaderWidth=K)}if(Ge(M)&&M>0){const K=en(M,y.vertical,r.vertical);Re(U.downStackHeaderHeight,K,Qt)&&(U.downStackHeaderHeight=K)}}}return{layout:I,setViewport:h,setContainerSize:b,setFocusedCard:j,updateCardMetrics:N,updateCardHeader:w}}const wt=Symbol("panel-layout-hooks"),Hs={ipList:{id:"ipList",minContentWidth:500,contentHeight:"60vh",zIndex:1},topicList:{id:"topicList",minContentWidth:560,contentHeight:"60vh",zIndex:2},messageList:{id:"messageList",minContentWidth:720,contentHeight:"80vh",zIndex:3}};function Bs(i){return{...i}}function Fs(i){const s=i.map(y=>Bs(Hs[y])),a=Ds({cards:s,defaultStackDirection:"right",activeBuffer:20});return{layout:p(()=>{const y=a.layout.value;return{stackDirection:y.stackDirection,panels:y.cards.map(r=>({...r,id:r.id})),totalSpan:y.totalSpan,activePanelId:y.activeCardId?y.activeCardId:null}}),setViewport:a.setViewport,setContainerSize:a.setContainerSize,setFocusedPanel:a.setFocusedCard,updatePanelHeader:a.updateCardHeader}}let Ht=null,Bt=null;function nn(i,s){const a=Math.max(s*1.6,220);if(typeof window>"u")return a;Ht||(Ht=document.createElement("canvas")),Bt||(Bt=Ht.getContext("2d"));const d=Bt;if(!d)return a;const r=window.getComputedStyle(document.body).font||'14px "Inter", "Segoe UI", system-ui, sans-serif';d.font=r;let C=0;return i.forEach(T=>{if(!T?.label)return;const z=d.measureText(T.label);C=Math.max(C,z.width)}),Math.max(a,Math.ceil(C+96))}const sn="control-button--overlay-hidden",bt="__overlay__none__",jt=Ft("controlOverlay",()=>{const i=re({top:0,left:0,width:0,height:0}),s=E(!1),a=E(!1),d=E(!1),y=E(""),r=E("filter"),C=E(""),m=E(""),T=E(""),z=E([]),I=E("left"),h=E(0),b=E(220),j=E(!1),N=E(!1),w=gt(null),g=E(!1);let D=null;const M=gt(null),U=gt(null),K=gt(null);function Z(L){const V=L.getBoundingClientRect();i.top=V.top,i.left=V.left,i.width=V.width,i.height=V.height}let W=null;function $(){W!==null&&(window.clearTimeout(W),W=null)}function S(){D!==null&&(window.clearTimeout(D),D=null),g.value=!1}function k(L=260){S(),g.value=!0,D=window.setTimeout(()=>{g.value=!1,D=null},L)}function q(L){if(!L)return;const V=L.dataset;V.overlayPrevAria||(V.overlayPrevAria=L.getAttribute("aria-hidden")??bt),V.overlayPrevTabindex||(V.overlayPrevTabindex=L.getAttribute("tabindex")??bt),L.setAttribute("aria-hidden","true"),L.setAttribute("tabindex","-1"),V.overlayHidden="true",L.classList.add(sn)}function A(L){if(!L)return;const V=L.dataset;L.classList.remove(sn),V.overlayHidden&&delete V.overlayHidden,V.overlayPrevAria?(V.overlayPrevAria===bt?L.removeAttribute("aria-hidden"):L.setAttribute("aria-hidden",V.overlayPrevAria),delete V.overlayPrevAria):L.removeAttribute("aria-hidden"),V.overlayPrevTabindex?(V.overlayPrevTabindex===bt?L.removeAttribute("tabindex"):L.setAttribute("tabindex",V.overlayPrevTabindex),delete V.overlayPrevTabindex):L.removeAttribute("tabindex")}function Y(L){const V=w.value,fe=V!==null&&V!==L.anchorEl,Te=s.value;fe&&A(V),w.value=L.anchorEl,Z(L.anchorEl),q(L.anchorEl),y.value=L.controlId,r.value=L.variant,C.value=L.label,m.value=L.icon,T.value=L.value,z.value=L.options?.slice()??[],I.value=L.align??"left";const me=L.collapsedWidth??i.width;h.value=me,j.value=L.collapsedWidth!=null,L.expandedWidth!=null?(b.value=Math.max(L.expandedWidth,me),N.value=!0):L.variant==="sort"?(b.value=Math.max(nn(z.value,me),me),N.value=!1):(b.value=Math.max(i.width*4,220,me),N.value=!1),M.value=L.onInput??null,U.value=L.onCommit??null,K.value=L.onCancel??null,$();const ke=fe&&Te;d.value=!1,ke?(k(),a.value=!0,s.value=!0):(S(),a.value=!1,s.value=!0)}function te(L){T.value=L,M.value?.(L)}function J(L){const V=L??T.value;T.value=V,U.value?.(V),l()}function ne(){s.value&&($(),d.value=!1,a.value=!0)}function R(L=160){s.value&&($(),W=window.setTimeout(()=>{W=null,l()},L))}function l(L=!1){if(s.value&&($(),!(d.value&&!L))){if(L){a.value=!1,d.value=!1,s.value=!1,f();return}d.value||(a.value=!1,d.value=!0)}}function o(){K.value?.(),l()}function f(){$(),S(),w.value&&A(w.value),w.value=null,s.value=!1,d.value=!1,a.value=!1,y.value="",j.value=!1,N.value=!1,M.value=null,U.value=null,K.value=null}function Q(){w.value&&(Z(w.value),j.value||(h.value=i.width),N.value||(r.value==="sort"?b.value=Math.max(nn(z.value,h.value),h.value):b.value=Math.max(i.width*4,220,h.value)))}return{rect:i,visible:s,expanded:a,closing:d,relocating:g,controlId:y,variant:r,label:C,icon:m,value:T,options:z,align:I,collapsedWidth:h,expandedWidth:b,open:Y,updateValue:te,commit:J,requestClose:l,cancel:o,finalize:f,refreshAnchorRect:Q,beginInteraction:ne,scheduleClose:R}}),zs={key:0,class:"panel-rail__meta"},Us={class:"panel-rail__controls"},Ws={class:"panel-rail__actions"},Os=["title"],Ns=["title"],Ks=["disabled"],js=["disabled"],Vs={class:"panel-main"},Gs={class:"panel-header__primary"},Ys={key:0,class:"panel-header__count"},Js={class:"panel-header__controls"},Qs={class:"panel-header__actions"},Xs=["title"],Zs=["title"],eo=["disabled"],to=["disabled"],no={class:"panel-content ip-list"},so=["onClick"],oo={class:"ip-item__header"},lo={class:"ip-item__identity"},ao={class:"ip-item__name"},ro={key:0,class:"ip-item__alias"},io={class:"ip-item__alias-text"},uo={class:"ip-item__alias-popover"},co=["title"],po={class:"ip-item__metrics"},vo={key:0,class:"empty-state"},fo={class:"panel-footer"},mo=["disabled"],ho={class:"page-info"},go=["disabled"],yo=ce({__name:"IpListPanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(i,{expose:s,emit:a}){const d=i,y=a,r=qe(),C=_e(),m=p(()=>r.paginatedIps),T=p(()=>r.selectedIp),z=p(()=>Math.max(1,Math.ceil(r.sortedIpList.length/r.ipPageSize))),I=p(()=>r.sortedIpList.length),h=p(()=>r.ipFilter.trim().length>0),b=Nt(),j=[{value:"recent",label:"最近活跃"},{value:"reqs",label:"请求数"},{value:"in",label:"入流量"},{value:"out",label:"出流量"}],N=j[0]?.value??"",w=E(null),g=E(null),D=Wt(wt,null),M=jt(),U=E(null),K=E(null),Z=p(()=>d.collapsed===!0),W=p(()=>j.find(l=>l.value===r.ipSortKey)?.label??"最近活跃");D?.ipList&&(Fe(w,R=>{const l=R[0];if(!l)return;const o=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:l.borderBoxSize,f=o?o.inlineSize:l.contentRect.width;f>0&&D.ipList.reportHeaderSize({width:f,height:0})}),Fe(g,R=>{const l=R[0];if(!l)return;const o=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:l.borderBoxSize,f=o?o.blockSize:l.contentRect.height;f>0&&D.ipList.reportHeaderSize({width:0,height:f})}));function $(R){r.setSelectedIp(R)}function S(){y("request-focus")}function k(R,l){const o=R?.currentTarget;return o instanceof HTMLElement?o:l}function q(R){const l=k(R,U.value);if(!l)return;if(M.visible&&M.controlId==="ip-filter")if(M.closing)M.finalize();else{M.refreshAnchorRect();return}const o=r.ipFilter;M.open({controlId:"ip-filter",anchorEl:l,variant:"filter",label:"过滤 IP",icon:"search",value:o,expandedWidth:280,onInput(f){r.ipFilter=f},onCommit(f){r.ipFilter=f.trim()},onCancel(){r.ipFilter=o}})}function A(R){const l=k(R,K.value);if(!l)return;if(M.visible&&M.controlId==="ip-sort")if(M.closing)M.finalize();else{M.refreshAnchorRect();return}const o=r.ipSortKey;M.open({controlId:"ip-sort",anchorEl:l,variant:"sort",label:"排序方式",icon:"sort",value:r.ipSortKey,options:j,onCommit(f){r.ipSortKey=f},onCancel(){r.ipSortKey=o}})}function Y(R){const{lModReqAt:l,lTopUpdAt:o}=R.summary,f=l??o;return b.value,f?Ot(f):"—"}function te(R){const{lModReqAt:l,lTopUpdAt:o}=R.summary,f=l??o;return f?Me(f):"—"}async function J(){if(!(!T.value||!await C.confirm({title:"删除 IP 数据",message:`确定要删除 IP “${T.value}” 的所有话题和消息吗？该操作不可恢复。`,confirmLabel:"删除",destructive:!0})))try{await r.removeIp(T.value),C.pushToast({type:"success",title:"删除成功",message:"IP 数据已清理。"})}catch(l){C.pushToast({type:"error",title:"删除失败",message:l instanceof Error?l.message:String(l)})}}function ne(){M.visible&&(M.controlId==="ip-filter"||M.controlId==="ip-sort")&&M.requestClose()}return s({resetToCollapsedState:ne}),(R,l)=>(u(),c("section",{class:le(["panel panel--ip",{"panel--collapsed":Z.value}]),onMouseenter:S,onFocusin:S,onPointerdownCapture:S},[i.stackDirection==="right"?(u(),c("aside",{key:0,ref_key:"desktopHeaderEl",ref:w,class:"panel-rail panel-rail--desktop"},[l[29]||(l[29]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"IP 列表",-1)),I.value?(u(),c("div",zs,[e("strong",null,_(I.value),1),l[28]||(l[28]=e("span",null,"IP",-1))])):B("",!0),e("div",Us,[e("div",Ws,[e("button",{ref_key:"filterTriggerEl",ref:U,class:le(["control-button control-button--icon",{"control-button--active":h.value}]),type:"button","aria-label":"过滤 IP",title:h.value?`过滤：${x(r).ipFilter}`:"过滤 IP",onMouseenter:l[0]||(l[0]=o=>q(o)),onFocus:l[1]||(l[1]=o=>q(o)),onClick:l[2]||(l[2]=o=>q(o)),onKeydown:[l[3]||(l[3]=de(X(o=>q(o),["prevent"]),["enter"])),l[4]||(l[4]=de(X(o=>q(o),["prevent"]),["space"]))]},[P(H,{name:"search"})],42,Os),e("button",{ref_key:"sortTriggerEl",ref:K,class:le(["control-button control-button--icon",{"control-button--active":x(r).ipSortKey!==x(N)}]),type:"button","aria-label":"排序方式",title:`排序：${W.value}`,onMouseenter:l[5]||(l[5]=o=>A(o)),onFocus:l[6]||(l[6]=o=>A(o)),onClick:l[7]||(l[7]=o=>A(o)),onKeydown:[l[8]||(l[8]=de(X(o=>A(o),["prevent"]),["enter"])),l[9]||(l[9]=de(X(o=>A(o),["prevent"]),["space"]))]},[P(H,{name:"sort"})],42,Ns),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新","aria-label":"刷新",disabled:x(r).loadingFullStats,onClick:l[10]||(l[10]=(...o)=>x(r).refreshFullStats&&x(r).refreshFullStats(...o))},[P(H,{name:"sync"})],8,Ks),e("button",{class:"control-button control-button--icon",type:"button",title:"封禁管理","aria-label":"封禁管理",onClick:l[11]||(l[11]=o=>x(C).toggleBanManager(!0))},[P(H,{name:"gpp_maybe"})]),e("button",{class:"control-button control-button--icon",type:"button",title:"别名管理","aria-label":"别名管理",onClick:l[12]||(l[12]=o=>x(C).toggleAliasManager(!0))},[P(H,{name:"key"})]),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除当前 IP","aria-label":"删除当前 IP",disabled:!T.value,onClick:J},[P(H,{name:"delete"})],8,js)])])],512)):B("",!0),e("div",Vs,[i.stackDirection==="down"?(u(),c("header",{key:0,ref_key:"mobileHeaderEl",ref:g,class:"panel-header panel-header--mobile"},[e("div",Gs,[l[30]||(l[30]=e("h2",null,"IP 列表",-1)),I.value?(u(),c("span",Ys,_(I.value),1)):B("",!0)]),e("div",Js,[e("div",Qs,[e("button",{class:le(["control-button control-button--icon",{"control-button--active":h.value}]),type:"button","aria-label":"过滤 IP",title:h.value?`过滤：${x(r).ipFilter}`:"过滤 IP",onMouseenter:l[13]||(l[13]=o=>q(o)),onFocus:l[14]||(l[14]=o=>q(o)),onClick:l[15]||(l[15]=o=>q(o)),onKeydown:[l[16]||(l[16]=de(X(o=>q(o),["prevent"]),["enter"])),l[17]||(l[17]=de(X(o=>q(o),["prevent"]),["space"]))]},[P(H,{name:"search"})],42,Xs),e("button",{class:le(["control-button control-button--icon",{"control-button--active":x(r).ipSortKey!==x(N)}]),type:"button","aria-label":"排序方式",title:`排序：${W.value}`,onMouseenter:l[18]||(l[18]=o=>A(o)),onFocus:l[19]||(l[19]=o=>A(o)),onClick:l[20]||(l[20]=o=>A(o)),onKeydown:[l[21]||(l[21]=de(X(o=>A(o),["prevent"]),["enter"])),l[22]||(l[22]=de(X(o=>A(o),["prevent"]),["space"]))]},[P(H,{name:"sort"})],42,Zs),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新","aria-label":"刷新",disabled:x(r).loadingFullStats,onClick:l[23]||(l[23]=(...o)=>x(r).refreshFullStats&&x(r).refreshFullStats(...o))},[P(H,{name:"sync"})],8,eo),e("button",{class:"control-button control-button--icon",type:"button",title:"封禁管理","aria-label":"封禁管理",onClick:l[24]||(l[24]=o=>x(C).toggleBanManager(!0))},[P(H,{name:"gpp_maybe"})]),e("button",{class:"control-button control-button--icon",type:"button",title:"别名管理","aria-label":"别名管理",onClick:l[25]||(l[25]=o=>x(C).toggleAliasManager(!0))},[P(H,{name:"key"})]),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除当前 IP","aria-label":"删除当前 IP",disabled:!T.value,onClick:J},[P(H,{name:"delete"})],8,to)])])],512)):B("",!0),e("div",no,[(u(!0),c(ie,null,be(m.value,o=>(u(),c("article",{key:o.ip,class:le(["ip-item",{"ip-item--active":o.ip===T.value,"ip-item--unread":o.unread}]),onClick:f=>$(o.ip)},[e("div",oo,[e("div",lo,[e("span",ao,_(o.ip),1),o.summary.realIPs?.length?(u(),c("span",ro,[e("span",io,"真实 IP ×"+_(o.summary.realIPs.length),1),e("span",uo,[l[31]||(l[31]=e("strong",null,"真实 IP",-1)),e("ul",null,[(u(!0),c(ie,null,be(o.summary.realIPs,f=>(u(),c("li",{key:f},_(f),1))),128))])])])):B("",!0)]),e("span",{class:"badge badge--ghost",title:te(o)},_(Y(o)),9,co)]),e("div",po,[e("dl",null,[l[32]||(l[32]=e("dt",null,"请求",-1)),e("dd",null,_(x(rn)(o.summary.reqs)),1)]),e("dl",null,[l[33]||(l[33]=e("dt",null,"入流量",-1)),e("dd",null,_(x(we)(o.summary.inTfc)),1)]),e("dl",null,[l[34]||(l[34]=e("dt",null,"出流量",-1)),e("dd",null,_(x(we)(o.summary.outTfc)),1)])])],10,so))),128)),m.value.length?B("",!0):(u(),c("div",vo,[...l[35]||(l[35]=[e("p",null,"暂无 IP 数据",-1)])]))]),e("footer",fo,[e("button",{class:"control-button control-button--icon",disabled:x(r).ipPage<=1,"aria-label":"上一页",title:"上一页",onClick:l[26]||(l[26]=o=>x(r).ipPage--)},[P(H,{name:"chevron_left"})],8,mo),e("span",ho,"第 "+_(x(r).ipPage)+" 页 / 共 "+_(z.value)+" 页",1),e("button",{class:"control-button control-button--icon",disabled:x(r).ipPage>=z.value,"aria-label":"下一页",title:"下一页",onClick:l[27]||(l[27]=o=>x(r).ipPage++)},[P(H,{name:"chevron_right"})],8,go)])])],34))}}),bo=ve(yo,[["__scopeId","data-v-3a2bb42f"]]),_o={key:0,class:"panel-rail__meta"},ko=["title"],wo={key:1,class:"panel-rail__meta panel-rail__meta--empty"},To={class:"panel-rail__controls"},Co={class:"panel-rail__actions"},$o=["title","disabled"],So=["disabled"],Mo=["disabled"],xo={class:"panel-main"},Io={class:"panel-header__title"},Ao={class:"panel-header__primary"},Po={key:0,class:"panel-header__count"},Eo={key:0,class:"panel-header__hint"},Ro={key:1,class:"panel-header__hint"},qo={class:"panel-header__controls"},Lo={class:"panel-header__actions"},Do=["title","disabled"],Ho=["disabled"],Bo=["disabled"],Fo={class:"panel-content topic-list"},zo=["onClick"],Uo={class:"topic-item__header"},Wo={class:"topic-item__identity"},Oo={class:"topic-item__title-group"},No=["title"],Ko={key:0,class:"badge badge--ghost"},jo=["title"],Vo={class:"topic-item__stats"},Go={key:0,class:"empty-state"},Yo={class:"panel-footer"},Jo=["disabled"],Qo={class:"page-info"},Xo=["disabled"],Zo=ce({__name:"TopicListPanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(i,{expose:s,emit:a}){const d=i,y=a,r=qe(),C=_e(),m=p(()=>r.selectedIp),T=p(()=>r.selectedTopic),z=p(()=>r.paginatedTopics),I=p(()=>Math.max(1,Math.ceil(r.currentIpTopics.length/r.topicPageSize))),h=p(()=>r.currentIpTopics.length),b=p(()=>r.topicFilter.trim().length>0),j=p(()=>{const l=m.value;return l?r.loadingTopics.get(l)===!0:!1}),N=Nt(),w=E(null),g=E(null),D=Wt(wt,null),M=jt(),U=E(null),K=p(()=>d.collapsed===!0);pe(m,l=>{!l&&M.visible&&M.controlId==="topic-filter"&&M.cancel()}),D?.topicList&&(Fe(w,l=>{const o=l[0];if(!o)return;const f=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize,Q=f?f.inlineSize:o.contentRect.width;Q>0&&D.topicList.reportHeaderSize({width:Q,height:0})}),Fe(g,l=>{const o=l[0];if(!o)return;const f=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize,Q=f?f.blockSize:o.contentRect.height;Q>0&&D.topicList.reportHeaderSize({width:0,height:Q})}));function Z(l){r.setSelectedTopic(l)}function W(){y("request-focus")}function $(l,o){const f=l?.currentTarget;return f instanceof HTMLElement?f:o}function S(l){if(!m.value)return;const o=$(l,U.value);if(!o)return;if(M.visible&&M.controlId==="topic-filter")if(M.closing)M.finalize();else{M.refreshAnchorRect();return}const f=r.topicFilter;M.open({controlId:"topic-filter",anchorEl:o,variant:"filter",label:"过滤话题",icon:"search",value:f,expandedWidth:280,onInput(Q){r.topicFilter=Q},onCommit(Q){r.topicFilter=Q.trim()},onCancel(){r.topicFilter=f}})}function k(l){return N.value,Ot(l)}function q(l){const o=l.title;return typeof o=="string"&&o.trim().length>0?o.trim():null}function A(l){return q(l)??l.tid}function Y(l){const o=q(l);return o?`${o} (ID: ${l.tid})`:l.tid}function te(l){const o=m.value;return o?r.isTopicUnread(o,l.tid):!1}async function J(){m.value&&await r.ensureTopics(m.value,!0)}async function ne(){if(!(!m.value||!T.value||!await C.confirm({title:"删除话题",message:`确定永久删除话题 “${T.value}” 吗？该操作不可恢复。`,confirmLabel:"删除",destructive:!0})))try{await r.removeTopics(m.value,[T.value]),C.pushToast({type:"success",title:"删除成功",message:"话题已删除。"})}catch(o){C.pushToast({type:"error",title:"删除失败",message:o instanceof Error?o.message:String(o)})}}function R(){M.visible&&M.controlId==="topic-filter"&&M.requestClose()}return s({resetToCollapsedState:R}),(l,o)=>(u(),c("section",{class:le(["panel panel--topic",{"panel--collapsed":K.value}]),onMouseenter:W,onFocusin:W,onPointerdownCapture:W},[i.stackDirection==="right"?(u(),c("aside",{key:0,ref_key:"desktopRailEl",ref:w,class:"panel-rail panel-rail--desktop"},[o[14]||(o[14]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"话题列表",-1)),m.value?(u(),c("div",_o,[e("strong",null,_(h.value),1),o[12]||(o[12]=e("span",null,"话题",-1)),e("div",{class:"panel-rail__hint",title:m.value},"IP "+_(m.value),9,ko)])):(u(),c("div",wo,[...o[13]||(o[13]=[e("span",null,"等待",-1),e("span",null,"选择 IP",-1)])])),e("div",To,[e("div",Co,[e("button",{ref_key:"filterTriggerEl",ref:U,class:le(["control-button control-button--icon",{"control-button--active":b.value}]),type:"button","aria-label":"过滤话题",title:b.value?`过滤：${x(r).topicFilter}`:"过滤话题",disabled:!m.value,onMouseenter:o[0]||(o[0]=f=>S(f)),onFocus:o[1]||(o[1]=f=>S(f)),onClick:o[2]||(o[2]=f=>S(f)),onKeydown:[o[3]||(o[3]=de(X(f=>S(f),["prevent"]),["enter"])),o[4]||(o[4]=de(X(f=>S(f),["prevent"]),["space"]))]},[P(H,{name:"search"})],42,$o),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新话题","aria-label":"刷新话题",disabled:!m.value||j.value,onClick:J},[P(H,{name:"sync"})],8,So),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除话题","aria-label":"删除话题",disabled:!T.value,onClick:ne},[P(H,{name:"delete"})],8,Mo)])])],512)):B("",!0),e("div",xo,[i.stackDirection==="down"?(u(),c("header",{key:0,ref_key:"mobileHeaderEl",ref:g,class:"panel-header panel-header--mobile"},[e("div",Io,[e("div",Ao,[o[15]||(o[15]=e("h2",null,"话题列表",-1)),m.value?(u(),c("span",Po,_(h.value),1)):B("",!0)]),m.value?(u(),c("p",Eo,_(h.value)+" 个话题 · IP "+_(m.value),1)):(u(),c("p",Ro,"等待选择 IP"))]),e("div",qo,[e("div",Lo,[e("button",{class:le(["control-button control-button--icon",{"control-button--active":b.value}]),type:"button","aria-label":"过滤话题",title:b.value?`过滤：${x(r).topicFilter}`:"过滤话题",disabled:!m.value,onMouseenter:o[5]||(o[5]=f=>S(f)),onFocus:o[6]||(o[6]=f=>S(f)),onClick:o[7]||(o[7]=f=>S(f)),onKeydown:[o[8]||(o[8]=de(X(f=>S(f),["prevent"]),["enter"])),o[9]||(o[9]=de(X(f=>S(f),["prevent"]),["space"]))]},[P(H,{name:"search"})],42,Do),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新话题","aria-label":"刷新话题",disabled:!m.value||j.value,onClick:J},[P(H,{name:"sync"})],8,Ho),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除话题","aria-label":"删除话题",disabled:!T.value,onClick:ne},[P(H,{name:"delete"})],8,Bo)])])],512)):B("",!0),e("div",Fo,[(u(!0),c(ie,null,be(z.value,f=>(u(),c("article",{key:f.tid,class:le(["topic-item",{"topic-item--active":f.tid===T.value,"topic-item--unread":te(f)}]),onClick:Q=>Z(f.tid)},[e("header",Uo,[e("div",Wo,[e("div",Oo,[e("span",{class:"topic-item__title",title:Y(f)},_(A(f)),9,No)]),f.status?(u(),c("span",Ko,_(f.status),1)):B("",!0)]),e("span",{class:"badge badge--ghost",title:x(Me)(f.upAt)},_(k(f.upAt)),9,jo)]),e("div",Vo,[e("dl",null,[o[16]||(o[16]=e("dt",null,"消息",-1)),e("dd",null,_(f.msgCnt),1)]),e("dl",null,[o[17]||(o[17]=e("dt",null,"入流量",-1)),e("dd",null,_(x(we)(f.inBytes)),1)]),e("dl",null,[o[18]||(o[18]=e("dt",null,"出流量",-1)),e("dd",null,_(x(we)(f.outBytes)),1)]),e("dl",null,[o[19]||(o[19]=e("dt",null,"创建",-1)),e("dd",null,_(x(Me)(f.ctAt)),1)])])],10,zo))),128)),z.value.length?B("",!0):(u(),c("div",Go,[...o[20]||(o[20]=[e("p",null,"请选择左侧 IP 以查看话题。",-1)])]))]),e("footer",Yo,[e("button",{class:"control-button control-button--icon",type:"button",title:"上一页","aria-label":"上一页",disabled:x(r).topicPage<=1,onClick:o[10]||(o[10]=f=>x(r).topicPage--)},[P(H,{name:"chevron_left"})],8,Jo),e("span",Qo,"第 "+_(x(r).topicPage)+" 页 / 共 "+_(I.value)+" 页",1),e("button",{class:"control-button control-button--icon",type:"button",title:"下一页","aria-label":"下一页",disabled:x(r).topicPage>=I.value,onClick:o[11]||(o[11]=f=>x(r).topicPage++)},[P(H,{name:"chevron_right"})],8,Xo)])])],34))}}),el=ve(Zo,[["__scopeId","data-v-0fd30b99"]]),tl={class:"message-card__header"},nl={class:"message-card__meta"},sl={class:"badge badge--role"},ol=["title"],ll={key:0,class:"badge badge--ghost",title:"Tokens"},al={key:0,class:"message-card__request-info"},rl={class:"request-info__label"},il={class:"request-info__content"},ul=["data-open"],cl={key:0,class:"request-body__loading"},dl={key:1,class:"request-body__error"},pl={key:3,class:"request-body__empty"},vl=["data-open"],fl={key:0,class:"request-body__loading"},ml={key:1,class:"request-body__error"},hl={key:3,class:"request-body__empty"},gl={key:0,class:"message-card__model-meta"},yl={key:0,class:"meta-item"},bl={class:"meta-value"},_l={key:1,class:"meta-item"},kl={class:"meta-value"},wl={key:2,class:"meta-item"},Tl={class:"meta-value"},Cl={key:3,class:"meta-item"},$l={class:"token-details"},Sl={key:0},Ml={key:1},xl={key:2},Il={key:3},Al={key:4,class:"token-breakdown"},Pl={class:"token-breakdown__list"},El={class:"token-breakdown__item-label"},Rl={class:"token-breakdown__item-value"},ql={key:4,class:"meta-item"},Ll={class:"meta-value"},Dl={key:1,class:"message-card__model-error"},Hl={class:"model-error__header"},Bl={key:0,class:"model-error__summary"},Fl=["data-open"],zl={key:0,class:"loading-dot loading-dot--inline"},Ul=["data-loading"],Wl={key:0,class:"model-json__loading"},Ol={key:1,class:"model-json__error"},Nl={key:3,class:"model-json__empty"},Kl={key:4,class:"model-json__placeholder"},jl=ce({__name:"MessageCard",props:{message:{},rootEl:{}},setup(i){const s=i,a=qe(),d=_e();E(!1);const y=E(!1),r=E(!1),C=E(null),m=E(null),T=E(!1),z=E(!1),I=E(null),h=re({loading:!1,loaded:!1,error:null,data:null,raw:null}),b=re({loading:!1,loaded:!1,error:null,data:null,raw:null}),j=p(()=>a.getMessageDetail(s.message.id)),N=p(()=>j.value?.meta?.tokens?.totTokCnt??s.message.meta?.tokens?.totTokCnt??null),w=p(()=>a.getMessageRequestBody(s.message.id)),g=p(()=>a.getMessageRequestHeaders(s.message.id)),D=p(()=>j.value?.reqUrl??s.message.reqUrl??w.value?.requestUrl??g.value?.requestUrl??I.value??null),M=p(()=>j.value?.hasReqBody??s.message.hasReqBody??!1),U=p(()=>j.value?.hasReqHeaders??s.message.hasReqHeaders??!1),K=p(()=>{if(h.loaded)return h.data??h.raw??null;const t=w.value;return t?t.requestBody??t.rawRequestBody??null:null}),Z=p(()=>b.loaded?b.data:g.value?.requestHeaders??null),W=p(()=>b.loaded?b.raw:g.value?.rawRequestHeaders??null),$=p(()=>Z.value??W.value),S=p(()=>{const t=Z.value;return t?Object.keys(t).length:null}),k=p(()=>b.loading||b.error||U.value?!0:De($.value)),q=p(()=>h.loading||h.error||M.value?!0:De(K.value)),A=p(()=>h.loading),Y=p(()=>h.error),te=p(()=>b.loading),J=p(()=>b.error),ne=p(()=>De(K.value)),R=p(()=>De($.value)),l=p(()=>ne.value?He(K.value):""),o=p(()=>R.value?He($.value):""),f=p(()=>{if(s.message.role!=="model")return null;const t=j.value?.meta??s.message.meta;if(!t)return null;const n=t.tokens??null,v=(se,et)=>{if(!se||typeof se!="object")return null;for(const ht of et){const je=se[ht];if(je==null)continue;const tt=Number(je);if(Number.isFinite(tt))return tt;if(typeof je=="number")return je}return null},F=v(n,["promptTokenCount","pTokCnt","promptTokensCount"]),ee=v(n,["candidatesTokenCount","candTokCnt"]),O=v(n,["thoughtsTokenCount","thgtTokCnt","thinkingTokenCount"]),Be=v(n,["totalTokenCount","totTokCnt","totalTokensCount"]),Oe=n?.promptTokensDetails??n?.promptTokenDetails??n?.prompt_tokens_details??null,Ne=Array.isArray(Oe)?Oe.map(se=>{if(!se||typeof se!="object")return null;const et=se.modality??se.type??se.modalityType??se.name,ht=typeof et=="string"&&et.trim().length?et.trim():null,tt=(()=>{for(const nt of["tokenCount","tokens","count","value","tokenCounts"]){if(se[nt]===void 0||se[nt]===null)continue;const Vt=Number(se[nt]);if(Number.isFinite(Vt))return Vt;if(typeof se[nt]=="number")return se[nt]}return null})();return!ht&&tt===null?null:{label:ht??"Prompt",tokenCount:tt}}).filter(se=>!!se):null,ye={promptTokenCount:F,candidatesTokenCount:ee,thoughtsTokenCount:O,totalTokenCount:Be,promptTokensDetails:Ne&&Ne.length?Ne:null},Ze=[F,ee,O,Be].some(se=>se!=null)||!!(ye.promptTokensDetails&&ye.promptTokensDetails.length),mt=t.finishReason??n?.finishReason??null,he=t.status;let ge=null;if(typeof he=="number"&&Number.isFinite(he))ge=he;else if(typeof he=="string"){const se=Number(he);ge=Number.isFinite(se)?se:he}else he!=null&&(ge=he);const ae=typeof t.statusText=="string"&&t.statusText.trim().length?t.statusText:null,fn=t.modelName??t.modelVer??t.model??null,Ke=t.errCode;let qt=null;typeof Ke=="string"||typeof Ke=="number"?qt=Ke:Ke!=null&&(qt=String(Ke));const mn=!!(t.hasErrDetails??t.hasErrorDetails??t.hasErrDetail??!1);return{status:ge,statusText:ae,modelName:fn,tokens:Ze?ye:null,finishReason:mt??null,errMsg:typeof t.errMsg=="string"?t.errMsg:null,errStatus:typeof t.errStatus=="string"?t.errStatus:null,errCode:qt,hasErrorDetails:mn}}),Q=p(()=>f.value?.status??null),L=p(()=>{const t=Q.value,n=Number(t);return Number.isFinite(n)?n:null}),V=p(()=>{const t=Q.value,n=f.value?.statusText?.trim()??"",v=t!=null?String(t):"";return v&&n?v.toLowerCase()===n.toLowerCase()?v:`${v} ${n}`:v||n||null}),fe=p(()=>!!f.value?.hasErrorDetails),Te=p(()=>{const t=f.value;if(!t)return!1;const n=L.value;return!!(n!==null&&n>=400||typeof t.errStatus=="string"&&t.errStatus.trim().length||typeof t.errMsg=="string"&&t.errMsg.trim().length||(t.finishReason??"").toString().toLowerCase()==="error")}),me=p(()=>{if(Te.value)return"badge--error";const t=L.value;return t==null?"badge--ghost":t>=200&&t<300?"badge--success":"badge--ghost"}),ke=p(()=>{const t=f.value;if(!t)return null;const n=[];return t.errStatus&&n.push(t.errStatus),t.errCode!==null&&t.errCode!==void 0&&`${t.errCode}`.length&&n.push(`code ${t.errCode}`),t.errMsg&&n.push(t.errMsg),n.length?n.join(" · "):null}),Ce=p(()=>a.getModelErrorDetails(s.message.id)),G=re({loading:!1,loaded:!1,error:null,data:null,hasError:!1}),xe=E(!1),Le=p(()=>{if(G.loaded)return{hasError:G.hasError,error:G.data??null};const t=Ce.value;return t?{hasError:t.hasError??!1,error:t.error??null}:null}),Ie=p(()=>G.loading),ze=p(()=>G.error),Ae=p(()=>G.loaded||!!Ce.value),$e=p(()=>{const t=Le.value;return!t||!t.hasError?!1:De(t.error??null)}),Pe=p(()=>$e.value?He(Le.value?.error??null):""),Ee=p(()=>f.value?.tokens?.promptTokensDetails??null);function Ue(){G.loading=!1,G.loaded=!1,G.error=null,G.data=null,G.hasError=!1,xe.value=!1}async function ut(t=!1){if(fe.value&&!G.loading){if(!t){const n=Ce.value;if(n){G.data=n.error??null,G.hasError=n.hasError??!1,G.loaded=!0,G.error=null;return}if(G.loaded)return}G.loading=!0,G.error=null;try{const n=await a.loadModelErrorDetails(s.message.id,t);n?(G.data=n.error??null,G.hasError=n.hasError??!1,G.loaded=!0):(G.data=null,G.hasError=!1,G.loaded=!0)}catch(n){const v=n instanceof Error?n.message:String(n);G.error=v,G.loaded=!1,d.pushToast({type:"error",title:"错误详情加载失败",message:v})}finally{G.loading=!1}}}function Tt(t){const v=t.currentTarget?.open??!1;xe.value=v,v&&ut()}function Ct(){ut(!0)}function $t(){!$e.value||!Pe.value||We(Pe.value)}const St=p(()=>s.message.role==="user"?"用户":s.message.role==="model"?"模型":s.message.role==="system"?"系统":s.message.role),Mt=p(()=>({"message-card--user":s.message.role==="user","message-card--model":s.message.role==="model","message-card--state-error":s.message.role==="model"&&Te.value}));Kt(()=>s.message.ctAt??s.message.meta?.ctAt??null),p(()=>Me(s.message.ctAt??s.message.meta?.ctAt??Date.now()));const xt=p(()=>s.message.id.slice(0,8));p(()=>{const t=s.rootEl;return t?x(t)??void 0:void 0}),pe(()=>s.message.id,()=>{r.value=!1,y.value=!1,ct(),pt(),Ue()}),pe(fe,t=>{t||Ue()});function De(t){return t==null?!1:Array.isArray(t)?t.length>0:typeof t=="object"?Object.keys(t).length>0:typeof t=="string"?t.trim().length>0:!0}function He(t){try{return typeof t=="string"?t:JSON.stringify(t,null,2)}catch{return String(t)}}async function We(t){try{await navigator.clipboard.writeText(t),d.pushToast({type:"success",title:"已复制到剪贴板"})}catch(n){d.pushToast({type:"error",title:"复制失败",message:n instanceof Error?n.message:String(n)})}}function ct(){T.value=!1,h.loading=!1,h.loaded=!1,h.error=null,h.data=null,h.raw=null,I.value=null}async function dt(t=!1){if(!h.loading){if(!t){const n=w.value;if(n){h.data=n.requestBody??null,h.raw=n.rawRequestBody??null,h.loaded=!0,h.error=null,I.value=n.requestUrl??I.value;return}if(h.loaded||!M.value)return}h.loading=!0,h.error=null;try{const n=await a.loadMessageRequestBody(s.message.id,t);n?(h.data=n.requestBody??null,h.raw=n.rawRequestBody??null,I.value=n.requestUrl??I.value):(h.data=null,h.raw=null),h.loaded=!0}catch(n){const v=n instanceof Error?n.message:String(n);h.error=v,d.pushToast({type:"error",title:"请求体加载失败",message:v}),h.loaded=!1,h.data=null,h.raw=null}finally{h.loading=!1}}}function pt(){z.value=!1,b.loading=!1,b.loaded=!1,b.error=null,b.data=null,b.raw=null}async function vt(t=!1){if(!b.loading){if(!t){const n=g.value;if(n){b.data=n.requestHeaders??null,b.raw=n.rawRequestHeaders??null,b.loaded=!0,b.error=null,I.value=n.requestUrl??I.value;return}if(b.loaded||!U.value)return}b.loading=!0,b.error=null;try{const n=await a.loadMessageRequestHeaders(s.message.id,t);n?(b.data=n.requestHeaders??null,b.raw=n.rawRequestHeaders??null,I.value=n.requestUrl??I.value):(b.data=null,b.raw=null),b.loaded=!0}catch(n){const v=n instanceof Error?n.message:String(n);b.error=v,d.pushToast({type:"error",title:"请求头加载失败",message:v}),b.loaded=!1,b.data=null,b.raw=null}finally{b.loading=!1}}}function It(t){const v=t.currentTarget?.open??!1;T.value=v,v&&dt()}function At(){dt(!0)}function Pt(){ne.value&&We(l.value)}function Et(t){const v=t.currentTarget?.open??!1;z.value=v,v&&vt()}function Rt(){vt(!0)}function ft(){R.value&&We(o.value)}return(t,n)=>(u(),c("article",{ref_key:"cardEl",ref:C,class:le(["message-card",Mt.value])},[e("header",tl,[e("div",nl,[e("span",sl,_(St.value),1),e("span",{class:"badge badge--id",title:i.message.id},_(xt.value),9,ol),N.value?(u(),c("span",ll,_(N.value)+" tokens ",1)):B("",!0),V.value?(u(),c("span",{key:1,class:le(["badge",me.value])},_(V.value),3)):B("",!0)])]),i.message.role==="user"?(u(),c(ie,{key:0},[D.value?(u(),c("section",al,[e("header",rl,[P(H,{name:"link"}),n[0]||(n[0]=oe(" 请求 URL ",-1))]),e("div",il,[e("code",null,_(D.value),1)])])):B("",!0),k.value?(u(),c("details",{key:1,class:"message-card__request-section",onToggle:Et},[e("summary",null,[P(H,{name:"http"}),e("span",null,[n[1]||(n[1]=oe(" 请求头部 ",-1)),S.value!==null?(u(),c(ie,{key:0},[oe(" ("+_(S.value)+")",1)],64)):B("",!0)])]),e("div",{class:"request-section__content","data-open":z.value},[te.value?(u(),c("div",cl,[...n[2]||(n[2]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载请求头…",-1)])])):J.value?(u(),c("div",dl,[P(H,{name:"error"}),e("span",null,_(J.value),1),e("button",{class:"ghost-button",onClick:X(Rt,["stop"])},[P(H,{name:"refresh"}),n[3]||(n[3]=oe(" 重试加载 ",-1))])])):R.value?(u(),c(ie,{key:2},[e("pre",null,[e("code",null,_(o.value),1)]),e("button",{class:"ghost-button",onClick:ft},[P(H,{name:"content_copy"}),n[4]||(n[4]=oe(" 复制 ",-1))])],64)):(u(),c("div",pl,[...n[5]||(n[5]=[e("span",null,"没有可显示的请求头内容。",-1)])]))],8,ul)],32)):B("",!0),q.value?(u(),c("details",{key:2,ref_key:"requestBodyDetailsEl",ref:m,class:"message-card__request-section message-card__request-section--body",onToggle:It},[e("summary",null,[P(H,{name:"data_object"}),n[6]||(n[6]=e("span",null,"请求 Body",-1))]),e("div",{class:"request-section__content","data-open":T.value},[A.value?(u(),c("div",fl,[...n[7]||(n[7]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载请求体…",-1)])])):Y.value?(u(),c("div",ml,[P(H,{name:"error"}),e("span",null,_(Y.value),1),e("button",{class:"ghost-button",onClick:X(At,["stop"])},[P(H,{name:"refresh"}),n[8]||(n[8]=oe(" 重试加载 ",-1))])])):ne.value?(u(),c(ie,{key:2},[e("pre",null,[e("code",null,_(l.value),1)]),e("button",{class:"ghost-button",onClick:Pt},[P(H,{name:"content_copy"}),n[9]||(n[9]=oe(" 复制 ",-1))])],64)):(u(),c("div",hl,[...n[10]||(n[10]=[e("span",null,"没有可显示的请求体内容。",-1)])]))],8,vl)],544)):B("",!0)],64)):B("",!0),i.message.role==="model"?(u(),c(ie,{key:1},[f.value?(u(),c("section",gl,[f.value.modelName?(u(),c("div",yl,[P(H,{name:"smart_toy"}),n[11]||(n[11]=e("span",{class:"meta-label"},"模型:",-1)),e("span",bl,_(f.value.modelName),1)])):B("",!0),f.value.status!==null&&f.value.status!==void 0?(u(),c("div",_l,[P(H,{name:"info"}),n[12]||(n[12]=e("span",{class:"meta-label"},"状态码:",-1)),e("span",kl,_(f.value.status),1)])):B("",!0),f.value.statusText?(u(),c("div",wl,[P(H,{name:"description"}),n[13]||(n[13]=e("span",{class:"meta-label"},"状态说明:",-1)),e("span",Tl,_(f.value.statusText),1)])):B("",!0),f.value.tokens?(u(),c("div",Cl,[P(H,{name:"bar_chart"}),n[15]||(n[15]=e("span",{class:"meta-label"},"Token统计:",-1)),e("div",$l,[f.value.tokens.promptTokenCount!==null&&f.value.tokens.promptTokenCount!==void 0?(u(),c("span",Sl,"Prompt: "+_(f.value.tokens.promptTokenCount),1)):B("",!0),f.value.tokens.candidatesTokenCount!==null&&f.value.tokens.candidatesTokenCount!==void 0?(u(),c("span",Ml,"Response: "+_(f.value.tokens.candidatesTokenCount),1)):B("",!0),f.value.tokens.thoughtsTokenCount!==null&&f.value.tokens.thoughtsTokenCount!==void 0?(u(),c("span",xl,"Thinking: "+_(f.value.tokens.thoughtsTokenCount),1)):B("",!0),f.value.tokens.totalTokenCount!==null&&f.value.tokens.totalTokenCount!==void 0?(u(),c("span",Il,"Total: "+_(f.value.tokens.totalTokenCount),1)):B("",!0),Ee.value&&Ee.value.length?(u(),c("div",Al,[n[14]||(n[14]=e("span",{class:"token-breakdown__label"},"Prompt 详情:",-1)),e("ul",Pl,[(u(!0),c(ie,null,be(Ee.value,(v,F)=>(u(),c("li",{key:F,class:"token-breakdown__item"},[e("span",El,_(v.label),1),e("span",Rl,_(v.tokenCount??"—"),1)]))),128))])])):B("",!0)])])):B("",!0),f.value.finishReason?(u(),c("div",ql,[P(H,{name:"flag"}),n[16]||(n[16]=e("span",{class:"meta-label"},"结束原因:",-1)),e("span",Ll,_(f.value.finishReason),1)])):B("",!0)])):B("",!0),ke.value||fe.value?(u(),c("section",Dl,[e("header",Hl,[P(H,{name:"error"}),n[17]||(n[17]=e("span",{class:"model-section__title"},"错误信息",-1))]),ke.value?(u(),c("p",Bl,_(ke.value),1)):B("",!0),fe.value?(u(),c("details",{key:1,class:"message-card__model-json","data-tone":"error","data-open":xe.value,onToggle:Tt},[e("summary",null,[P(H,{name:"bug_report"}),n[18]||(n[18]=e("span",null,"错误详情",-1)),Ie.value?(u(),c("span",zl)):B("",!0)]),e("div",{class:"model-json-body","data-loading":Ie.value},[Ie.value?(u(),c("div",Wl,[...n[19]||(n[19]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载错误详情…",-1)])])):ze.value?(u(),c("div",Ol,[P(H,{name:"error"}),e("span",null,_(ze.value),1),e("button",{class:"ghost-button ghost-button--alert",type:"button",onClick:X(Ct,["stop"])},[P(H,{name:"refresh"}),n[20]||(n[20]=oe(" 重试加载 ",-1))])])):$e.value?(u(),c(ie,{key:2},[e("pre",null,[e("code",null,_(Pe.value),1)]),e("button",{class:"ghost-button ghost-button--alert",type:"button",onClick:X($t,["stop"])},[P(H,{name:"content_copy"}),n[21]||(n[21]=oe(" 复制 ",-1))])],64)):Ae.value?(u(),c("div",Nl,[...n[22]||(n[22]=[e("span",null,"暂无可显示的错误详情。",-1)])])):(u(),c("div",Kl,[...n[23]||(n[23]=[e("span",null,"展开以加载错误详情。",-1)])]))],8,Ul)],40,Fl)):B("",!0)])):B("",!0)],64)):B("",!0)],2))}}),Vl=ve(jl,[["__scopeId","data-v-5c9615c2"]]),Gl={key:0,class:"panel-rail__meta"},Yl=["title"],Jl=["title"],Ql=["title"],Xl={key:1,class:"panel-rail__meta panel-rail__meta--empty"},Zl={key:2,class:"panel-rail__stats"},ea={class:"badge badge--ghost"},ta={class:"badge badge--ghost"},na=["title"],sa={class:"panel-rail__controls"},oa={class:"panel-rail__actions"},la=["disabled"],aa={class:"panel-main"},ra={class:"panel-header__title"},ia={class:"panel-header__primary"},ua={key:0,class:"panel-header__count"},ca={key:0,class:"panel-header__hint"},da=["title"],pa={key:1,class:"panel-header__hint"},va={class:"panel-header__controls"},fa={key:0,class:"panel-header__meta"},ma={class:"badge badge--ghost"},ha={class:"badge badge--ghost"},ga=["title"],ya={class:"panel-header__actions"},ba=["disabled"],_a={key:0,class:"topic-hash-card"},ka={class:"topic-hash-card__header"},wa={class:"topic-hash-card__title"},Ta={class:"topic-hash-card__content"},Ca={key:0,class:"hash-item"},$a=["title"],Sa={key:1,class:"hash-item"},Ma=["title"],xa={key:1,class:"empty-state"},Ia={key:2,class:"panel-content empty-state"},Aa=ce({__name:"MessagePanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(i,{expose:s,emit:a}){const d=i,y=a,r=p(()=>{if(d.stackDirection==="right"&&typeof d.mainSpan=="number"&&d.mainSpan>=0)return{width:`${Math.max(d.mainSpan,0)}px`}}),C=qe();_e();const m=p(()=>C.selectedIp),T=p(()=>C.selectedTopic),z=p(()=>C.currentTopicMessages),I=E(null),h=E(null),b=E(null),j=Wt(wt,null),N=p(()=>d.collapsed===!0);j?.messageList&&(Fe(h,q=>{const A=q[0];if(!A)return;const Y=Array.isArray(A.borderBoxSize)?A.borderBoxSize[0]:A.borderBoxSize,te=Y?Y.inlineSize:A.contentRect.width;te>0&&j.messageList.reportHeaderSize({width:te,height:0})}),Fe(b,q=>{const A=q[0];if(!A)return;const Y=Array.isArray(A.borderBoxSize)?A.borderBoxSize[0]:A.borderBoxSize,te=Y?Y.blockSize:A.contentRect.height;te>0&&j.messageList.reportHeaderSize({width:0,height:te})}));const w=p(()=>T.value?C.currentIpTopics.find(A=>A.tid===T.value)??null:null),g=p(()=>{const q=w.value?.title;return typeof q=="string"&&q.trim().length>0?q.trim():null}),D=p(()=>({hashNoReason:C.currentTopicMeta?.topicHashNoReason??null,hashWithReason:C.currentTopicMeta?.topicHashWithReason??null})),M=p(()=>{const q=D.value;return q.hashNoReason||q.hashWithReason?{title:"话题哈希",hashNoReason:q.hashNoReason,hashWithReason:q.hashWithReason,messageId:null}:null}),U=p(()=>z.value),K=p(()=>{const q=m.value,A=T.value;return!q||!A?!1:C.loadingMessages.get(`${q}:${A}`)===!0}),Z=Kt(()=>w.value?.upAt??null);function W(q){return q?q.length>16?`${q.slice(0,8)}...${q.slice(-8)}`:q:""}async function $(){!m.value||!T.value||await C.ensureMessages(m.value,T.value,!0)}function S(){y("request-focus")}function k(){}return s({resetToCollapsedState:k}),(q,A)=>(u(),c("section",{class:le(["panel panel--message",{"panel--collapsed":N.value}]),style:_t(r.value),onMouseenter:S,onFocusin:S,onPointerdownCapture:S},[i.stackDirection==="right"?(u(),c("aside",{key:0,ref_key:"desktopRailEl",ref:h,class:"panel-rail panel-rail--desktop"},[A[2]||(A[2]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"消息详情",-1)),T.value?(u(),c("div",Gl,[e("strong",null,_(w.value?.msgCnt??U.value.length),1),A[0]||(A[0]=e("span",null,"消息",-1)),g.value?(u(),c("div",{key:0,class:"panel-rail__hint",title:g.value}," 标题 "+_(g.value),9,Yl)):B("",!0),e("div",{class:"panel-rail__hint",title:T.value},"话题 "+_(T.value),9,Jl),m.value?(u(),c("div",{key:1,class:"panel-rail__hint",title:m.value},"IP "+_(m.value),9,Ql)):B("",!0)])):(u(),c("div",Xl,[...A[1]||(A[1]=[e("span",null,"等待",-1),e("span",null,"选择话题",-1)])])),w.value?(u(),c("div",Zl,[e("span",ea,"入 "+_(x(we)(w.value.inBytes)),1),e("span",ta,"出 "+_(x(we)(w.value.outBytes)),1),e("span",{class:"badge badge--ghost",title:x(Me)(w.value.upAt)}," 更新 "+_(x(Z)),9,na)])):B("",!0),e("div",sa,[e("div",oa,[e("button",{class:"control-button control-button--icon",type:"button",title:"刷新消息","aria-label":"刷新消息",disabled:!T.value||K.value,onClick:$},[P(H,{name:"sync"})],8,la)])])],512)):B("",!0),e("div",aa,[i.stackDirection==="down"?(u(),c("header",{key:0,ref_key:"mobileHeaderEl",ref:b,class:"panel-header panel-header--mobile"},[e("div",ra,[e("div",ia,[A[3]||(A[3]=e("h2",null,"消息详情",-1)),T.value?(u(),c("span",ua,_(w.value?.msgCnt??U.value.length),1)):B("",!0)]),T.value?(u(),c("p",ca,[g.value?(u(),c("span",{key:0,class:"topic-header__title",title:g.value},_(g.value),9,da)):B("",!0),e("span",null,"话题 "+_(T.value),1),A[4]||(A[4]=oe(" · ",-1)),e("span",null,"IP "+_(m.value??"—"),1)])):(u(),c("p",pa,"等待选择话题"))]),e("div",va,[w.value?(u(),c("div",fa,[e("span",ma,"入 "+_(x(we)(w.value.inBytes)),1),e("span",ha,"出 "+_(x(we)(w.value.outBytes)),1),e("span",{class:"badge badge--ghost",title:x(Me)(w.value.upAt)},"更新 "+_(x(Z)),9,ga)])):B("",!0),e("div",ya,[e("button",{class:"control-button control-button--icon",type:"button",title:"刷新消息","aria-label":"刷新消息",disabled:!T.value||K.value,onClick:$},[P(H,{name:"sync"})],8,ba)])])],512)):B("",!0),T.value?(u(),c("div",{key:1,ref_key:"listEl",ref:I,class:"panel-content message-list"},[M.value?(u(),c("article",_a,[e("header",ka,[e("div",wa,[P(H,{name:"tag"}),e("span",null,_(M.value.title),1)])]),e("div",Ta,[M.value.hashNoReason?(u(),c("div",Ca,[A[5]||(A[5]=e("span",{class:"hash-label"},"无推理:",-1)),e("code",{class:"hash-value",title:M.value.hashNoReason},_(W(M.value.hashNoReason)),9,$a)])):B("",!0),M.value.hashWithReason?(u(),c("div",Sa,[A[6]||(A[6]=e("span",{class:"hash-label"},"含推理:",-1)),e("code",{class:"hash-value",title:M.value.hashWithReason},_(W(M.value.hashWithReason)),9,Ma)])):B("",!0)])])):B("",!0),(u(!0),c(ie,null,be(U.value,Y=>(u(),Se(Vl,{key:Y.id,message:Y,"root-el":I.value},null,8,["message","root-el"]))),128)),U.value.length?B("",!0):(u(),c("div",xa,[...A[7]||(A[7]=[e("p",null,"暂无消息。",-1)])]))],512)):(u(),c("div",Ia,[...A[8]||(A[8]=[e("p",null,"请选择话题查看消息详情。",-1)])]))])],38))}}),Pa=ve(Aa,[["__scopeId","data-v-9a56742c"]]),Ea={class:"toast-container"},Ra={class:"toast__icon"},qa={class:"toast__body"},La={key:0},Da=["onClick"],Ha=ce({__name:"ToastContainer",setup(i){const s=_e();function a(d){switch(d){case"success":return"check_circle";case"error":return"error";case"warning":return"warning";default:return"info"}}return(d,y)=>(u(),c("div",Ea,[P(kn,{name:"toast",tag:"div"},{default:Je(()=>[(u(!0),c(ie,null,be(x(s).toasts,r=>(u(),c("div",{key:r.id,class:le(["toast",r.type])},[e("div",Ra,[P(H,{name:a(r.type)},null,8,["name"])]),e("div",qa,[e("strong",null,_(r.title),1),r.message?(u(),c("p",La,_(r.message),1)):B("",!0)]),e("button",{class:"toast__close",onClick:C=>x(s).dismissToast(r.id)},[P(H,{name:"close"})],8,Da)],2))),128))]),_:1})]))}}),Ba=ve(Ha,[["__scopeId","data-v-e4c6c4f4"]]);function it(i){if(typeof window>"u")return{onBackdropPointerDown:()=>{},onBackdropPointerUp:()=>{}};let s=!1,a=null;const d=()=>{s=!1,a=null,window.removeEventListener("pointerup",y,!0),window.removeEventListener("pointercancel",r,!0)},y=T=>{s&&a===T.pointerId&&i(),d()},r=()=>{d()},C=T=>{T.button===0&&(s=!0,a=T.pointerId,window.addEventListener("pointerup",y,!0),window.addEventListener("pointercancel",r,!0))},m=T=>{if(T.button!==0){d();return}if(!s||a!==T.pointerId){d();return}i(),d()};return wn()&&Ut(()=>{d()}),{onBackdropPointerDown:C,onBackdropPointerUp:m}}const Fa={class:"modal"},za={class:"actions"},Ua=ce({__name:"PreviewModal",setup(i){const s=_e(),a=s.preview,y=ce({name:"PlainRenderer",props:{source:{type:String,required:!0}},setup(I){return()=>Tn("pre",{class:"plain"},I.source)}}),r=E(null),{onBackdropPointerDown:C,onBackdropPointerUp:m}=it(T);pe(()=>!a.open||!a.payload?.downloadableName?null:{content:a.payload.content,mimeType:a.payload.mimeType},(I,h,b)=>{if(r.value&&(URL.revokeObjectURL(r.value),r.value=null),I){const j=new Blob([I.content],{type:I.mimeType??"text/plain"}),N=URL.createObjectURL(j);r.value=N,b(()=>{URL.revokeObjectURL(N)})}});function T(){s.closePreview()}function z(){if(!r.value||!a.payload?.downloadableName)return;const I=document.createElement("a");I.href=r.value,I.download=a.payload.downloadableName,I.click()}return(I,h)=>(u(),Se(Qe,{to:"body"},[P(rt,{name:"fade"},{default:Je(()=>[x(a).open&&x(a).payload?(u(),c("div",{key:0,class:"overlay",onPointerdown:h[0]||(h[0]=X((...b)=>x(C)&&x(C)(...b),["self"])),onPointerup:h[1]||(h[1]=X((...b)=>x(m)&&x(m)(...b),["self"]))},[e("div",Fa,[e("header",null,[e("h3",null,_(x(a).payload.title),1),e("div",za,[r.value?(u(),c("button",{key:0,class:"ghost",onClick:z},[P(H,{name:"download"}),h[2]||(h[2]=oe(" 导出 ",-1))])):B("",!0),e("button",{class:"icon",onClick:T},[P(H,{name:"close"})])])]),e("section",null,[(u(),Se(ln(x(y)),{source:x(a).payload.content},null,8,["source"]))])])],32)):B("",!0)]),_:1})]))}}),Wa=ve(Ua,[["__scopeId","data-v-4161bfb1"]]),Oa={class:"dialog"},Na={class:"actions"},Ka=ce({__name:"ConfirmDialog",setup(i){const s=_e(),{confirmDialog:a}=kt(s),d=p(()=>a.value.open?a.value.options:null),{onBackdropPointerDown:y,onBackdropPointerUp:r}=it(C);function C(){s.resolveConfirm(!1)}function m(){s.resolveConfirm(!0)}return(T,z)=>(u(),Se(Qe,{to:"body"},[P(rt,{name:"fade"},{default:Je(()=>[d.value?(u(),c("div",{key:0,class:"overlay",onPointerdown:z[0]||(z[0]=X((...I)=>x(y)&&x(y)(...I),["self"])),onPointerup:z[1]||(z[1]=X((...I)=>x(r)&&x(r)(...I),["self"]))},[e("div",Oa,[e("h3",null,_(d.value.title),1),e("p",null,_(d.value.message),1),e("div",Na,[e("button",{class:"ghost",onClick:C},_(d.value.cancelLabel??"取消"),1),e("button",{class:"danger",onClick:m},_(d.value.confirmLabel??"确认"),1)])])],32)):B("",!0)]),_:1})]))}}),ja=ve(Ka,[["__scopeId","data-v-d1092b8d"]]),Va={class:"panel"},Ga={class:"actions"},Ya=["disabled"],Ja={class:"form-section"},Qa={class:"field"},Xa={class:"field-inline"},Za={class:"field"},er=["value"],tr={class:"field"},nr=["disabled"],sr={class:"list-section"},or={key:0,class:"loading"},lr={key:1,class:"empty"},ar={key:2},rr={class:"mono"},ir=["onClick"],ur=ce({__name:"BanManager",setup(i){const s=qe(),a=_e(),{blockedIPs:d,loadingBlockedIPs:y}=kt(s),r=[{label:"1 小时",value:3600*1e3},{label:"6 小时",value:360*60*1e3},{label:"1 天",value:1440*60*1e3},{label:"7 天",value:10080*60*1e3},{label:"30 天",value:720*60*60*1e3},{label:"永久",value:null}],C=E(""),m=E(r[2].value),T=E(""),z=E(!1),I=p(()=>y.value),h=p(()=>d.value?.blocked??[]),b=p(()=>d.value?.now??Date.now());async function j(W=!1){await s.refreshBlockedIPs(W)}async function N(){if(C.value){z.value=!0;try{await s.banIp(C.value,m.value??void 0,T.value||void 0),a.pushToast({type:"success",title:"封禁成功",message:`${C.value} 已被封禁`}),C.value="",T.value="",await j(!0)}catch(W){a.pushToast({type:"error",title:"封禁失败",message:W instanceof Error?W.message:String(W)})}finally{z.value=!1}}}async function w(){await j(!0)}function g(){a.toggleBanManager(!1)}const{onBackdropPointerDown:D,onBackdropPointerUp:M}=it(g);async function U(W){await s.unbanIp(W),a.pushToast({type:"success",title:"已解除封禁",message:`${W} 已解除`}),await j(!0)}function K(W){return W?Me(W):"永久封禁"}function Z(W){if(!W)return"永久";const $=W-b.value;return $<=0?"即将解除":un($)}return pe(()=>a.banManagerOpen,W=>{W&&j()}),at(()=>{a.banManagerOpen&&j()}),(W,$)=>(u(),Se(Qe,{to:"body"},[P(rt,{name:"overlay-dialog"},{default:Je(()=>[x(a).banManagerOpen?(u(),c("div",{key:0,class:"overlay",onPointerdown:$[3]||($[3]=X((...S)=>x(D)&&x(D)(...S),["self"])),onPointerup:$[4]||($[4]=X((...S)=>x(M)&&x(M)(...S),["self"]))},[e("div",Va,[e("header",null,[$[5]||($[5]=e("h3",null,"IP 封禁管理",-1)),e("div",Ga,[e("button",{class:"ghost",disabled:I.value,onClick:w},"刷新",8,Ya),e("button",{class:"icon",onClick:g},[P(H,{name:"close"})])])]),e("section",Ja,[$[10]||($[10]=e("h4",null,"新增封禁",-1)),e("form",{onSubmit:X(N,["prevent"])},[e("div",Qa,[$[6]||($[6]=e("label",null,"IP 地址",-1)),Lt(e("input",{"onUpdate:modelValue":$[0]||($[0]=S=>C.value=S),type:"text",placeholder:"例如 192.168.0.1",required:""},null,512),[[Gt,C.value,void 0,{trim:!0}]])]),e("div",Xa,[e("div",Za,[$[7]||($[7]=e("label",null,"封禁时长",-1)),Lt(e("select",{"onUpdate:modelValue":$[1]||($[1]=S=>m.value=S)},[(u(),c(ie,null,be(r,S=>e("option",{key:S.value??"perm",value:S.value},_(S.label),9,er)),64))],512),[[Cn,m.value]])]),e("div",tr,[$[8]||($[8]=e("label",null,"原因（可选）",-1)),Lt(e("input",{"onUpdate:modelValue":$[2]||($[2]=S=>T.value=S),type:"text",placeholder:"记录封禁原因"},null,512),[[Gt,T.value,void 0,{trim:!0}]])]),e("button",{class:"primary",type:"submit",disabled:z.value},[P(H,{name:"gavel"}),$[9]||($[9]=oe(" 封禁 ",-1))],8,nr)])],32)]),e("section",sr,[$[12]||($[12]=e("h4",null,"已封禁 IP",-1)),I.value?(u(),c("div",or,"正在加载...")):h.value.length===0?(u(),c("div",lr,"暂无封禁记录")):(u(),c("table",ar,[$[11]||($[11]=e("thead",null,[e("tr",null,[e("th",null,"IP"),e("th",null,"解除时间"),e("th",null,"剩余"),e("th",null,"原因"),e("th",null,"操作")])],-1)),e("tbody",null,[(u(!0),c(ie,null,be(h.value,S=>(u(),c("tr",{key:S.ip},[e("td",rr,_(S.ip),1),e("td",null,_(K(S.unblockAt)),1),e("td",null,_(Z(S.unblockAt)),1),e("td",null,_(S.reason||"—"),1),e("td",null,[e("button",{class:"danger",onClick:k=>U(S.ip)},"解除封禁",8,ir)])]))),128))])]))])])],32)):B("",!0)]),_:1})]))}}),cr=ve(ur,[["__scopeId","data-v-9de310ce"]]),dr={class:"panel"},pr={class:"actions"},vr=["disabled"],fr={key:0,class:"loading"},mr={key:1,class:"empty"},hr={key:2},gr={class:"mono"},yr={class:"row-actions"},br=["onClick"],_r=["onClick"],kr=ce({__name:"AliasManager",setup(i){const s=_e(),a=qe(),{aliasKeys:d,loadingAliasKeys:y}=kt(a),r=p(()=>d.value?.aliasKeys??[]),C=p(()=>y.value);function m(){s.toggleAliasManager(!1)}const{onBackdropPointerDown:T,onBackdropPointerUp:z}=it(m);async function I(N=!0){await a.refreshAliasKeys(N)}async function h(N){await s.confirm({title:"删除别名",message:`确定要删除别名 ${N} 吗？`})&&(await a.removeAlias(N),s.pushToast({type:"success",title:"删除成功",message:`${N} 已删除`}),await I(!0))}async function b(N){try{await navigator.clipboard.writeText(N),s.pushToast({type:"success",title:"已复制",message:N})}catch(w){s.pushToast({type:"error",title:"复制失败",message:w instanceof Error?w.message:String(w)})}}function j(N){return N?Me(N):"—"}return pe(()=>s.aliasManagerOpen,N=>{N&&I(!1)}),at(()=>{s.aliasManagerOpen&&I(!1)}),(N,w)=>(u(),Se(Qe,{to:"body"},[P(rt,{name:"overlay-dialog"},{default:Je(()=>[x(s).aliasManagerOpen?(u(),c("div",{key:0,class:"overlay",onPointerdown:w[1]||(w[1]=X((...g)=>x(T)&&x(T)(...g),["self"])),onPointerup:w[2]||(w[2]=X((...g)=>x(z)&&x(z)(...g),["self"]))},[e("div",dr,[e("header",null,[w[3]||(w[3]=e("h3",null,"别名密钥管理",-1)),e("div",pr,[e("button",{class:"ghost",disabled:C.value,onClick:w[0]||(w[0]=g=>I())},"刷新",8,vr),e("button",{class:"icon",onClick:m},[P(H,{name:"close"})])])]),e("section",null,[C.value?(u(),c("div",fr,"正在加载别名密钥...")):r.value.length===0?(u(),c("div",mr,"暂无别名密钥")):(u(),c("table",hr,[w[6]||(w[6]=e("thead",null,[e("tr",null,[e("th",null,"别名"),e("th",null,"创建时间"),e("th",null,"最近使用"),e("th",null,"使用次数"),e("th",null,"操作")])],-1)),e("tbody",null,[(u(!0),c(ie,null,be(r.value,g=>(u(),c("tr",{key:g.aliasName},[e("td",gr,_(g.aliasName),1),e("td",null,_(j(g.ctAt)),1),e("td",null,_(j(g.upAt||g.firstUsedAt)),1),e("td",null,_(g.usageCount),1),e("td",null,[e("div",yr,[e("button",{class:"ghost",onClick:D=>b(g.aliasName)},[P(H,{name:"content_copy"}),w[4]||(w[4]=oe(" 复制 ",-1))],8,br),e("button",{class:"danger",onClick:D=>h(g.aliasName)},[P(H,{name:"delete"}),w[5]||(w[5]=oe(" 删除 ",-1))],8,_r)])])]))),128))])]))])])],32)):B("",!0)]),_:1})]))}}),wr=ve(kr,[["__scopeId","data-v-8cd9c6d4"]]),Tr={class:"panel"},Cr=ce({__name:"HelpPanel",setup(i){const s=_e(),{onBackdropPointerDown:a,onBackdropPointerUp:d}=it(y);function y(){s.toggleHelpPanel(!1)}return(r,C)=>(u(),Se(Qe,{to:"body"},[P(rt,{name:"fade"},{default:Je(()=>[x(s).helpPanelOpen?(u(),c("div",{key:0,class:"overlay",onPointerdown:C[0]||(C[0]=X((...m)=>x(a)&&x(a)(...m),["self"])),onPointerup:C[1]||(C[1]=X((...m)=>x(d)&&x(d)(...m),["self"]))},[e("div",Tr,[e("header",null,[C[2]||(C[2]=e("h3",null,"操作帮助",-1)),e("button",{class:"icon",onClick:y},[P(H,{name:"close"})])]),C[3]||(C[3]=e("section",null,[e("article",null,[e("h4",null,"基础用法"),e("ul",null,[e("li",null,"左侧 IP 面板支持按请求数、流量等排序，单击选择后即可加载相关主题。"),e("li",null,"主题列表支持快速筛选，可通过右上角搜索框按主题 ID 或别名过滤。"),e("li",null,"消息面板会自动缓存已加载的数据，再次打开时秒级响应，顶部按钮可强制刷新。")])]),e("article",null,[e("h4",null,"操作快捷键"),e("ul",null,[e("li",null,[e("kbd",null,"R"),oe("：刷新当前主题消息。")]),e("li",null,[e("kbd",null,"Shift"),oe(" + "),e("kbd",null,"R"),oe("：请求全量增量同步。")]),e("li",null,[e("kbd",null,"Ctrl"),oe(" + "),e("kbd",null,"F"),oe("：定位浏览器原生搜索，结合消息折叠功能快速定位。")])]),e("p",{class:"hint"},"提示：快捷键操作会在浏览器焦点位于页面内时生效。")]),e("article",null,[e("h4",null,"封禁与别名"),e("ul",null,[e("li",null,"封禁和别名管理在右上角菜单中打开，支持实时刷新。"),e("li",null,"封禁记录支持自定义时长和原因，解除后相关状态实时更新。"),e("li",null,"别名密钥展示实时使用次数，删除操作需二次确认以避免误删。")])]),e("article",null,[e("h4",null,"异常处理"),e("ul",null,[e("li",null,"若出现请求失败，可通过右上角的告警信息查看错误详情并重试。"),e("li",null,"若发现数据与服务端不一致，可点击“强制全量刷新”重新同步缓存。")])])],-1))])],32)):B("",!0)]),_:1})]))}}),$r=ve(Cr,[["__scopeId","data-v-5468cd4f"]]),Sr={class:"overlay-control__surface"},Mr=["value","placeholder","aria-label","onKeydown"],xr=["value","aria-label"],Ir=["value","disabled"],on=56,Ar=ce({__name:"OverlayControl",setup(i){const s=jt(),a=p(()=>s.visible),d=p(()=>s.expanded),y=p(()=>s.closing),r=p(()=>s.rect),C=p(()=>s.icon),m=p(()=>s.variant),T=p(()=>s.label),z=p(()=>s.relocating),I=p({get:()=>s.value,set:R=>s.updateValue(R)}),h=p(()=>s.options),b=p(()=>s.align),j=p(()=>s.collapsedWidth),N=p(()=>s.expandedWidth),w=E(null),g=E(null),D=p(()=>[`overlay-control--${m.value}`,{"overlay-control--expanded":d.value,"overlay-control--relocating":z.value}]),M=p(()=>({"overlay-control__icon":!0})),U=p(()=>{const R=r.value,l=j.value||R.width||0,o=l>0?l:0,f=N.value||o,Q=f>0?Math.max(f,o):o,L=R.left,V=R.left+R.width,fe=b.value==="right"?V-Q:L,Te=b.value==="right"?V-o:L;let me=fe,ke=Te;if(typeof window<"u"){const Ae=window.innerWidth??Q,$e=Math.max(Ae-Q,0),Pe=Math.max(Ae-o,0);me=Math.min(Math.max(fe,0),$e),ke=Math.min(Math.max(Te,0),Pe)}const Ce=d.value&&!y.value,G=Ce?Q:o,xe=Ce?me:ke,Le=Math.max(o-on,0),Ie=Math.max(Q-on,0),ze=Ce?Ie:Le;return{top:`${R.top}px`,left:`${xe}px`,width:`${G}px`,height:`${R.height}px`,"--overlay-field-width":`${Math.max(ze,0)}px`}});function K(){s.beginInteraction()}function Z(){s.scheduleClose()}function W(){s.beginInteraction()}function $(R){const l=R.currentTarget,o=R.relatedTarget;l&&o&&l.contains(o)||s.scheduleClose(200)}function S(R){y.value&&(R.propertyName==="width"||R.propertyName==="left")&&s.finalize()}function k(R){a.value&&(R.key==="Escape"&&s.cancel(),R.key==="Enter"&&m.value==="filter"&&s.requestClose())}function q(){a.value&&s.refreshAnchorRect()}function A(){$n(()=>{const R=m.value==="filter"?w.value:g.value;if(R?.focus({preventScroll:!0}),R instanceof HTMLInputElement){const l=R.value.length;R.setSelectionRange(l,l)}})}function Y(R){s.updateValue(R.target.value)}function te(){s.commit()}function J(){s.cancel()}function ne(R){const l=R.target.value;s.commit(l)}return pe(a,R=>{R&&A()}),pe(d,(R,l)=>{R&&!l&&A()}),pe(z,R=>{R&&A()}),at(()=>{window.addEventListener("keydown",k,!0),window.addEventListener("resize",q,!0),window.addEventListener("scroll",q,!0)}),Ut(()=>{window.removeEventListener("keydown",k,!0),window.removeEventListener("resize",q,!0),window.removeEventListener("scroll",q,!0)}),(R,l)=>(u(),Se(Qe,{to:"body"},[a.value?(u(),c("div",{key:0,class:le(["overlay-control",D.value]),style:_t(U.value),role:"dialog",onMouseenter:K,onMouseleave:Z,onFocusin:W,onFocusout:$,onTransitionend:S},[e("div",Sr,[P(H,{name:C.value,class:le(M.value)},null,8,["name","class"]),m.value==="filter"?(u(),c("input",{key:0,ref_key:"filterInputRef",ref:w,class:"overlay-control__field overlay-control__input",type:"text",value:I.value,placeholder:T.value,"aria-label":T.value,onInput:Y,onKeydown:[de(X(te,["prevent"]),["enter"]),de(X(J,["prevent"]),["esc"])],onBlur:te},null,40,Mr)):(u(),c("select",{key:1,ref_key:"selectRef",ref:g,class:"overlay-control__field overlay-control__select",value:I.value,"aria-label":T.value,onChange:ne},[(u(!0),c(ie,null,be(h.value,o=>(u(),c("option",{key:o.value,value:o.value,disabled:o.disabled===!0},_(o.label),9,Ir))),128))],40,xr))])],38)):B("",!0)]))}}),Pr=ve(Ar,[["__scopeId","data-v-073b0662"]]),Er={key:1,class:"loading-state"},Rr=ce({__name:"App",setup(i){const s=qe(),{initialized:a}=kt(s),d=p(()=>a.value),y={ipList:bo,topicList:el,messageList:Pa},r=["ipList","topicList","messageList"],{layout:C,setViewport:m,setContainerSize:T,setFocusedPanel:z,updatePanelHeader:I}=Fs(r),h=p(()=>C.value.activePanelId),b=p(()=>C.value.stackDirection),j=p(()=>({"--layout-total":`${C.value.totalSpan}px`})),N=p(()=>({"app-shell--vertical":b.value==="down"})),w=p(()=>({"dashboard-grid--vertical":b.value==="down","dashboard-grid--horizontal":b.value==="right","dashboard-grid--focused":!!h.value})),g={ipList:E(null),topicList:E(null),messageList:E(null)},D={ipList($){g.ipList.value=$},topicList($){g.topicList.value=$},messageList($){g.messageList.value=$}};function M($){return[`panel-stack--${$.id}`,{"panel-stack--focused":$.id===h.value,"panel-stack--muted":!!h.value&&$.id!==h.value,"panel-stack--collapsed":!!h.value&&$.id!==h.value}]}function U($){z($),Object.entries(g).forEach(([S,k])=>{S!==$&&k.value?.resetToCollapsedState()})}const K=E(null);Fe(K,$=>{const S=$[0];if(!S)return;let k=S.contentRect.width;K.value?.closest(".app-shell")&&(k=k-1);const A=Math.max(0,Math.round(k*10)/10),Y=Math.max(0,Math.round(S.contentRect.height*10)/10);T(A,Y)}),Mn(wt,{ipList:{reportHeaderSize($){I("ipList",$.width,$.height)}},topicList:{reportHeaderSize($){I("topicList",$.width,$.height)}},messageList:{reportHeaderSize($){I("messageList",$.width,$.height)}}});const{width:Z,height:W}=Sn();return pe([Z,W],([$,S])=>{m($??0,S??0)},{immediate:!0}),at(async()=>{await s.initialize(),await s.refreshLightStats()}),($,S)=>(u(),c("div",{class:le(["app-shell",N.value])},[P(Ps),d.value?(u(),c("section",{key:0,ref_key:"gridEl",ref:K,class:le(["dashboard-grid",w.value]),style:_t(j.value)},[(u(!0),c(ie,null,be(x(C).panels,k=>(u(),c("div",{key:k.id,class:le(["panel-stack",M(k)]),style:_t(k.style)},[(u(),Se(ln(y[k.id]),{collapsed:!!h.value&&k.id!==h.value,"main-span":k.mainSpan,"stack-direction":b.value,ref_for:!0,ref:D[k.id],onRequestFocus:q=>U(k.id)},null,40,["collapsed","main-span","stack-direction","onRequestFocus"]))],6))),128))],6)):(u(),c("div",Er,[...S[0]||(S[0]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在加载仪表板数据...",-1)])])),P(Ba),P(Wa),P(ja),P(cr),P(wr),P($r),P(Pr)],2))}}),qr=ve(Rr,[["__scopeId","data-v-3d3a4b4e"]]),vn=xn(qr);vn.use(In());vn.mount("#app");typeof window<"u"&&(window.dispatchEvent(new CustomEvent("dashboard:mounted",{detail:Date.now()})),window.__hideDashboardLoading?.());
