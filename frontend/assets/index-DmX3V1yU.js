import{d as Nt,r as R,a as re,u as rt,c as f,w as ve,b as Kt,e as kn,f as de,g as Tn,h as p,o as c,m as $n,i as S,t as _,j as Cn,k as Sn,l as ct,n as jt,p as le,q as e,s as U,v as se,x,y as Z,z as yt,A as Vt,B as Fe,C as fe,F as ce,D as be,E as Mn,G as wt,H as Te,T as In,I as ze,J as xn,K as Xe,L as dn,M as Ue,N as Pn,O as kt,P as zt,Q as Zt,R as An,S as En,U as Rn,V as qn,W as Dn,X as Ln}from"./vendor-vue-eOt3kUAp.js";import{d as Ze,r as Hn,a as Bn}from"./vendor-dayjs-CC1MZq2R.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))d(m);new MutationObserver(m=>{for(const i of m)if(i.type==="childList")for(const w of i.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&d(w)}).observe(document,{childList:!0,subtree:!0});function r(m){const i={};return m.integrity&&(i.integrity=m.integrity),m.referrerPolicy&&(i.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?i.credentials="include":m.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(m){if(m.ep)return;m.ep=!0;const i=r(m);fetch(m.href,i)}})();const Fn="/dashboard/api";function pn(){return typeof window>"u"?null:window.__DASHBOARD_INIT__??null}function zn(){return pn()?.aDashkey??null}function Un(){return Fn}const On=1e4;class en extends Error{status;payload;constructor(n,r,d){super(n),this.name="DashboardRequestError",this.status=r,this.payload=d}}class Wn{baseUrl;token;constructor(n=Un()){this.baseUrl=n.replace(/\/$/,""),this.token=zn()}setToken(n){this.token=n}buildUrl(n,r){const d=n.startsWith("/")?n:`/${n}`,m=`${this.baseUrl}${d}`;if(!r||Object.keys(r).length===0)return m;const i=new URLSearchParams;Object.entries(r).forEach(([v,k])=>{k!=null&&i.append(v,String(k))});const w=i.toString();return w?`${m}?${w}`:m}async request(n,r,d={}){const{params:m,signal:i,headers:w={},body:v}=d,k=this.buildUrl(n,m),N=v!==void 0?JSON.stringify(v):void 0,q=await fetch(k,{method:r,signal:i,headers:{Accept:"application/json;charset=UTF-8",...N?{"Content-Type":"application/json;charset=UTF-8"}:{},...this.token?{"x-dashboard-token":this.token}:{},...w},credentials:"same-origin",body:N}),L=(q.headers.get("content-type")||"").includes("application/json");let g=null;if(L)try{g=await q.json()}catch{if(q.ok)throw new en("无法解析服务器响应",q.status,null)}if(!q.ok){const T=g,W=T?.error||q.statusText||"请求失败";throw new en(W,q.status,T??null)}return g}get(n,r){return this.request(n,"GET",r)}post(n,r,d){return this.request(n,"POST",{...d,body:r})}}const ie=new Wn,Nn=()=>ie.get("/lightStats"),Kn=()=>ie.get("/fullStats"),jn=u=>ie.get("/globalDelta",{params:{since:u}}),Vn=u=>ie.get("/iptopics",{params:{ip:u}}),Gn=(u,n,r={})=>ie.get("/topic",{params:{ip:u,tid:n,start:r.start,limit:r.limit}}),Yn=u=>ie.get("/message",{params:{id:u}}),Jn=u=>ie.get("/messageRequestBody",{params:{id:u}}),Qn=u=>ie.get("/messageRequestHeaders",{params:{id:u}}),Xn=u=>ie.get("/modelError",{params:{id:u}}),Zn=(u,n={})=>ie.get("/attachmentText",{params:{file:u,offset:n.offset,limit:n.limit}}),es=u=>ie.post("/deleteTopics",u),ts=u=>ie.post("/deleteIP",u),ns=()=>ie.get("/blockedIPs"),ss=u=>ie.post("/banIP",u),os=u=>ie.post("/unbanIP",u),as=()=>ie.get("/aliasKeys"),ls=u=>ie.post("/deleteAliasKey",u),rs=u=>{ie.setToken(u)},Ee=Nt("dashboard",()=>{const u=R(!1),n=R(null),r=re(new Map),d=re(new Map),m=re(new Map),i=re(new Map),w=re(new Map),v=re(new Map),k=re(new Map),N=re(new Map),q=R(null),L=R(null),g=rt("dashboard:selected-ip",null),T=rt("dashboard:selected-topic",null),W=rt("dashboard:topic-filter",""),A=rt("dashboard:ip-filter",""),$=rt("dashboard:ip-sort","recent"),H=R(1),h=R(25),F=R(1),j=R(25),Y=R(0),V=R(null),C=R("connected"),I=R(null),y=R(null),D=R(!1),P=R(!1),J=R(!1),te=R(!1),ee=re(new Map),ne=re(new Map),E=re(new Map),l=re(new Map),o=R(null),M=f(()=>{for(const a of r.values())if(a.unread)return!0;for(const a of d.values())if(a.unreadTopicIds.size>0)return!0;return!1}),O=f(()=>Array.from(r.entries()).map(([a,s])=>{const{summary:t}=s,b=t.lModReqAt??t.lTopUpdAt??0;return{ip:a,entry:s,summary:t,unread:s.unread,dirtyTopics:s.dirtyTopics,lastActive:b,sortValue:Q(s.summary,$.value)}})),B=f(()=>{const a=[...O.value],s=$.value;return a.sort((t,b)=>s==="recent"?(b.lastActive||0)-(t.lastActive||0):s==="reqs"?(b.summary.reqs||0)-(t.summary.reqs||0):s==="in"?(b.summary.inTfc||0)-(t.summary.inTfc||0):s==="out"?(b.summary.outTfc||0)-(t.summary.outTfc||0):0),a}),G=f(()=>{const a=A.value.trim().toLowerCase(),t=a?B.value.filter(K=>K.ip.toLowerCase().includes(a)):B.value,b=Math.max(1,Math.ceil(t.length/h.value));H.value>b&&(H.value=b);const X=(H.value-1)*h.value;return t.slice(X,X+h.value)});ve(A,()=>{H.value=1});const we=f(()=>{const a=g.value;return a?r.get(a)?.dirtyTopics??!1:!1});ve(we,a=>{a&&g.value&&Le(g.value)});const he=f(()=>{const a=g.value;if(!a)return[];const s=d.get(a);if(!s)return[];const t=[...s.items];t.sort((X,K)=>(K.upAt||0)-(X.upAt||0));const b=W.value.trim().toLowerCase();return b?t.filter(X=>X.tid.toLowerCase().includes(b)||(X.hKey||"").toLowerCase().includes(b)||(X.title||"").toLowerCase().includes(b)):t}),me=f(()=>{const a=he.value,s=Math.max(1,Math.ceil(a.length/j.value));F.value>s&&(F.value=s);const t=(F.value-1)*j.value;return a.slice(t,t+j.value)}),Ie=f(()=>{const a=T.value;if(!a)return[];const s=m.get(a);return s?s.items:[]}),$e=f(()=>{const a=T.value;return a?m.get(a)?.dirty??!1:!1});ve($e,a=>{if(!a)return;const s=T.value;if(!s)return;const t=g.value??dt(s);t&&We(t,s)});const Re=f(()=>{const a=T.value;if(!a)return null;const s=m.get(a);return s?{total:s.total,dirty:s.dirty,fullyLoaded:s.fullyLoaded,topicHashNoReason:s.topicHashNoReason??null,topicHashWithReason:s.topicHashWithReason??null}:null});function Q(a,s){return s==="recent"?a.lModReqAt??a.lTopUpdAt??0:s==="reqs"?a.reqs:s==="in"?a.inTfc:s==="out"?a.outTfc:0}function ye(a,s={}){const t=r.get(a.ip),b={ip:a.ip,reqs:a.reqs??t?.summary.reqs??0,inTfc:a.inTfc??t?.summary.inTfc??0,outTfc:a.outTfc??t?.summary.outTfc??0,lTopUpdAt:a.lTopUpdAt??t?.summary.lTopUpdAt,lModReqAt:a.lModReqAt??t?.summary.lModReqAt,realIPs:a.realIPs??t?.summary.realIPs};r.set(a.ip,{summary:b,dirtyTopics:s.markDirty??t?.dirtyTopics??!1,unread:s.markUnread?!0:t?.unread??!1})}function qe(a){for(const s of r.keys())a.has(s)||(r.delete(s),d.delete(s))}function Ce(a){const s=r.get(a);s&&r.set(a,{...s,unread:!1});const t=d.get(a);t&&(t.unreadTopicIds=new Set)}function xe(a,s){const t=d.get(a);if(t&&t.unreadTopicIds.has(s)){const b=new Set(t.unreadTopicIds);b.delete(s),t.unreadTopicIds=b}}async function tt(){if(u.value)return;const a=pn();if(o.value=a,a){n.value={totReqs:a.totReqs,totInTfc:a.totInTfc,totOutTfc:a.totOutTfc,ts:a.ts,sTime:a.sTime,lGMsgAt:a.lGMsgAt??null},Y.value=a.lGMsgAt??0,rs(a.aDashkey??null);const s=new Set;a.ipStats.forEach(b=>{s.add(b.ip),ye(b)}),qe(s);const t=a.ipStats.map(b=>b.ip);g.value&&!t.includes(g.value)&&(g.value=null,T.value=null),!g.value&&t.length>0?Ke(t[0]):g.value&&Le(g.value)}u.value=!0}async function Se(){if(!D.value){D.value=!0;try{const a=await Nn();n.value=a,C.value="connected",y.value=null,I.value=Date.now(),a.lGMsgAt&&a.lGMsgAt>Y.value&&await Oe()}catch(a){C.value="disconnected",y.value=a instanceof Error?a.message:String(a)}finally{D.value=!1}}}async function De(){if(!P.value){P.value=!0;try{const a=await Kn();n.value={totReqs:a.totReqs,totInTfc:a.totInTfc,totOutTfc:a.totOutTfc,ts:a.ts,sTime:a.sTime,lGMsgAt:a.lGMsgAt};const s=new Set;a.ipStats.forEach(t=>{s.add(t.ip),ye(t)}),qe(s),C.value="connected",y.value=null}catch(a){C.value="disconnected",y.value=a instanceof Error?a.message:String(a)}finally{P.value=!1}}}async function Oe(a){const s=a??Y.value,t=await jn(s);t.lGMsgAt&&(Y.value=t.lGMsgAt,V.value=t.lGMsgAt);const b=new Set,X=Date.now();t.chgIPs.forEach(K=>{b.add(K.ip),ye({ip:K.ip,reqs:K.reqs,inTfc:K.inTfc,outTfc:K.outTfc,lTopUpdAt:K.ipUpdAt,lModReqAt:K.ipUpdAt,realIPs:K.realIPs},{markUnread:!0})}),t.chgTop.forEach(K=>{b.add(K.ip);const He=d.get(K.ip),je=He?new Set(He.unreadTopicIds):new Set,st=g.value===K.ip&&T.value===K.tid;st?je.delete(K.tid):je.add(K.tid);let _e=He?[...He.items]:[];const Be=_e.findIndex(ue=>ue.tid===K.tid),mt=ue=>{const oe=ue?{...ue}:{tid:K.tid,hKey:K.tid,ctAt:K.ctAt??K.upAt??X,upAt:K.upAt??X,msgCnt:K.msgCnt??0,inBytes:K.inBytes??0,outBytes:K.outBytes??0,status:"",hist:!1,title:null};return oe.ctAt=K.ctAt??oe.ctAt,oe.upAt=K.upAt??oe.upAt,oe.msgCnt=K.msgCnt??oe.msgCnt,oe.inBytes=K.inBytes??oe.inBytes,oe.outBytes=K.outBytes??oe.outBytes,Object.prototype.hasOwnProperty.call(K,"status")&&(oe.status=K.status??oe.status),Object.prototype.hasOwnProperty.call(K,"hist")&&(oe.hist=K.hist??oe.hist),Object.prototype.hasOwnProperty.call(K,"title")&&(oe.title=K.title??null),oe};Be>=0?_e[Be]=mt(_e[Be]):_e=[mt(),..._e],_e.sort((ue,oe)=>(oe.upAt||0)-(ue.upAt||0)),d.set(K.ip,{items:_e,fetchedAt:X,dirty:!1,unreadTopicIds:je});const ht=m.get(K.tid);ht&&m.set(K.tid,{...ht,dirty:!0,fullyLoaded:!1}),ye({ip:K.ip,lTopUpdAt:K.upAt,lModReqAt:K.upAt},{markUnread:!st})}),b.size>0&&(C.value="connected",y.value=null)}async function Le(a,s=!1){if(!a)return;const t=d.get(a);if(!(!s&&t&&!t.dirty)&&!ee.get(a)){ee.set(a,!0);try{const b=await Vn(a);d.set(a,{items:b.topics,fetchedAt:Date.now(),dirty:!1,unreadTopicIds:t?t.unreadTopicIds:new Set}),T.value&&!b.topics.some(X=>X.tid===T.value)&&(T.value=null),ye({ip:a,lTopUpdAt:b.topics[0]?.upAt??t?.items[0]?.upAt??0},{markDirty:!1,markUnread:!!t?.unreadTopicIds.size})}finally{ee.delete(a)}}}async function We(a,s,t=!1){if(!s)return;const b=m.get(s);if(!(!t&&b&&!b.dirty)&&!ne.get(s)){ne.set(s,!0);try{const X=await Gn(a,s,{start:0,limit:200});m.set(s,{items:X.msgs,total:X.total,fetchedAt:Date.now(),dirty:!1,fullyLoaded:X.msgs.length>=X.total,topicHashNoReason:X.topicHashNoReason??null,topicHashWithReason:X.topicHashWithReason??null}),xe(a,s),Ce(a)}finally{ne.delete(s)}}}async function $t(a,s=!1){if(!a)return;const t=i.get(a);if(!s&&t)return t.data;if(E.get(a))return t?.data;E.set(a,!0);try{const b=await Yn(a);return i.set(a,{data:b,fetchedAt:Date.now()}),b}finally{E.delete(a)}}async function Ct(a,s=!1){if(!a)return;const t=w.get(a);if(!s&&t)return t.data;const b=await Jn(a);return w.set(a,{data:b,fetchedAt:Date.now()}),b}async function St(a,s=!1){if(!a)return;const t=v.get(a);if(!s&&t)return t.data;const b=await Qn(a);return v.set(a,{data:b,fetchedAt:Date.now()}),b}async function Mt(a,s=!1){if(!a)return;const t=k.get(a);if(!s&&t)return t.data;const b=await Xn(a);return k.set(a,{data:b,fetchedAt:Date.now()}),b}async function It(a,s={}){if(!a)return;const t=`${a}:${s.offset??0}:${s.limit??""}`,b=N.get(t);if(!s.force&&b)return b.data;if(l.get(t))return b?.data;l.set(t,!0);try{const X=await Zn(a,{offset:s.offset,limit:s.limit});return N.set(t,{data:X,fetchedAt:Date.now()}),X}finally{l.delete(t)}}async function xt(a,s){if(!s.length)return;await es({ip:a,topicIds:s});const t=d.get(a);if(t){const b=t.items.filter(K=>!s.includes(K.tid)),X=new Set(t.unreadTopicIds);s.forEach(K=>X.delete(K)),d.set(a,{items:b,fetchedAt:Date.now(),dirty:!1,unreadTopicIds:X})}s.forEach(b=>m.delete(b)),T.value&&s.includes(T.value)&&(T.value=null),await De()}async function Pt(a){await ts({ip:a}),r.delete(a),d.delete(a),Array.from(m.keys()).forEach(t=>{dt(t)===a&&m.delete(t)}),g.value===a&&(g.value=null,T.value=null),await De()}async function At(a,s,t){await ss({ip:a,durationMs:s,reason:t}),await Ne(!0)}async function Et(a){await os({ip:a}),await Ne(!0)}async function Rt(a){await ls({aliasName:a}),await Pe(!0)}async function Ne(a=!1){if(!J.value&&!(!a&&q.value&&Date.now()-(q.value.now||0)<3e4)){J.value=!0;try{q.value=await ns()}finally{J.value=!1}}}async function Pe(a=!1){if(te.value)return;const s=L.value?.aliasKeys?.[0];if(!(!a&&L.value&&s&&Date.now()-s.upAt<3e4)){te.value=!0;try{L.value=await as()}finally{te.value=!1}}}function Ke(a){a!==g.value&&(g.value=a,F.value=1,T.value=null,a&&(Le(a),Ce(a)))}function nt(a){a!==T.value&&(T.value=a,a&&g.value&&(We(g.value,a),xe(g.value,a)))}function dt(a){for(const[s,t]of d.entries())if(t.items.some(b=>b.tid===a))return s;return null}function pt(){g.value&&Ce(g.value)}function qt(a,s){const t=d.get(a);return t?t.unreadTopicIds.has(s):!1}function ft(a){return i.get(a)?.data??null}function Dt(a){return w.get(a)?.data??null}function Lt(a){return v.get(a)?.data??null}function Ht(a){return k.get(a)?.data??null}const{pause:Bt,resume:vt}=Kt(()=>{document.hidden||Se()},On,{immediate:!1});return kn(document,"visibilitychange",()=>{document.hidden?Bt():(Se(),vt())}),ve(u,a=>{a&&vt()},{immediate:!0}),{initialized:u,stats:n,ipSortKey:$,ipPage:H,ipPageSize:h,topicPage:F,topicPageSize:j,selectedIp:g,selectedTopic:T,topicFilter:W,ipFilter:A,connectionStatus:C,lastSuccessfulPoll:I,pollError:y,hasUnreadUpdates:M,paginatedIps:G,sortedIpList:B,currentIpTopics:he,paginatedTopics:me,currentTopicMessages:Ie,currentTopicMeta:Re,blockedIPs:q,aliasKeys:L,bootstrapData:o,globalDeltaSince:Y,lastDeltaAt:V,loadingLightStats:D,loadingFullStats:P,loadingBlockedIPs:J,loadingAliasKeys:te,loadingTopics:ee,loadingMessages:ne,loadingMessageDetail:E,initialize:tt,refreshLightStats:Se,refreshFullStats:De,applyGlobalDelta:Oe,ensureTopics:Le,ensureMessages:We,loadMessageDetail:$t,loadMessageRequestBody:Ct,loadMessageRequestHeaders:St,loadModelErrorDetails:Mt,loadAttachmentText:It,removeTopics:xt,removeIp:Pt,banIp:At,unbanIp:Et,removeAlias:Rt,refreshBlockedIPs:Ne,refreshAliasKeys:Pe,setSelectedIp:Ke,setSelectedTopic:nt,acknowledgeUpdates:pt,isTopicUnread:qt,getMessageDetail:ft,getMessageRequestBody:Dt,getMessageRequestHeaders:Lt,getModelErrorDetails:Ht}}),is=de({inheritAttrs:!1,__name:"IconSymbol",props:{name:{}},setup(u){const n=Tn(),r=u,d={assistant:"🤖",check_circle:"✔",chevron_left:"‹",chevron_right:"›",close:"✕",content_copy:"⧉",description:"📝",data_object:"{}",delete:"🗑",download:"⬇",error:"⛔",expand_more:"⌄",filter_alt:"⛃",gavel:"🔨",gpp_maybe:"⚠",help:"？",info:"ℹ",key:"🔑",image:"🖼",list:"≡",attach_file:"📎",open_in_new:"↗",psychology:"🧠",psychology_alt:"🧠",refresh:"⟳",search:"🔍",sort:"⇅",sync:"⟳",visibility:"👁",warning:"⚠",zoom_in:"＋",default:"•"},m=f(()=>d[r.name]??d.default);return(i,w)=>(c(),p("span",$n({class:"material-symbols-outlined icon-symbol",role:"img","aria-hidden":"true"},S(n)),_(m.value),17))}}),pe=(u,n)=>{const r=u.__vccOpts||u;for(const[d,m]of n)r[d]=m;return r},z=pe(is,[["__scopeId","data-v-ba526ecf"]]),us="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let cs=(u=21)=>{let n="",r=crypto.getRandomValues(new Uint8Array(u|=0));for(;u--;)n+=us[r[u]&63];return n};const ge=Nt("ui",()=>{const u=R([]),n=re({open:!1,payload:null}),r=re({open:!1,src:"",name:void 0}),d=re({open:!1,options:null,resolve:null}),m=R(!1),i=R(!1),w=R(!1);function v(h){const F={id:cs(8),type:h.type,title:h.title,message:h.message,duration:h.duration??5e3,createdAt:Date.now()};u.value=[...u.value,F],window.setTimeout(()=>k(F.id),F.duration)}function k(h){u.value=u.value.filter(F=>F.id!==h)}function N(h){n.open=!0,n.payload=h}function q(){n.open=!1,n.payload=null}function L(h,F){r.open=!0,r.src=h,r.name=F}function g(){r.open=!1,r.src="",r.name=void 0}function T(h){return d.open&&d.resolve&&d.resolve(!1),new Promise(F=>{d.open=!0,d.options=h,d.resolve=F})}function W(h){d.resolve&&d.resolve(h),d.open=!1,d.options=null,d.resolve=null}function A(h){m.value=h??!m.value}function $(h){i.value=h??!i.value}function H(h){w.value=h??!w.value}return{toasts:u,preview:n,imagePreview:r,confirmDialog:d,banManagerOpen:m,aliasManagerOpen:i,helpPanelOpen:w,pushToast:v,dismissToast:k,showPreview:N,closePreview:q,showImagePreview:L,closeImagePreview:g,confirm:T,resolveConfirm:W,toggleBanManager:A,toggleAliasManager:$,toggleHelpPanel:H}});Ze.extend(Hn);Ze.extend(Bn);Ze.locale("zh-cn");const tn=["B","KB","MB","GB","TB"];function ke(u,n=1){if(!Number.isFinite(u))return"0 B";const r=Math.abs(u);if(r===0)return"0 B";const d=Math.min(Math.floor(Math.log10(r)/3),tn.length-1),m=u/Math.pow(1024,d);return`${m.toFixed(m>=10?0:n)} ${tn[d]}`}function fn(u){return Number.isFinite(u)?new Intl.NumberFormat("zh-CN").format(u):"0"}function Me(u){return Ze(u).format("YYYY-MM-DD HH:mm:ss")}function Gt(u){return Ze(u).fromNow()}function vn(u){if(u<=0)return"0秒";const n=Ze.duration(u),r=[];n.days()&&r.push(`${n.days()}天`),n.hours()&&r.push(`${n.hours()}小时`),n.minutes()&&r.push(`${n.minutes()}分`);const d=n.seconds();return(d||r.length===0)&&r.push(`${d}秒`),r.join("")}const mn=Cn(()=>{const u=R(Date.now());return Kt(()=>{u.value=Date.now()},3e4,{immediate:!0}),u}),Yt=mn;function Jt(u){const n=mn();return f(()=>{n.value;const r=Sn(u);return r==null?"—":Gt(r)})}const ds={class:"stats-header__pinned"},ps={class:"stats-header__pinned-row"},fs={key:0,class:"badge badge--success"},vs={key:0,class:"stats-header__pinned-banner"},ms={class:"status-banner status-banner--error status-banner--compact"},hs=["disabled"],gs={class:"stats-header__content"},ys={class:"stats-header__top"},_s={class:"stats-header__title"},bs={class:"stats-header__badges"},ws={key:0,class:"badge badge--success"},ks={class:"stats-header__actions"},Ts=["disabled"],$s={key:0,class:"stats-header__banner status-banner status-banner--error"},Cs=["disabled"],Ss={key:1,class:"stats-header__grid"},Ms={class:"metric-card"},Is={class:"metric-value"},xs={class:"metric-card"},Ps={class:"metric-value"},As={class:"metric-card"},Es={class:"metric-value"},Rs={class:"metric-card"},qs={class:"metric-value"},Ds={class:"metric-card"},Ls={class:"metric-value"},Hs={class:"metric-card"},Bs={class:"metric-value"},Fs=de({__name:"StatsHeader",setup(u){const n=Ee(),r=ge(),d=R(!1),m=R(!1);let i=null;const w=f(()=>n.hasUnreadUpdates),v=f(()=>n.connectionStatus==="connected"?"已连接":"连接中断"),k=f(()=>["badge",n.connectionStatus==="connected"?"badge--success":"badge--danger"]),N=f(()=>n.loadingLightStats||n.loadingFullStats),q=f(()=>n.pollError),L=Yt(),g=Jt(()=>n.lastDeltaAt??null),T=R(Date.now()),{pause:W}=Kt(()=>{T.value=Date.now()},1e3,{immediate:!0}),A=f(()=>{const I=n.stats;if(!I)return null;L.value;const y=T.value,D=I.sTime?Number(I.sTime):y,P=I.ts?Me(I.ts):"—",J=n.lastDeltaAt?g.value:"—";return{totalRequests:fn(I.totReqs??0),totalIn:ke(I.totInTfc??0),totalOut:ke(I.totOutTfc??0),uptime:vn(y-D),lastUpdate:P,lastDelta:J}});function $(){n.refreshFullStats(),n.refreshLightStats()}function H(){$()}function h(){i!==null&&(window.clearTimeout(i),i=null),d.value=!0}function F(I=500){i!==null&&window.clearTimeout(i),i=window.setTimeout(()=>{m.value||(d.value=!1)},I)}function j(I){I.clientY<=110?h():F()}function Y(I){const y=I.touches[0];y&&(y.clientY<=120?h():F())}function V(){m.value=!0,h()}function C(){m.value=!1,F(350)}return ct(()=>{window.addEventListener("mousemove",j),window.addEventListener("touchstart",Y,{passive:!0}),F(0)}),jt(()=>{W(),window.removeEventListener("mousemove",j),window.removeEventListener("touchstart",Y),i!==null&&window.clearTimeout(i)}),(I,y)=>(c(),p("header",{class:le(["stats-header",{"stats-header--collapsed":!d.value}]),onMouseenter:V,onMouseleave:C},[e("div",ds,[e("div",ps,[e("span",{class:le(["badge",k.value])},[y[1]||(y[1]=e("span",{class:"dot"},null,-1)),se(" "+_(v.value),1)],2),w.value?(c(),p("span",fs,[...y[2]||(y[2]=[e("span",{class:"dot"},null,-1),se(" 有新消息 ",-1)])])):U("",!0)]),q.value?(c(),p("div",vs,[e("div",ms,[x(z,{name:"error"}),e("div",null,[y[3]||(y[3]=e("strong",null,"同步异常",-1)),e("p",null,_(q.value),1)]),e("button",{class:"ghost-button",type:"button",disabled:N.value,onClick:Z(H,["stop"])},[x(z,{name:"refresh"}),y[4]||(y[4]=e("span",null,"重试",-1))],8,hs)])])):U("",!0)]),e("div",gs,[e("div",ys,[e("div",_s,[y[7]||(y[7]=e("h1",null,"Gemini Proxy 控制台",-1)),e("div",bs,[e("span",{class:le(["badge",k.value])},[y[5]||(y[5]=e("span",{class:"dot"},null,-1)),se(" "+_(v.value),1)],2),w.value?(c(),p("span",ws,[...y[6]||(y[6]=[e("span",{class:"dot"},null,-1),se(" 有新消息 ",-1)])])):U("",!0)])]),e("div",ks,[e("button",{class:"ghost-button",onClick:$,disabled:N.value},[x(z,{name:"refresh"}),y[8]||(y[8]=e("span",null,"刷新",-1))],8,Ts),e("button",{class:"ghost-button",onClick:y[0]||(y[0]=D=>S(r).toggleHelpPanel(!0))},[x(z,{name:"help"}),y[9]||(y[9]=e("span",null,"帮助",-1))])])]),q.value?(c(),p("div",$s,[x(z,{name:"error"}),e("div",null,[y[10]||(y[10]=e("strong",null,"同步异常",-1)),e("p",null,_(q.value),1)]),e("button",{class:"ghost-button",type:"button",disabled:N.value,onClick:H},[x(z,{name:"refresh"}),y[11]||(y[11]=e("span",null,"重试",-1))],8,Cs)])):U("",!0),A.value?(c(),p("div",Ss,[e("div",Ms,[y[12]||(y[12]=e("p",{class:"metric-title"},"总请求数",-1)),e("p",Is,_(A.value.totalRequests),1)]),e("div",xs,[y[13]||(y[13]=e("p",{class:"metric-title"},"入站流量",-1)),e("p",Ps,_(A.value.totalIn),1)]),e("div",As,[y[14]||(y[14]=e("p",{class:"metric-title"},"出站流量",-1)),e("p",Es,_(A.value.totalOut),1)]),e("div",Rs,[y[15]||(y[15]=e("p",{class:"metric-title"},"运行时长",-1)),e("p",qs,_(A.value.uptime),1)]),e("div",Ds,[y[16]||(y[16]=e("p",{class:"metric-title"},"最后更新检查时间",-1)),e("p",Ls,_(A.value.lastUpdate),1)]),e("div",Hs,[y[17]||(y[17]=e("p",{class:"metric-title"},"上次增量",-1)),e("p",Bs,_(A.value.lastDelta),1)])])):U("",!0)])],34))}}),zs=pe(Fs,[["__scopeId","data-v-15fbcf86"]]),Ye=500,Us=72,Os=56,Ws=960,Ns=640,Ut=1440,it=900,nn=.75,_t=1,sn=6,hn=.75,on=64,an=(u,n,r)=>Math.min(Math.max(u,n),r),Je=u=>typeof u=="number"&&Number.isFinite(u),Ae=(u,n,r=hn)=>Math.abs(u-n)>r,gn=/^-?\d+(\.\d+)?$/;function ut(u){const n=Number.parseFloat(u);return Number.isFinite(n)?Math.max(0,n):null}function Qe(u,n){if(u==null)return n;if(typeof u=="number")return u>=0?u:n;const r=String(u).trim().toLowerCase();return r?gn.test(r)?ut(r)??n:r.endsWith("px")?ut(r.slice(0,-2))??n:n:n}function ln(u,{viewportHeight:n,fallback:r}){if(u==null)return r;if(typeof u=="number")return u>=0?u:r;const d=String(u).trim().toLowerCase();if(!d)return r;if(gn.test(d))return ut(d)??r;if(d.endsWith("px"))return ut(d.slice(0,-2))??r;if(d.endsWith("vh")){const m=n>0?n:typeof window<"u"?window.innerHeight:it,i=ut(d.slice(0,-2));return m<=0||i==null?r:Math.max(0,i/100*m)}return r}function Ks(u){const n=u.cards,r=u.activeBuffer,d=u.defaultStackDirection??"right",m=u.minHeader??{horizontal:Us,vertical:Os},i=u.maxHeader??{horizontal:Ws,vertical:Ns},w=n.find($=>$.initialFocus)?.id??(n.length>0?n[n.length-1].id:null),v=re({viewport:{width:1440,height:900},container:{width:1280,height:800},cards:n.map(($,H)=>({id:$.id,zIndex:$.zIndex??H+1,rightStackHeaderWidth:$.rightStackHeaderWidth??m.horizontal,downStackHeaderHeight:$.downStackHeaderHeight??m.vertical,isFocused:$.initialFocus??!1,contentWidth:Qe($.minContentWidth,Ye),contentHeight:ln($.contentHeight,{viewportHeight:it,fallback:Ye}),config:$}))});let k;if(u.breakpointWidth!=null)k=u.breakpointWidth;else{let $=0,H=0;for(let h=v.cards.length-1;h>=0;h--){const F=v.cards[h],j=Qe(F.config.minContentWidth,Ye)+H;$=Math.max($,j),H+=F.rightStackHeaderWidth}k=$}let N=d;const q=f(()=>{const $=v.container.width||v.viewport.width||Ut,H=v.container.height||v.viewport.height||it,h=v.viewport.width||Ut,F=v.viewport.height||it;let j=d;if(d==="right"){const y=Math.max(0,k-on),D=k+on,P=()=>{let ee=0;for(let ne=0;ne<v.cards.length;ne++){const E=v.cards[ne],l=Qe(E.config.minContentWidth,Ye),o=$-ee;if(l>o+hn)return!0;ee+=E.rightStackHeaderWidth}return!1},J=h<y,te=$<y;if(N==="down"){const ee=h>D,ne=$>D&&!P();j=ee&&ne?"right":"down"}else j=J||te||P()?"down":"right"}N=j;let Y=0,V=0;const C=[];if(j==="right"){let y=0;for(let D=0;D<v.cards.length;D++)C[D]=Math.max(0,$-y),y+=v.cards[D].rightStackHeaderWidth}const I=v.cards.map((y,D)=>{const{config:P}=y,J=j==="right",te=J?y.rightStackHeaderWidth:y.downStackHeaderHeight;let ee;if(J){const o=Qe(P.minContentWidth,Ye),M=Math.max(0,C[D]??$);let O=o;P.minContentWidth!=null&&(O=Math.max(O,Qe(P.minContentWidth,0)));const B=P.maxContentWidth!=null?Qe(P.maxContentWidth,1/0):1/0;if(Number.isFinite(B)&&(O=Math.min(O,B)),D===v.cards.length-1){const G=Math.min(M,B);O=Math.max(O,G)}ee=Math.min(O,M)}else{const o=ln(P.contentHeight,{viewportHeight:F,fallback:Ye});ee=Math.min(o,H)}const ne=te,E=y.isFocused?ee+r:ne,l={zIndex:String(y.zIndex)};return J?(l.left=`${Y}px`,l.top="0px",l.width=`${ee}px`,l.height="100%"):(l.left="0px",l.top=`${Y}px`,l.width="100%",l.height=`${ee}px`),l["--panel-header-size"]=`${te}px`,l["--panel-main-size"]=`${ee}px`,l["--panel-collapsed-main"]=`${ne}px`,l["--panel-active-min"]=`${E}px`,V=Math.max(V,Y+ee),Y+=E,{...y,activeMin:E,mainSpan:ee,style:l}});return{stackDirection:j,cards:I,totalSpan:V,activeCardId:v.cards.find(y=>y.isFocused)?.id??w}});function L($,H){const h=$||(typeof window<"u"?window.innerWidth:Ut),F=H||(typeof window<"u"?window.innerHeight:it);Ae(v.viewport.width,h,_t)&&(v.viewport.width=h),Ae(v.viewport.height,F,_t)&&(v.viewport.height=F)}function g($,H){Je($)&&$>0&&Ae(v.container.width,$,_t)&&(v.container.width=$),Je(H)&&H>0&&Ae(v.container.height,H,_t)&&(v.container.height=H)}function T($){v.cards.forEach(H=>{H.isFocused=$?H.id===$:!1})}function W($,H,h){const F=v.cards.find(j=>j.id===$);F&&(Je(H)&&H>0&&Ae(F.contentWidth,H,sn)&&(F.contentWidth=H),Je(h)&&h>0&&Ae(F.contentHeight,h,sn)&&(F.contentHeight=h))}function A($,H,h){const F=v.cards.find(j=>j.id===$);if(F){if(Je(H)&&H>0){const j=an(H,m.horizontal,i.horizontal);Ae(F.rightStackHeaderWidth,j,nn)&&(F.rightStackHeaderWidth=j)}if(Je(h)&&h>0){const j=an(h,m.vertical,i.vertical);Ae(F.downStackHeaderHeight,j,nn)&&(F.downStackHeaderHeight=j)}}}return{layout:q,setViewport:L,setContainerSize:g,setFocusedCard:T,updateCardMetrics:W,updateCardHeader:A}}const Tt=Symbol("panel-layout-hooks"),js={ipList:{id:"ipList",minContentWidth:500,contentHeight:"60vh",zIndex:1},topicList:{id:"topicList",minContentWidth:560,contentHeight:"60vh",zIndex:2},messageList:{id:"messageList",minContentWidth:720,contentHeight:"80vh",zIndex:3}};function Vs(u){return{...u}}function Gs(u){const n=u.map(m=>Vs(js[m])),r=Ks({cards:n,defaultStackDirection:"right",activeBuffer:20});return{layout:f(()=>{const m=r.layout.value;return{stackDirection:m.stackDirection,panels:m.cards.map(i=>({...i,id:i.id})),totalSpan:m.totalSpan,activePanelId:m.activeCardId?m.activeCardId:null}}),setViewport:r.setViewport,setContainerSize:r.setContainerSize,setFocusedPanel:r.setFocusedCard,updatePanelMetrics:r.updateCardMetrics,updatePanelHeader:r.updateCardHeader}}let Ot=null,Wt=null;function rn(u,n){const r=Math.max(n*1.6,220);if(typeof window>"u")return r;Ot||(Ot=document.createElement("canvas")),Wt||(Wt=Ot.getContext("2d"));const d=Wt;if(!d)return r;const i=window.getComputedStyle(document.body).font||'14px "Inter", "Segoe UI", system-ui, sans-serif';d.font=i;let w=0;return u.forEach(k=>{if(!k?.label)return;const N=d.measureText(k.label);w=Math.max(w,N.width)}),Math.max(r,Math.ceil(w+96))}const un="control-button--overlay-hidden",bt="__overlay__none__",Qt=Nt("controlOverlay",()=>{const u=re({top:0,left:0,width:0,height:0}),n=R(!1),r=R(!1),d=R(!1),m=R(""),i=R("filter"),w=R(""),v=R(""),k=R(""),N=R([]),q=R("left"),L=R(0),g=R(220),T=R(!1),W=R(!1),A=yt(null),$=R(!1);let H=null;const h=yt(null),F=yt(null),j=yt(null);function Y(B){const G=B.getBoundingClientRect();u.top=G.top,u.left=G.left,u.width=G.width,u.height=G.height}let V=null;function C(){V!==null&&(window.clearTimeout(V),V=null)}function I(){H!==null&&(window.clearTimeout(H),H=null),$.value=!1}function y(B=260){I(),$.value=!0,H=window.setTimeout(()=>{$.value=!1,H=null},B)}function D(B){if(!B)return;const G=B.dataset;G.overlayPrevAria||(G.overlayPrevAria=B.getAttribute("aria-hidden")??bt),G.overlayPrevTabindex||(G.overlayPrevTabindex=B.getAttribute("tabindex")??bt),B.setAttribute("aria-hidden","true"),B.setAttribute("tabindex","-1"),G.overlayHidden="true",B.classList.add(un)}function P(B){if(!B)return;const G=B.dataset;B.classList.remove(un),G.overlayHidden&&delete G.overlayHidden,G.overlayPrevAria?(G.overlayPrevAria===bt?B.removeAttribute("aria-hidden"):B.setAttribute("aria-hidden",G.overlayPrevAria),delete G.overlayPrevAria):B.removeAttribute("aria-hidden"),G.overlayPrevTabindex?(G.overlayPrevTabindex===bt?B.removeAttribute("tabindex"):B.setAttribute("tabindex",G.overlayPrevTabindex),delete G.overlayPrevTabindex):B.removeAttribute("tabindex")}function J(B){const G=A.value,we=G!==null&&G!==B.anchorEl,he=n.value;we&&P(G),A.value=B.anchorEl,Y(B.anchorEl),D(B.anchorEl),m.value=B.controlId,i.value=B.variant,w.value=B.label,v.value=B.icon,k.value=B.value,N.value=B.options?.slice()??[],q.value=B.align??"left";const me=B.collapsedWidth??u.width;L.value=me,T.value=B.collapsedWidth!=null,B.expandedWidth!=null?(g.value=Math.max(B.expandedWidth,me),W.value=!0):B.variant==="sort"?(g.value=Math.max(rn(N.value,me),me),W.value=!1):(g.value=Math.max(u.width*4,220,me),W.value=!1),h.value=B.onInput??null,F.value=B.onCommit??null,j.value=B.onCancel??null,C();const Ie=we&&he;d.value=!1,Ie?(y(),r.value=!0,n.value=!0):(I(),r.value=!1,n.value=!0)}function te(B){k.value=B,h.value?.(B)}function ee(B){const G=B??k.value;k.value=G,F.value?.(G),l()}function ne(){n.value&&(C(),d.value=!1,r.value=!0)}function E(B=160){n.value&&(C(),V=window.setTimeout(()=>{V=null,l()},B))}function l(B=!1){if(n.value&&(C(),!(d.value&&!B))){if(B){r.value=!1,d.value=!1,n.value=!1,M();return}d.value||(r.value=!1,d.value=!0)}}function o(){j.value?.(),l()}function M(){C(),I(),A.value&&P(A.value),A.value=null,n.value=!1,d.value=!1,r.value=!1,m.value="",T.value=!1,W.value=!1,h.value=null,F.value=null,j.value=null}function O(){A.value&&(Y(A.value),T.value||(L.value=u.width),W.value||(i.value==="sort"?g.value=Math.max(rn(N.value,L.value),L.value):g.value=Math.max(u.width*4,220,L.value)))}return{rect:u,visible:n,expanded:r,closing:d,relocating:$,controlId:m,variant:i,label:w,icon:v,value:k,options:N,align:q,collapsedWidth:L,expandedWidth:g,open:J,updateValue:te,commit:ee,requestClose:l,cancel:o,finalize:M,refreshAnchorRect:O,beginInteraction:ne,scheduleClose:E}}),Ys={key:0,class:"panel-rail__meta"},Js={class:"panel-rail__controls"},Qs={class:"panel-rail__actions"},Xs=["title"],Zs=["title"],eo=["disabled"],to=["disabled"],no={class:"panel-main"},so={class:"panel-header__primary"},oo={key:0,class:"panel-header__count"},ao={class:"panel-header__controls"},lo={class:"panel-header__actions"},ro=["title"],io=["title"],uo=["disabled"],co=["disabled"],po={class:"panel-content ip-list"},fo=["onClick"],vo={class:"ip-item__header"},mo={class:"ip-item__identity"},ho={class:"ip-item__name"},go={key:0,class:"ip-item__alias"},yo={class:"ip-item__alias-text"},_o={class:"ip-item__alias-popover"},bo=["title"],wo={class:"ip-item__metrics"},ko={key:0,class:"empty-state"},To={class:"panel-footer"},$o=["disabled"],Co={class:"page-info"},So=["disabled"],Mo=de({__name:"IpListPanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(u,{expose:n,emit:r}){const d=u,m=r,i=Ee(),w=ge(),v=f(()=>i.paginatedIps),k=f(()=>i.selectedIp),N=f(()=>Math.max(1,Math.ceil(i.sortedIpList.length/i.ipPageSize))),q=f(()=>i.sortedIpList.length),L=f(()=>i.ipFilter.trim().length>0),g=Yt(),T=[{value:"recent",label:"最近活跃"},{value:"reqs",label:"请求数"},{value:"in",label:"入流量"},{value:"out",label:"出流量"}],W=T[0]?.value??"",A=R(null),$=R(null),H=Vt(Tt,null),h=Qt(),F=R(null),j=R(null),Y=f(()=>d.collapsed===!0),V=f(()=>T.find(l=>l.value===i.ipSortKey)?.label??"最近活跃");H?.ipList&&(Fe(A,E=>{const l=E[0];if(!l)return;const o=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:l.borderBoxSize,M=o?o.inlineSize:l.contentRect.width;M>0&&H.ipList.reportHeaderSize({width:M,height:0})}),Fe($,E=>{const l=E[0];if(!l)return;const o=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:l.borderBoxSize,M=o?o.blockSize:l.contentRect.height;M>0&&H.ipList.reportHeaderSize({width:0,height:M})}));function C(E){i.setSelectedIp(E)}function I(){m("request-focus")}function y(E,l){const o=E?.currentTarget;return o instanceof HTMLElement?o:l}function D(E){const l=y(E,F.value);if(!l)return;if(h.visible&&h.controlId==="ip-filter")if(h.closing)h.finalize();else{h.refreshAnchorRect();return}const o=i.ipFilter;h.open({controlId:"ip-filter",anchorEl:l,variant:"filter",label:"过滤 IP",icon:"search",value:o,expandedWidth:280,onInput(M){i.ipFilter=M},onCommit(M){i.ipFilter=M.trim()},onCancel(){i.ipFilter=o}})}function P(E){const l=y(E,j.value);if(!l)return;if(h.visible&&h.controlId==="ip-sort")if(h.closing)h.finalize();else{h.refreshAnchorRect();return}const o=i.ipSortKey;h.open({controlId:"ip-sort",anchorEl:l,variant:"sort",label:"排序方式",icon:"sort",value:i.ipSortKey,options:T,onCommit(M){i.ipSortKey=M},onCancel(){i.ipSortKey=o}})}function J(E){const{lModReqAt:l,lTopUpdAt:o}=E.summary,M=l??o;return g.value,M?Gt(M):"—"}function te(E){const{lModReqAt:l,lTopUpdAt:o}=E.summary,M=l??o;return M?Me(M):"—"}async function ee(){if(!(!k.value||!await w.confirm({title:"删除 IP 数据",message:`确定要删除 IP “${k.value}” 的所有话题和消息吗？该操作不可恢复。`,confirmLabel:"删除",destructive:!0})))try{await i.removeIp(k.value),w.pushToast({type:"success",title:"删除成功",message:"IP 数据已清理。"})}catch(l){w.pushToast({type:"error",title:"删除失败",message:l instanceof Error?l.message:String(l)})}}function ne(){h.visible&&(h.controlId==="ip-filter"||h.controlId==="ip-sort")&&h.requestClose()}return n({resetToCollapsedState:ne}),(E,l)=>(c(),p("section",{class:le(["panel panel--ip",{"panel--collapsed":Y.value}]),onMouseenter:I,onFocusin:I,onPointerdownCapture:I},[u.stackDirection==="right"?(c(),p("aside",{key:0,ref_key:"desktopHeaderEl",ref:A,class:"panel-rail panel-rail--desktop"},[l[29]||(l[29]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"IP 列表",-1)),q.value?(c(),p("div",Ys,[e("strong",null,_(q.value),1),l[28]||(l[28]=e("span",null,"IP",-1))])):U("",!0),e("div",Js,[e("div",Qs,[e("button",{ref_key:"filterTriggerEl",ref:F,class:le(["control-button control-button--icon",{"control-button--active":L.value}]),type:"button","aria-label":"过滤 IP",title:L.value?`过滤：${S(i).ipFilter}`:"过滤 IP",onMouseenter:l[0]||(l[0]=o=>D(o)),onFocus:l[1]||(l[1]=o=>D(o)),onClick:l[2]||(l[2]=o=>D(o)),onKeydown:[l[3]||(l[3]=fe(Z(o=>D(o),["prevent"]),["enter"])),l[4]||(l[4]=fe(Z(o=>D(o),["prevent"]),["space"]))]},[x(z,{name:"search"})],42,Xs),e("button",{ref_key:"sortTriggerEl",ref:j,class:le(["control-button control-button--icon",{"control-button--active":S(i).ipSortKey!==S(W)}]),type:"button","aria-label":"排序方式",title:`排序：${V.value}`,onMouseenter:l[5]||(l[5]=o=>P(o)),onFocus:l[6]||(l[6]=o=>P(o)),onClick:l[7]||(l[7]=o=>P(o)),onKeydown:[l[8]||(l[8]=fe(Z(o=>P(o),["prevent"]),["enter"])),l[9]||(l[9]=fe(Z(o=>P(o),["prevent"]),["space"]))]},[x(z,{name:"sort"})],42,Zs),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新","aria-label":"刷新",disabled:S(i).loadingFullStats,onClick:l[10]||(l[10]=(...o)=>S(i).refreshFullStats&&S(i).refreshFullStats(...o))},[x(z,{name:"sync"})],8,eo),e("button",{class:"control-button control-button--icon",type:"button",title:"封禁管理","aria-label":"封禁管理",onClick:l[11]||(l[11]=o=>S(w).toggleBanManager(!0))},[x(z,{name:"gpp_maybe"})]),e("button",{class:"control-button control-button--icon",type:"button",title:"别名管理","aria-label":"别名管理",onClick:l[12]||(l[12]=o=>S(w).toggleAliasManager(!0))},[x(z,{name:"key"})]),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除当前 IP","aria-label":"删除当前 IP",disabled:!k.value,onClick:ee},[x(z,{name:"delete"})],8,to)])])],512)):U("",!0),e("div",no,[u.stackDirection==="down"?(c(),p("header",{key:0,ref_key:"mobileHeaderEl",ref:$,class:"panel-header panel-header--mobile"},[e("div",so,[l[30]||(l[30]=e("h2",null,"IP 列表",-1)),q.value?(c(),p("span",oo,_(q.value),1)):U("",!0)]),e("div",ao,[e("div",lo,[e("button",{class:le(["control-button control-button--icon",{"control-button--active":L.value}]),type:"button","aria-label":"过滤 IP",title:L.value?`过滤：${S(i).ipFilter}`:"过滤 IP",onMouseenter:l[13]||(l[13]=o=>D(o)),onFocus:l[14]||(l[14]=o=>D(o)),onClick:l[15]||(l[15]=o=>D(o)),onKeydown:[l[16]||(l[16]=fe(Z(o=>D(o),["prevent"]),["enter"])),l[17]||(l[17]=fe(Z(o=>D(o),["prevent"]),["space"]))]},[x(z,{name:"search"})],42,ro),e("button",{class:le(["control-button control-button--icon",{"control-button--active":S(i).ipSortKey!==S(W)}]),type:"button","aria-label":"排序方式",title:`排序：${V.value}`,onMouseenter:l[18]||(l[18]=o=>P(o)),onFocus:l[19]||(l[19]=o=>P(o)),onClick:l[20]||(l[20]=o=>P(o)),onKeydown:[l[21]||(l[21]=fe(Z(o=>P(o),["prevent"]),["enter"])),l[22]||(l[22]=fe(Z(o=>P(o),["prevent"]),["space"]))]},[x(z,{name:"sort"})],42,io),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新","aria-label":"刷新",disabled:S(i).loadingFullStats,onClick:l[23]||(l[23]=(...o)=>S(i).refreshFullStats&&S(i).refreshFullStats(...o))},[x(z,{name:"sync"})],8,uo),e("button",{class:"control-button control-button--icon",type:"button",title:"封禁管理","aria-label":"封禁管理",onClick:l[24]||(l[24]=o=>S(w).toggleBanManager(!0))},[x(z,{name:"gpp_maybe"})]),e("button",{class:"control-button control-button--icon",type:"button",title:"别名管理","aria-label":"别名管理",onClick:l[25]||(l[25]=o=>S(w).toggleAliasManager(!0))},[x(z,{name:"key"})]),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除当前 IP","aria-label":"删除当前 IP",disabled:!k.value,onClick:ee},[x(z,{name:"delete"})],8,co)])])],512)):U("",!0),e("div",po,[(c(!0),p(ce,null,be(v.value,o=>(c(),p("article",{key:o.ip,class:le(["ip-item",{"ip-item--active":o.ip===k.value,"ip-item--unread":o.unread}]),onClick:M=>C(o.ip)},[e("div",vo,[e("div",mo,[e("span",ho,_(o.ip),1),o.summary.realIPs?.length?(c(),p("span",go,[e("span",yo,"真实 IP ×"+_(o.summary.realIPs.length),1),e("span",_o,[l[31]||(l[31]=e("strong",null,"真实 IP",-1)),e("ul",null,[(c(!0),p(ce,null,be(o.summary.realIPs,M=>(c(),p("li",{key:M},_(M),1))),128))])])])):U("",!0)]),e("span",{class:"badge badge--ghost",title:te(o)},_(J(o)),9,bo)]),e("div",wo,[e("dl",null,[l[32]||(l[32]=e("dt",null,"请求",-1)),e("dd",null,_(S(fn)(o.summary.reqs)),1)]),e("dl",null,[l[33]||(l[33]=e("dt",null,"入流量",-1)),e("dd",null,_(S(ke)(o.summary.inTfc)),1)]),e("dl",null,[l[34]||(l[34]=e("dt",null,"出流量",-1)),e("dd",null,_(S(ke)(o.summary.outTfc)),1)])])],10,fo))),128)),v.value.length?U("",!0):(c(),p("div",ko,[...l[35]||(l[35]=[e("p",null,"暂无 IP 数据",-1)])]))]),e("footer",To,[e("button",{class:"control-button control-button--icon",disabled:S(i).ipPage<=1,"aria-label":"上一页",title:"上一页",onClick:l[26]||(l[26]=o=>S(i).ipPage--)},[x(z,{name:"chevron_left"})],8,$o),e("span",Co,"第 "+_(S(i).ipPage)+" 页 / 共 "+_(N.value)+" 页",1),e("button",{class:"control-button control-button--icon",disabled:S(i).ipPage>=N.value,"aria-label":"下一页",title:"下一页",onClick:l[27]||(l[27]=o=>S(i).ipPage++)},[x(z,{name:"chevron_right"})],8,So)])])],34))}}),Io=pe(Mo,[["__scopeId","data-v-3a2bb42f"]]),xo={key:0,class:"panel-rail__meta"},Po=["title"],Ao={key:1,class:"panel-rail__meta panel-rail__meta--empty"},Eo={class:"panel-rail__controls"},Ro={class:"panel-rail__actions"},qo=["title","disabled"],Do=["disabled"],Lo=["disabled"],Ho={class:"panel-main"},Bo={class:"panel-header__title"},Fo={class:"panel-header__primary"},zo={key:0,class:"panel-header__count"},Uo={key:0,class:"panel-header__hint"},Oo={key:1,class:"panel-header__hint"},Wo={class:"panel-header__controls"},No={class:"panel-header__actions"},Ko=["title","disabled"],jo=["disabled"],Vo=["disabled"],Go={class:"panel-content topic-list"},Yo=["onClick"],Jo={class:"topic-item__header"},Qo={class:"topic-item__identity"},Xo={class:"topic-item__title-group"},Zo=["title"],ea={key:0,class:"badge badge--ghost"},ta=["title"],na={class:"topic-item__stats"},sa={key:0,class:"empty-state"},oa={class:"panel-footer"},aa=["disabled"],la={class:"page-info"},ra=["disabled"],ia=de({__name:"TopicListPanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(u,{expose:n,emit:r}){const d=u,m=r,i=Ee(),w=ge(),v=f(()=>i.selectedIp),k=f(()=>i.selectedTopic),N=f(()=>i.paginatedTopics),q=f(()=>Math.max(1,Math.ceil(i.currentIpTopics.length/i.topicPageSize))),L=f(()=>i.currentIpTopics.length),g=f(()=>i.topicFilter.trim().length>0),T=f(()=>{const l=v.value;return l?i.loadingTopics.get(l)===!0:!1}),W=Yt(),A=R(null),$=R(null),H=Vt(Tt,null),h=Qt(),F=R(null),j=f(()=>d.collapsed===!0);ve(v,l=>{!l&&h.visible&&h.controlId==="topic-filter"&&h.cancel()}),H?.topicList&&(Fe(A,l=>{const o=l[0];if(!o)return;const M=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize,O=M?M.inlineSize:o.contentRect.width;O>0&&H.topicList.reportHeaderSize({width:O,height:0})}),Fe($,l=>{const o=l[0];if(!o)return;const M=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize,O=M?M.blockSize:o.contentRect.height;O>0&&H.topicList.reportHeaderSize({width:0,height:O})}));function Y(l){i.setSelectedTopic(l)}function V(){m("request-focus")}function C(l,o){const M=l?.currentTarget;return M instanceof HTMLElement?M:o}function I(l){if(!v.value)return;const o=C(l,F.value);if(!o)return;if(h.visible&&h.controlId==="topic-filter")if(h.closing)h.finalize();else{h.refreshAnchorRect();return}const M=i.topicFilter;h.open({controlId:"topic-filter",anchorEl:o,variant:"filter",label:"过滤话题",icon:"search",value:M,expandedWidth:280,onInput(O){i.topicFilter=O},onCommit(O){i.topicFilter=O.trim()},onCancel(){i.topicFilter=M}})}function y(l){return W.value,Gt(l)}function D(l){const o=l.title;return typeof o=="string"&&o.trim().length>0?o.trim():null}function P(l){return D(l)??l.tid}function J(l){const o=D(l);return o?`${o} (ID: ${l.tid})`:l.tid}function te(l){const o=v.value;return o?i.isTopicUnread(o,l.tid):!1}async function ee(){v.value&&await i.ensureTopics(v.value,!0)}async function ne(){if(!(!v.value||!k.value||!await w.confirm({title:"删除话题",message:`确定永久删除话题 “${k.value}” 吗？该操作不可恢复。`,confirmLabel:"删除",destructive:!0})))try{await i.removeTopics(v.value,[k.value]),w.pushToast({type:"success",title:"删除成功",message:"话题已删除。"})}catch(o){w.pushToast({type:"error",title:"删除失败",message:o instanceof Error?o.message:String(o)})}}function E(){h.visible&&h.controlId==="topic-filter"&&h.requestClose()}return n({resetToCollapsedState:E}),(l,o)=>(c(),p("section",{class:le(["panel panel--topic",{"panel--collapsed":j.value}]),onMouseenter:V,onFocusin:V,onPointerdownCapture:V},[u.stackDirection==="right"?(c(),p("aside",{key:0,ref_key:"desktopRailEl",ref:A,class:"panel-rail panel-rail--desktop"},[o[14]||(o[14]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"话题列表",-1)),v.value?(c(),p("div",xo,[e("strong",null,_(L.value),1),o[12]||(o[12]=e("span",null,"话题",-1)),e("div",{class:"panel-rail__hint",title:v.value},"IP "+_(v.value),9,Po)])):(c(),p("div",Ao,[...o[13]||(o[13]=[e("span",null,"等待",-1),e("span",null,"选择 IP",-1)])])),e("div",Eo,[e("div",Ro,[e("button",{ref_key:"filterTriggerEl",ref:F,class:le(["control-button control-button--icon",{"control-button--active":g.value}]),type:"button","aria-label":"过滤话题",title:g.value?`过滤：${S(i).topicFilter}`:"过滤话题",disabled:!v.value,onMouseenter:o[0]||(o[0]=M=>I(M)),onFocus:o[1]||(o[1]=M=>I(M)),onClick:o[2]||(o[2]=M=>I(M)),onKeydown:[o[3]||(o[3]=fe(Z(M=>I(M),["prevent"]),["enter"])),o[4]||(o[4]=fe(Z(M=>I(M),["prevent"]),["space"]))]},[x(z,{name:"search"})],42,qo),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新话题","aria-label":"刷新话题",disabled:!v.value||T.value,onClick:ee},[x(z,{name:"sync"})],8,Do),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除话题","aria-label":"删除话题",disabled:!k.value,onClick:ne},[x(z,{name:"delete"})],8,Lo)])])],512)):U("",!0),e("div",Ho,[u.stackDirection==="down"?(c(),p("header",{key:0,ref_key:"mobileHeaderEl",ref:$,class:"panel-header panel-header--mobile"},[e("div",Bo,[e("div",Fo,[o[15]||(o[15]=e("h2",null,"话题列表",-1)),v.value?(c(),p("span",zo,_(L.value),1)):U("",!0)]),v.value?(c(),p("p",Uo,_(L.value)+" 个话题 · IP "+_(v.value),1)):(c(),p("p",Oo,"等待选择 IP"))]),e("div",Wo,[e("div",No,[e("button",{class:le(["control-button control-button--icon",{"control-button--active":g.value}]),type:"button","aria-label":"过滤话题",title:g.value?`过滤：${S(i).topicFilter}`:"过滤话题",disabled:!v.value,onMouseenter:o[5]||(o[5]=M=>I(M)),onFocus:o[6]||(o[6]=M=>I(M)),onClick:o[7]||(o[7]=M=>I(M)),onKeydown:[o[8]||(o[8]=fe(Z(M=>I(M),["prevent"]),["enter"])),o[9]||(o[9]=fe(Z(M=>I(M),["prevent"]),["space"]))]},[x(z,{name:"search"})],42,Ko),e("button",{class:"control-button control-button--icon",type:"button",title:"刷新话题","aria-label":"刷新话题",disabled:!v.value||T.value,onClick:ee},[x(z,{name:"sync"})],8,jo),e("button",{class:"control-button control-button--icon control-button--danger",type:"button",title:"删除话题","aria-label":"删除话题",disabled:!k.value,onClick:ne},[x(z,{name:"delete"})],8,Vo)])])],512)):U("",!0),e("div",Go,[(c(!0),p(ce,null,be(N.value,M=>(c(),p("article",{key:M.tid,class:le(["topic-item",{"topic-item--active":M.tid===k.value,"topic-item--unread":te(M)}]),onClick:O=>Y(M.tid)},[e("header",Jo,[e("div",Qo,[e("div",Xo,[e("span",{class:"topic-item__title",title:J(M)},_(P(M)),9,Zo)]),M.status?(c(),p("span",ea,_(M.status),1)):U("",!0)]),e("span",{class:"badge badge--ghost",title:S(Me)(M.upAt)},_(y(M.upAt)),9,ta)]),e("div",na,[e("dl",null,[o[16]||(o[16]=e("dt",null,"消息",-1)),e("dd",null,_(M.msgCnt),1)]),e("dl",null,[o[17]||(o[17]=e("dt",null,"入流量",-1)),e("dd",null,_(S(ke)(M.inBytes)),1)]),e("dl",null,[o[18]||(o[18]=e("dt",null,"出流量",-1)),e("dd",null,_(S(ke)(M.outBytes)),1)]),e("dl",null,[o[19]||(o[19]=e("dt",null,"创建",-1)),e("dd",null,_(S(Me)(M.ctAt)),1)])])],10,Yo))),128)),N.value.length?U("",!0):(c(),p("div",sa,[...o[20]||(o[20]=[e("p",null,"请选择左侧 IP 以查看话题。",-1)])]))]),e("footer",oa,[e("button",{class:"control-button control-button--icon",type:"button",title:"上一页","aria-label":"上一页",disabled:S(i).topicPage<=1,onClick:o[10]||(o[10]=M=>S(i).topicPage--)},[x(z,{name:"chevron_left"})],8,aa),e("span",la,"第 "+_(S(i).topicPage)+" 页 / 共 "+_(q.value)+" 页",1),e("button",{class:"control-button control-button--icon",type:"button",title:"下一页","aria-label":"下一页",disabled:S(i).topicPage>=q.value,onClick:o[11]||(o[11]=M=>S(i).topicPage++)},[x(z,{name:"chevron_right"})],8,ra)])])],34))}}),ua=pe(ia,[["__scopeId","data-v-0fd30b99"]]),ca={class:"message-card__header"},da={class:"message-card__meta"},pa={class:"badge badge--role"},fa=["title"],va={key:0,class:"badge badge--ghost",title:"Tokens"},ma={class:"message-card__actions"},ha=["title"],ga={key:0,class:"loading-dot"},ya=["disabled"],_a={key:0,class:"message-card__request-info"},ba={class:"request-info__label"},wa={class:"request-info__content"},ka=["data-open"],Ta={key:0,class:"request-body__loading"},$a={key:1,class:"request-body__error"},Ca={key:3,class:"request-body__empty"},Sa=["data-open"],Ma={key:0,class:"request-body__loading"},Ia={key:1,class:"request-body__error"},xa={key:3,class:"request-body__empty"},Pa={key:0,class:"message-card__model-meta"},Aa={key:0,class:"meta-item"},Ea={class:"meta-value"},Ra={key:1,class:"meta-item"},qa={class:"meta-value"},Da={key:2,class:"meta-item"},La={class:"meta-value"},Ha={key:3,class:"meta-item"},Ba={class:"token-details"},Fa={key:0},za={key:1},Ua={key:2},Oa={key:3},Wa={key:4,class:"token-breakdown"},Na={class:"token-breakdown__list"},Ka={class:"token-breakdown__item-label"},ja={class:"token-breakdown__item-value"},Va={key:4,class:"meta-item"},Ga={class:"meta-value"},Ya={key:1,class:"message-card__model-error"},Ja={class:"model-error__header"},Qa={key:0,class:"model-error__summary"},Xa=["data-open"],Za={key:0,class:"loading-dot loading-dot--inline"},el=["data-loading"],tl={key:0,class:"model-json__loading"},nl={key:1,class:"model-json__error"},sl={key:3,class:"model-json__empty"},ol={key:4,class:"model-json__placeholder"},al=de({__name:"MessageCard",props:{message:{},rootEl:{}},setup(u){const n=u,r=Ee(),d=ge(),m=R(!1),i=R(!1),w=R(!1),v=R(null),k=R(null),N=R(!1),q=R(!1),L=R(null),g=re({loading:!1,loaded:!1,error:null,data:null,raw:null}),T=re({loading:!1,loaded:!1,error:null,data:null,raw:null}),W=f(()=>r.getMessageDetail(n.message.id)),A=f(()=>W.value?.meta?.tokens?.totTokCnt??n.message.meta?.tokens?.totTokCnt??null),$=f(()=>r.getMessageRequestBody(n.message.id)),H=f(()=>r.getMessageRequestHeaders(n.message.id)),h=f(()=>W.value?.reqUrl??n.message.reqUrl??$.value?.requestUrl??H.value?.requestUrl??L.value??null),F=f(()=>W.value?.hasReqBody??n.message.hasReqBody??!1),j=f(()=>W.value?.hasReqHeaders??n.message.hasReqHeaders??!1),Y=f(()=>{if(g.loaded)return g.data??g.raw??null;const s=$.value;return s?s.requestBody??s.rawRequestBody??null:null}),V=f(()=>T.loaded?T.data:H.value?.requestHeaders??null),C=f(()=>T.loaded?T.raw:H.value?.rawRequestHeaders??null),I=f(()=>V.value??C.value),y=f(()=>{const s=V.value;return s?Object.keys(s).length:null}),D=f(()=>T.loading||T.error||j.value?!0:Pe(I.value)),P=f(()=>g.loading||g.error||F.value?!0:Pe(Y.value)),J=f(()=>g.loading),te=f(()=>g.error),ee=f(()=>T.loading),ne=f(()=>T.error),E=f(()=>Pe(Y.value)),l=f(()=>Pe(I.value)),o=f(()=>E.value?Ke(Y.value):""),M=f(()=>l.value?Ke(I.value):""),O=f(()=>{if(n.message.role!=="model")return null;const s=W.value?.meta??n.message.meta;if(!s)return null;const t=s.tokens??null,b=(ae,ot)=>{if(!ae||typeof ae!="object")return null;for(const gt of ot){const Ge=ae[gt];if(Ge==null)continue;const at=Number(Ge);if(Number.isFinite(at))return at;if(typeof Ge=="number")return Ge}return null},X=b(t,["promptTokenCount","pTokCnt","promptTokensCount"]),K=b(t,["candidatesTokenCount","candTokCnt"]),He=b(t,["thoughtsTokenCount","thgtTokCnt","thinkingTokenCount"]),je=b(t,["totalTokenCount","totTokCnt","totalTokensCount"]),st=t?.promptTokensDetails??t?.promptTokenDetails??t?.prompt_tokens_details??null,_e=Array.isArray(st)?st.map(ae=>{if(!ae||typeof ae!="object")return null;const ot=ae.modality??ae.type??ae.modalityType??ae.name,gt=typeof ot=="string"&&ot.trim().length?ot.trim():null,at=(()=>{for(const lt of["tokenCount","tokens","count","value","tokenCounts"]){if(ae[lt]===void 0||ae[lt]===null)continue;const Xt=Number(ae[lt]);if(Number.isFinite(Xt))return Xt;if(typeof ae[lt]=="number")return ae[lt]}return null})();return!gt&&at===null?null:{label:gt??"Prompt",tokenCount:at}}).filter(ae=>!!ae):null,Be={promptTokenCount:X,candidatesTokenCount:K,thoughtsTokenCount:He,totalTokenCount:je,promptTokensDetails:_e&&_e.length?_e:null},mt=[X,K,He,je].some(ae=>ae!=null)||!!(Be.promptTokensDetails&&Be.promptTokensDetails.length),ht=s.finishReason??t?.finishReason??null,ue=s.status;let oe=null;if(typeof ue=="number"&&Number.isFinite(ue))oe=ue;else if(typeof ue=="string"){const ae=Number(ue);oe=Number.isFinite(ae)?ae:ue}else ue!=null&&(oe=ue);const _n=typeof s.statusText=="string"&&s.statusText.trim().length?s.statusText:null,bn=s.modelName??s.modelVer??s.model??null,Ve=s.errCode;let Ft=null;typeof Ve=="string"||typeof Ve=="number"?Ft=Ve:Ve!=null&&(Ft=String(Ve));const wn=!!(s.hasErrDetails??s.hasErrorDetails??s.hasErrDetail??!1);return{status:oe,statusText:_n,modelName:bn,tokens:mt?Be:null,finishReason:ht??null,errMsg:typeof s.errMsg=="string"?s.errMsg:null,errStatus:typeof s.errStatus=="string"?s.errStatus:null,errCode:Ft,hasErrorDetails:wn}}),B=f(()=>O.value?.status??null),G=f(()=>{const s=B.value,t=Number(s);return Number.isFinite(t)?t:null}),we=f(()=>{const s=B.value,t=O.value?.statusText?.trim()??"",b=s!=null?String(s):"";return b&&t?b.toLowerCase()===t.toLowerCase()?b:`${b} ${t}`:b||t||null}),he=f(()=>!!O.value?.hasErrorDetails),me=f(()=>{const s=O.value;if(!s)return!1;const t=G.value;return!!(t!==null&&t>=400||typeof s.errStatus=="string"&&s.errStatus.trim().length||typeof s.errMsg=="string"&&s.errMsg.trim().length||(s.finishReason??"").toString().toLowerCase()==="error")}),Ie=f(()=>{if(me.value)return"badge--error";const s=G.value;return s==null?"badge--ghost":s>=200&&s<300?"badge--success":"badge--ghost"}),$e=f(()=>{const s=O.value;if(!s)return null;const t=[];return s.errStatus&&t.push(s.errStatus),s.errCode!==null&&s.errCode!==void 0&&`${s.errCode}`.length&&t.push(`code ${s.errCode}`),s.errMsg&&t.push(s.errMsg),t.length?t.join(" · "):null}),Re=f(()=>r.getModelErrorDetails(n.message.id)),Q=re({loading:!1,loaded:!1,error:null,data:null,hasError:!1}),ye=R(!1),qe=f(()=>{if(Q.loaded)return{hasError:Q.hasError,error:Q.data??null};const s=Re.value;return s?{hasError:s.hasError??!1,error:s.error??null}:null}),Ce=f(()=>Q.loading),xe=f(()=>Q.error),tt=f(()=>Q.loaded||!!Re.value),Se=f(()=>{const s=qe.value;return!s||!s.hasError?!1:Pe(s.error??null)}),De=f(()=>Se.value?Ke(qe.value?.error??null):""),Oe=f(()=>O.value?.tokens?.promptTokensDetails??null);function Le(){Q.loading=!1,Q.loaded=!1,Q.error=null,Q.data=null,Q.hasError=!1,ye.value=!1}async function We(s=!1){if(he.value&&!Q.loading){if(!s){const t=Re.value;if(t){Q.data=t.error??null,Q.hasError=t.hasError??!1,Q.loaded=!0,Q.error=null;return}if(Q.loaded)return}Q.loading=!0,Q.error=null;try{const t=await r.loadModelErrorDetails(n.message.id,s);t?(Q.data=t.error??null,Q.hasError=t.hasError??!1,Q.loaded=!0):(Q.data=null,Q.hasError=!1,Q.loaded=!0)}catch(t){const b=t instanceof Error?t.message:String(t);Q.error=b,Q.loaded=!1,d.pushToast({type:"error",title:"错误详情加载失败",message:b})}finally{Q.loading=!1}}}function $t(s){const b=s.currentTarget?.open??!1;ye.value=b,b&&We()}function Ct(){We(!0)}function St(){!Se.value||!De.value||nt(De.value)}const Mt=f(()=>n.message.role==="user"?"用户":n.message.role==="model"?"模型":n.message.role==="system"?"系统":n.message.role),It=f(()=>({"message-card--user":n.message.role==="user","message-card--model":n.message.role==="model","message-card--state-error":n.message.role==="model"&&me.value})),xt=Jt(()=>n.message.ctAt??n.message.meta?.ctAt??null),Pt=f(()=>Me(n.message.ctAt??n.message.meta?.ctAt??Date.now())),At=f(()=>n.message.id.slice(0,8)),Et=f(()=>{const s=n.rootEl;return s?S(s)??void 0:void 0});Mn(v,([s])=>{s.isIntersecting&&Rt()},{root:Et,threshold:.25}),ve(()=>n.message.id,()=>{w.value=!1,i.value=!1,dt(),qt(),Le()}),ve(he,s=>{s||Le()});async function Rt(){w.value||(w.value=!0,!h.value&&n.message.role==="user"&&await Ne())}async function Ne(s=!1){if(!m.value&&!(!s&&W.value)){m.value=!0,i.value=!1;try{await r.loadMessageDetail(n.message.id,s)}catch(t){i.value=!0,d.pushToast({type:"error",title:"加载失败",message:t instanceof Error?t.message:String(t)})}finally{m.value=!1}}}function Pe(s){return s==null?!1:Array.isArray(s)?s.length>0:typeof s=="object"?Object.keys(s).length>0:typeof s=="string"?s.trim().length>0:!0}function Ke(s){try{return typeof s=="string"?s:JSON.stringify(s,null,2)}catch{return String(s)}}async function nt(s){try{await navigator.clipboard.writeText(s),d.pushToast({type:"success",title:"已复制到剪贴板"})}catch(t){d.pushToast({type:"error",title:"复制失败",message:t instanceof Error?t.message:String(t)})}}function dt(){N.value=!1,g.loading=!1,g.loaded=!1,g.error=null,g.data=null,g.raw=null,L.value=null}async function pt(s=!1){if(!g.loading){if(!s){const t=$.value;if(t){g.data=t.requestBody??null,g.raw=t.rawRequestBody??null,g.loaded=!0,g.error=null,L.value=t.requestUrl??L.value;return}if(g.loaded||!F.value)return}g.loading=!0,g.error=null;try{const t=await r.loadMessageRequestBody(n.message.id,s);t?(g.data=t.requestBody??null,g.raw=t.rawRequestBody??null,L.value=t.requestUrl??L.value):(g.data=null,g.raw=null),g.loaded=!0}catch(t){const b=t instanceof Error?t.message:String(t);g.error=b,d.pushToast({type:"error",title:"请求体加载失败",message:b}),g.loaded=!1,g.data=null,g.raw=null}finally{g.loading=!1}}}function qt(){q.value=!1,T.loading=!1,T.loaded=!1,T.error=null,T.data=null,T.raw=null}async function ft(s=!1){if(!T.loading){if(!s){const t=H.value;if(t){T.data=t.requestHeaders??null,T.raw=t.rawRequestHeaders??null,T.loaded=!0,T.error=null,L.value=t.requestUrl??L.value;return}if(T.loaded||!j.value)return}T.loading=!0,T.error=null;try{const t=await r.loadMessageRequestHeaders(n.message.id,s);t?(T.data=t.requestHeaders??null,T.raw=t.rawRequestHeaders??null,L.value=t.requestUrl??L.value):(T.data=null,T.raw=null),T.loaded=!0}catch(t){const b=t instanceof Error?t.message:String(t);T.error=b,d.pushToast({type:"error",title:"请求头加载失败",message:b}),T.loaded=!1,T.data=null,T.raw=null}finally{T.loading=!1}}}function Dt(s){const b=s.currentTarget?.open??!1;N.value=b,b&&pt()}function Lt(){pt(!0)}function Ht(){E.value&&nt(o.value)}function Bt(s){const b=s.currentTarget?.open??!1;q.value=b,b&&ft()}function vt(){ft(!0)}function a(){l.value&&nt(M.value)}return(s,t)=>(c(),p("article",{ref_key:"cardEl",ref:v,class:le(["message-card",It.value])},[e("header",ca,[e("div",da,[e("span",pa,_(Mt.value),1),e("span",{class:"badge badge--id",title:u.message.id},_(At.value),9,fa),A.value?(c(),p("span",va,_(A.value)+" tokens ",1)):U("",!0),we.value?(c(),p("span",{key:1,class:le(["badge",Ie.value])},_(we.value),3)):U("",!0)]),e("div",ma,[e("span",{class:"timestamp",title:Pt.value},[m.value?(c(),p("span",ga)):U("",!0),se(" "+_(S(xt)),1)],8,ha),i.value?(c(),p("button",{key:0,class:"ghost-button ghost-button--alert",disabled:m.value,onClick:t[0]||(t[0]=b=>Ne(!0))},[x(z,{name:"refresh"}),t[1]||(t[1]=se(" 重试加载 ",-1))],8,ya)):U("",!0)])]),u.message.role==="user"?(c(),p(ce,{key:0},[h.value?(c(),p("section",_a,[e("header",ba,[x(z,{name:"link"}),t[2]||(t[2]=se(" 请求 URL ",-1))]),e("div",wa,[e("code",null,_(h.value),1)])])):U("",!0),D.value?(c(),p("details",{key:1,class:"message-card__request-section",onToggle:Bt},[e("summary",null,[x(z,{name:"http"}),e("span",null,[t[3]||(t[3]=se(" 请求头部 ",-1)),y.value!==null?(c(),p(ce,{key:0},[se(" ("+_(y.value)+")",1)],64)):U("",!0)])]),e("div",{class:"request-section__content","data-open":q.value},[ee.value?(c(),p("div",Ta,[...t[4]||(t[4]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载请求头…",-1)])])):ne.value?(c(),p("div",$a,[x(z,{name:"error"}),e("span",null,_(ne.value),1),e("button",{class:"ghost-button",onClick:Z(vt,["stop"])},[x(z,{name:"refresh"}),t[5]||(t[5]=se(" 重试加载 ",-1))])])):l.value?(c(),p(ce,{key:2},[e("pre",null,[e("code",null,_(M.value),1)]),e("button",{class:"ghost-button",onClick:a},[x(z,{name:"content_copy"}),t[6]||(t[6]=se(" 复制 ",-1))])],64)):(c(),p("div",Ca,[...t[7]||(t[7]=[e("span",null,"没有可显示的请求头内容。",-1)])]))],8,ka)],32)):U("",!0),P.value?(c(),p("details",{key:2,ref_key:"requestBodyDetailsEl",ref:k,class:"message-card__request-section message-card__request-section--body",onToggle:Dt},[e("summary",null,[x(z,{name:"data_object"}),t[8]||(t[8]=e("span",null,"请求 Body",-1))]),e("div",{class:"request-section__content","data-open":N.value},[J.value?(c(),p("div",Ma,[...t[9]||(t[9]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载请求体…",-1)])])):te.value?(c(),p("div",Ia,[x(z,{name:"error"}),e("span",null,_(te.value),1),e("button",{class:"ghost-button",onClick:Z(Lt,["stop"])},[x(z,{name:"refresh"}),t[10]||(t[10]=se(" 重试加载 ",-1))])])):E.value?(c(),p(ce,{key:2},[e("pre",null,[e("code",null,_(o.value),1)]),e("button",{class:"ghost-button",onClick:Ht},[x(z,{name:"content_copy"}),t[11]||(t[11]=se(" 复制 ",-1))])],64)):(c(),p("div",xa,[...t[12]||(t[12]=[e("span",null,"没有可显示的请求体内容。",-1)])]))],8,Sa)],544)):U("",!0)],64)):U("",!0),u.message.role==="model"?(c(),p(ce,{key:1},[O.value?(c(),p("section",Pa,[O.value.modelName?(c(),p("div",Aa,[x(z,{name:"smart_toy"}),t[13]||(t[13]=e("span",{class:"meta-label"},"模型:",-1)),e("span",Ea,_(O.value.modelName),1)])):U("",!0),O.value.status!==null&&O.value.status!==void 0?(c(),p("div",Ra,[x(z,{name:"info"}),t[14]||(t[14]=e("span",{class:"meta-label"},"状态码:",-1)),e("span",qa,_(O.value.status),1)])):U("",!0),O.value.statusText?(c(),p("div",Da,[x(z,{name:"description"}),t[15]||(t[15]=e("span",{class:"meta-label"},"状态说明:",-1)),e("span",La,_(O.value.statusText),1)])):U("",!0),O.value.tokens?(c(),p("div",Ha,[x(z,{name:"bar_chart"}),t[17]||(t[17]=e("span",{class:"meta-label"},"Token统计:",-1)),e("div",Ba,[O.value.tokens.promptTokenCount!==null&&O.value.tokens.promptTokenCount!==void 0?(c(),p("span",Fa,"Prompt: "+_(O.value.tokens.promptTokenCount),1)):U("",!0),O.value.tokens.candidatesTokenCount!==null&&O.value.tokens.candidatesTokenCount!==void 0?(c(),p("span",za,"Response: "+_(O.value.tokens.candidatesTokenCount),1)):U("",!0),O.value.tokens.thoughtsTokenCount!==null&&O.value.tokens.thoughtsTokenCount!==void 0?(c(),p("span",Ua,"Thinking: "+_(O.value.tokens.thoughtsTokenCount),1)):U("",!0),O.value.tokens.totalTokenCount!==null&&O.value.tokens.totalTokenCount!==void 0?(c(),p("span",Oa,"Total: "+_(O.value.tokens.totalTokenCount),1)):U("",!0),Oe.value&&Oe.value.length?(c(),p("div",Wa,[t[16]||(t[16]=e("span",{class:"token-breakdown__label"},"Prompt 详情:",-1)),e("ul",Na,[(c(!0),p(ce,null,be(Oe.value,(b,X)=>(c(),p("li",{key:X,class:"token-breakdown__item"},[e("span",Ka,_(b.label),1),e("span",ja,_(b.tokenCount??"—"),1)]))),128))])])):U("",!0)])])):U("",!0),O.value.finishReason?(c(),p("div",Va,[x(z,{name:"flag"}),t[18]||(t[18]=e("span",{class:"meta-label"},"结束原因:",-1)),e("span",Ga,_(O.value.finishReason),1)])):U("",!0)])):U("",!0),$e.value||he.value?(c(),p("section",Ya,[e("header",Ja,[x(z,{name:"error"}),t[19]||(t[19]=e("span",{class:"model-section__title"},"错误信息",-1))]),$e.value?(c(),p("p",Qa,_($e.value),1)):U("",!0),he.value?(c(),p("details",{key:1,class:"message-card__model-json","data-tone":"error","data-open":ye.value,onToggle:$t},[e("summary",null,[x(z,{name:"bug_report"}),t[20]||(t[20]=e("span",null,"错误详情",-1)),Ce.value?(c(),p("span",Za)):U("",!0)]),e("div",{class:"model-json-body","data-loading":Ce.value},[Ce.value?(c(),p("div",tl,[...t[21]||(t[21]=[e("span",{class:"loading-dot loading-dot--inline"},null,-1),e("span",null,"正在加载错误详情…",-1)])])):xe.value?(c(),p("div",nl,[x(z,{name:"error"}),e("span",null,_(xe.value),1),e("button",{class:"ghost-button ghost-button--alert",type:"button",onClick:Z(Ct,["stop"])},[x(z,{name:"refresh"}),t[22]||(t[22]=se(" 重试加载 ",-1))])])):Se.value?(c(),p(ce,{key:2},[e("pre",null,[e("code",null,_(De.value),1)]),e("button",{class:"ghost-button ghost-button--alert",type:"button",onClick:Z(St,["stop"])},[x(z,{name:"content_copy"}),t[23]||(t[23]=se(" 复制 ",-1))])],64)):tt.value?(c(),p("div",sl,[...t[24]||(t[24]=[e("span",null,"暂无可显示的错误详情。",-1)])])):(c(),p("div",ol,[...t[25]||(t[25]=[e("span",null,"展开以加载错误详情。",-1)])]))],8,el)],40,Xa)):U("",!0)])):U("",!0)],64)):U("",!0)],2))}}),ll=pe(al,[["__scopeId","data-v-43c8106e"]]),rl={key:0,class:"panel-rail__meta"},il=["title"],ul=["title"],cl=["title"],dl={key:1,class:"panel-rail__meta panel-rail__meta--empty"},pl={key:2,class:"panel-rail__stats"},fl={class:"badge badge--ghost"},vl={class:"badge badge--ghost"},ml=["title"],hl={class:"panel-rail__controls"},gl={class:"panel-rail__actions"},yl=["disabled"],_l={class:"panel-main"},bl={class:"panel-header__title"},wl={class:"panel-header__primary"},kl={key:0,class:"panel-header__count"},Tl={key:0,class:"panel-header__hint"},$l=["title"],Cl={key:1,class:"panel-header__hint"},Sl={class:"panel-header__controls"},Ml={key:0,class:"panel-header__meta"},Il={class:"badge badge--ghost"},xl={class:"badge badge--ghost"},Pl=["title"],Al={class:"panel-header__actions"},El=["disabled"],Rl={key:0,class:"topic-hash-card"},ql={class:"topic-hash-card__header"},Dl={class:"topic-hash-card__title"},Ll={class:"topic-hash-card__content"},Hl={key:0,class:"hash-item"},Bl=["title"],Fl={key:1,class:"hash-item"},zl=["title"],Ul={key:1,class:"empty-state"},Ol={key:2,class:"panel-content empty-state"},Wl=de({__name:"MessagePanel",props:{collapsed:{type:Boolean},mainSpan:{},stackDirection:{}},emits:["request-focus"],setup(u,{expose:n,emit:r}){const d=u,m=r,i=f(()=>{if(d.stackDirection==="right"&&typeof d.mainSpan=="number"&&d.mainSpan>=0)return{width:`${Math.max(d.mainSpan,0)}px`}}),w=Ee();ge();const v=f(()=>w.selectedIp),k=f(()=>w.selectedTopic),N=f(()=>w.currentTopicMessages),q=R(null),L=R(null),g=R(null),T=Vt(Tt,null),W=f(()=>d.collapsed===!0);T?.messageList&&(Fe(L,D=>{const P=D[0];if(!P)return;const J=Array.isArray(P.borderBoxSize)?P.borderBoxSize[0]:P.borderBoxSize,te=J?J.inlineSize:P.contentRect.width;te>0&&T.messageList.reportHeaderSize({width:te,height:0})}),Fe(g,D=>{const P=D[0];if(!P)return;const J=Array.isArray(P.borderBoxSize)?P.borderBoxSize[0]:P.borderBoxSize,te=J?J.blockSize:P.contentRect.height;te>0&&T.messageList.reportHeaderSize({width:0,height:te})}));const A=f(()=>k.value?w.currentIpTopics.find(P=>P.tid===k.value)??null:null),$=f(()=>{const D=A.value?.title;return typeof D=="string"&&D.trim().length>0?D.trim():null}),H=f(()=>({hashNoReason:w.currentTopicMeta?.topicHashNoReason??null,hashWithReason:w.currentTopicMeta?.topicHashWithReason??null})),h=f(()=>{const D=H.value;return D.hashNoReason||D.hashWithReason?{title:"话题哈希",hashNoReason:D.hashNoReason,hashWithReason:D.hashWithReason,messageId:null}:null}),F=f(()=>N.value),j=f(()=>{const D=v.value,P=k.value;return!D||!P?!1:w.loadingMessages.get(`${D}:${P}`)===!0}),Y=Jt(()=>A.value?.upAt??null);function V(D){return D?D.length>16?`${D.slice(0,8)}...${D.slice(-8)}`:D:""}async function C(){!v.value||!k.value||await w.ensureMessages(v.value,k.value,!0)}function I(){m("request-focus")}function y(){}return n({resetToCollapsedState:y}),(D,P)=>(c(),p("section",{class:le(["panel panel--message",{"panel--collapsed":W.value}]),style:wt(i.value),onMouseenter:I,onFocusin:I,onPointerdownCapture:I},[u.stackDirection==="right"?(c(),p("aside",{key:0,ref_key:"desktopRailEl",ref:L,class:"panel-rail panel-rail--desktop"},[P[2]||(P[2]=e("div",{class:"panel-rail__title","aria-hidden":"true"},"消息详情",-1)),k.value?(c(),p("div",rl,[e("strong",null,_(A.value?.msgCnt??F.value.length),1),P[0]||(P[0]=e("span",null,"消息",-1)),$.value?(c(),p("div",{key:0,class:"panel-rail__hint",title:$.value}," 标题 "+_($.value),9,il)):U("",!0),e("div",{class:"panel-rail__hint",title:k.value},"话题 "+_(k.value),9,ul),v.value?(c(),p("div",{key:1,class:"panel-rail__hint",title:v.value},"IP "+_(v.value),9,cl)):U("",!0)])):(c(),p("div",dl,[...P[1]||(P[1]=[e("span",null,"等待",-1),e("span",null,"选择话题",-1)])])),A.value?(c(),p("div",pl,[e("span",fl,"入 "+_(S(ke)(A.value.inBytes)),1),e("span",vl,"出 "+_(S(ke)(A.value.outBytes)),1),e("span",{class:"badge badge--ghost",title:S(Me)(A.value.upAt)}," 更新 "+_(S(Y)),9,ml)])):U("",!0),e("div",hl,[e("div",gl,[e("button",{class:"control-button control-button--icon",type:"button",title:"刷新消息","aria-label":"刷新消息",disabled:!k.value||j.value,onClick:C},[x(z,{name:"sync"})],8,yl)])])],512)):U("",!0),e("div",_l,[u.stackDirection==="down"?(c(),p("header",{key:0,ref_key:"mobileHeaderEl",ref:g,class:"panel-header panel-header--mobile"},[e("div",bl,[e("div",wl,[P[3]||(P[3]=e("h2",null,"消息详情",-1)),k.value?(c(),p("span",kl,_(A.value?.msgCnt??F.value.length),1)):U("",!0)]),k.value?(c(),p("p",Tl,[$.value?(c(),p("span",{key:0,class:"topic-header__title",title:$.value},_($.value),9,$l)):U("",!0),e("span",null,"话题 "+_(k.value),1),P[4]||(P[4]=se(" · ",-1)),e("span",null,"IP "+_(v.value??"—"),1)])):(c(),p("p",Cl,"等待选择话题"))]),e("div",Sl,[A.value?(c(),p("div",Ml,[e("span",Il,"入 "+_(S(ke)(A.value.inBytes)),1),e("span",xl,"出 "+_(S(ke)(A.value.outBytes)),1),e("span",{class:"badge badge--ghost",title:S(Me)(A.value.upAt)},"更新 "+_(S(Y)),9,Pl)])):U("",!0),e("div",Al,[e("button",{class:"control-button control-button--icon",type:"button",title:"刷新消息","aria-label":"刷新消息",disabled:!k.value||j.value,onClick:C},[x(z,{name:"sync"})],8,El)])])],512)):U("",!0),k.value?(c(),p("div",{key:1,ref_key:"listEl",ref:q,class:"panel-content message-list"},[h.value?(c(),p("article",Rl,[e("header",ql,[e("div",Dl,[x(z,{name:"tag"}),e("span",null,_(h.value.title),1)])]),e("div",Ll,[h.value.hashNoReason?(c(),p("div",Hl,[P[5]||(P[5]=e("span",{class:"hash-label"},"无推理:",-1)),e("code",{class:"hash-value",title:h.value.hashNoReason},_(V(h.value.hashNoReason)),9,Bl)])):U("",!0),h.value.hashWithReason?(c(),p("div",Fl,[P[6]||(P[6]=e("span",{class:"hash-label"},"含推理:",-1)),e("code",{class:"hash-value",title:h.value.hashWithReason},_(V(h.value.hashWithReason)),9,zl)])):U("",!0)])])):U("",!0),(c(!0),p(ce,null,be(F.value,J=>(c(),Te(ll,{key:J.id,message:J,"root-el":q.value},null,8,["message","root-el"]))),128)),F.value.length?U("",!0):(c(),p("div",Ul,[...P[7]||(P[7]=[e("p",null,"暂无消息。",-1)])]))],512)):(c(),p("div",Ol,[...P[8]||(P[8]=[e("p",null,"请选择话题查看消息详情。",-1)])]))])],38))}}),Nl=pe(Wl,[["__scopeId","data-v-9a56742c"]]),Kl={class:"toast-container"},jl={class:"toast__icon"},Vl={class:"toast__body"},Gl={key:0},Yl=["onClick"],Jl=de({__name:"ToastContainer",setup(u){const n=ge();function r(d){switch(d){case"success":return"check_circle";case"error":return"error";case"warning":return"warning";default:return"info"}}return(d,m)=>(c(),p("div",Kl,[x(In,{name:"toast",tag:"div"},{default:ze(()=>[(c(!0),p(ce,null,be(S(n).toasts,i=>(c(),p("div",{key:i.id,class:le(["toast",i.type])},[e("div",jl,[x(z,{name:r(i.type)},null,8,["name"])]),e("div",Vl,[e("strong",null,_(i.title),1),i.message?(c(),p("p",Gl,_(i.message),1)):U("",!0)]),e("button",{class:"toast__close",onClick:w=>S(n).dismissToast(i.id)},[x(z,{name:"close"})],8,Yl)],2))),128))]),_:1})]))}}),Ql=pe(Jl,[["__scopeId","data-v-e4c6c4f4"]]);function et(u){if(typeof window>"u")return{onBackdropPointerDown:()=>{},onBackdropPointerUp:()=>{}};let n=!1,r=null;const d=()=>{n=!1,r=null,window.removeEventListener("pointerup",m,!0),window.removeEventListener("pointercancel",i,!0)},m=k=>{n&&r===k.pointerId&&u(),d()},i=()=>{d()},w=k=>{k.button===0&&(n=!0,r=k.pointerId,window.addEventListener("pointerup",m,!0),window.addEventListener("pointercancel",i,!0))},v=k=>{if(k.button!==0){d();return}if(!n||r!==k.pointerId){d();return}u(),d()};return xn()&&jt(()=>{d()}),{onBackdropPointerDown:w,onBackdropPointerUp:v}}const Xl={class:"modal"},Zl={class:"actions"},er=de({__name:"PreviewModal",setup(u){const n=ge(),r=n.preview,m=de({name:"PlainRenderer",props:{source:{type:String,required:!0}},setup(q){return()=>Pn("pre",{class:"plain"},q.source)}}),i=R(null),{onBackdropPointerDown:w,onBackdropPointerUp:v}=et(k);ve(()=>!r.open||!r.payload?.downloadableName?null:{content:r.payload.content,mimeType:r.payload.mimeType},(q,L,g)=>{if(i.value&&(URL.revokeObjectURL(i.value),i.value=null),q){const T=new Blob([q.content],{type:q.mimeType??"text/plain"}),W=URL.createObjectURL(T);i.value=W,g(()=>{URL.revokeObjectURL(W)})}});function k(){n.closePreview()}function N(){if(!i.value||!r.payload?.downloadableName)return;const q=document.createElement("a");q.href=i.value,q.download=r.payload.downloadableName,q.click()}return(q,L)=>(c(),Te(Ue,{to:"body"},[x(Xe,{name:"fade"},{default:ze(()=>[S(r).open&&S(r).payload?(c(),p("div",{key:0,class:"overlay",onPointerdown:L[0]||(L[0]=Z((...g)=>S(w)&&S(w)(...g),["self"])),onPointerup:L[1]||(L[1]=Z((...g)=>S(v)&&S(v)(...g),["self"]))},[e("div",Xl,[e("header",null,[e("h3",null,_(S(r).payload.title),1),e("div",Zl,[i.value?(c(),p("button",{key:0,class:"ghost",onClick:N},[x(z,{name:"download"}),L[2]||(L[2]=se(" 导出 ",-1))])):U("",!0),e("button",{class:"icon",onClick:k},[x(z,{name:"close"})])])]),e("section",null,[(c(),Te(dn(S(m)),{source:S(r).payload.content},null,8,["source"]))])])],32)):U("",!0)]),_:1})]))}}),tr=pe(er,[["__scopeId","data-v-4161bfb1"]]),nr={class:"modal"},sr={class:"content"},or=["src","alt"],ar=de({__name:"ImagePreviewModal",setup(u){const n=ge(),r=n.imagePreview,{onBackdropPointerDown:d,onBackdropPointerUp:m}=et(i);function i(){n.closeImagePreview()}return(w,v)=>(c(),Te(Ue,{to:"body"},[x(Xe,{name:"fade"},{default:ze(()=>[S(r).open?(c(),p("div",{key:0,class:"overlay",onPointerdown:v[0]||(v[0]=Z((...k)=>S(d)&&S(d)(...k),["self"])),onPointerup:v[1]||(v[1]=Z((...k)=>S(m)&&S(m)(...k),["self"]))},[e("div",nr,[e("header",null,[e("h3",null,_(S(r).name??"图片预览"),1),e("button",{class:"icon",onClick:i},[x(z,{name:"close"})])]),e("div",sr,[e("img",{src:S(r).src,alt:S(r).name??"attachment"},null,8,or)])])],32)):U("",!0)]),_:1})]))}}),lr=pe(ar,[["__scopeId","data-v-470c8bfc"]]),rr={class:"dialog"},ir={class:"actions"},ur=de({__name:"ConfirmDialog",setup(u){const n=ge(),{confirmDialog:r}=kt(n),d=f(()=>r.value.open?r.value.options:null),{onBackdropPointerDown:m,onBackdropPointerUp:i}=et(w);function w(){n.resolveConfirm(!1)}function v(){n.resolveConfirm(!0)}return(k,N)=>(c(),Te(Ue,{to:"body"},[x(Xe,{name:"fade"},{default:ze(()=>[d.value?(c(),p("div",{key:0,class:"overlay",onPointerdown:N[0]||(N[0]=Z((...q)=>S(m)&&S(m)(...q),["self"])),onPointerup:N[1]||(N[1]=Z((...q)=>S(i)&&S(i)(...q),["self"]))},[e("div",rr,[e("h3",null,_(d.value.title),1),e("p",null,_(d.value.message),1),e("div",ir,[e("button",{class:"ghost",onClick:w},_(d.value.cancelLabel??"取消"),1),e("button",{class:"danger",onClick:v},_(d.value.confirmLabel??"确认"),1)])])],32)):U("",!0)]),_:1})]))}}),cr=pe(ur,[["__scopeId","data-v-d1092b8d"]]),dr={class:"panel"},pr={class:"actions"},fr=["disabled"],vr={class:"form-section"},mr={class:"field"},hr={class:"field-inline"},gr={class:"field"},yr=["value"],_r={class:"field"},br=["disabled"],wr={class:"list-section"},kr={key:0,class:"loading"},Tr={key:1,class:"empty"},$r={key:2},Cr={class:"mono"},Sr=["onClick"],Mr=de({__name:"BanManager",setup(u){const n=Ee(),r=ge(),{blockedIPs:d,loadingBlockedIPs:m}=kt(n),i=[{label:"1 小时",value:3600*1e3},{label:"6 小时",value:360*60*1e3},{label:"1 天",value:1440*60*1e3},{label:"7 天",value:10080*60*1e3},{label:"30 天",value:720*60*60*1e3},{label:"永久",value:null}],w=R(""),v=R(i[2].value),k=R(""),N=R(!1),q=f(()=>m.value),L=f(()=>d.value?.blocked??[]),g=f(()=>d.value?.now??Date.now());async function T(V=!1){await n.refreshBlockedIPs(V)}async function W(){if(w.value){N.value=!0;try{await n.banIp(w.value,v.value??void 0,k.value||void 0),r.pushToast({type:"success",title:"封禁成功",message:`${w.value} 已被封禁`}),w.value="",k.value="",await T(!0)}catch(V){r.pushToast({type:"error",title:"封禁失败",message:V instanceof Error?V.message:String(V)})}finally{N.value=!1}}}async function A(){await T(!0)}function $(){r.toggleBanManager(!1)}const{onBackdropPointerDown:H,onBackdropPointerUp:h}=et($);async function F(V){await n.unbanIp(V),r.pushToast({type:"success",title:"已解除封禁",message:`${V} 已解除`}),await T(!0)}function j(V){return V?Me(V):"永久封禁"}function Y(V){if(!V)return"永久";const C=V-g.value;return C<=0?"即将解除":vn(C)}return ve(()=>r.banManagerOpen,V=>{V&&T()}),ct(()=>{r.banManagerOpen&&T()}),(V,C)=>(c(),Te(Ue,{to:"body"},[x(Xe,{name:"overlay-dialog"},{default:ze(()=>[S(r).banManagerOpen?(c(),p("div",{key:0,class:"overlay",onPointerdown:C[3]||(C[3]=Z((...I)=>S(H)&&S(H)(...I),["self"])),onPointerup:C[4]||(C[4]=Z((...I)=>S(h)&&S(h)(...I),["self"]))},[e("div",dr,[e("header",null,[C[5]||(C[5]=e("h3",null,"IP 封禁管理",-1)),e("div",pr,[e("button",{class:"ghost",disabled:q.value,onClick:A},"刷新",8,fr),e("button",{class:"icon",onClick:$},[x(z,{name:"close"})])])]),e("section",vr,[C[10]||(C[10]=e("h4",null,"新增封禁",-1)),e("form",{onSubmit:Z(W,["prevent"])},[e("div",mr,[C[6]||(C[6]=e("label",null,"IP 地址",-1)),zt(e("input",{"onUpdate:modelValue":C[0]||(C[0]=I=>w.value=I),type:"text",placeholder:"例如 192.168.0.1",required:""},null,512),[[Zt,w.value,void 0,{trim:!0}]])]),e("div",hr,[e("div",gr,[C[7]||(C[7]=e("label",null,"封禁时长",-1)),zt(e("select",{"onUpdate:modelValue":C[1]||(C[1]=I=>v.value=I)},[(c(),p(ce,null,be(i,I=>e("option",{key:I.value??"perm",value:I.value},_(I.label),9,yr)),64))],512),[[An,v.value]])]),e("div",_r,[C[8]||(C[8]=e("label",null,"原因（可选）",-1)),zt(e("input",{"onUpdate:modelValue":C[2]||(C[2]=I=>k.value=I),type:"text",placeholder:"记录封禁原因"},null,512),[[Zt,k.value,void 0,{trim:!0}]])]),e("button",{class:"primary",type:"submit",disabled:N.value},[x(z,{name:"gavel"}),C[9]||(C[9]=se(" 封禁 ",-1))],8,br)])],32)]),e("section",wr,[C[12]||(C[12]=e("h4",null,"已封禁 IP",-1)),q.value?(c(),p("div",kr,"正在加载...")):L.value.length===0?(c(),p("div",Tr,"暂无封禁记录")):(c(),p("table",$r,[C[11]||(C[11]=e("thead",null,[e("tr",null,[e("th",null,"IP"),e("th",null,"解除时间"),e("th",null,"剩余"),e("th",null,"原因"),e("th",null,"操作")])],-1)),e("tbody",null,[(c(!0),p(ce,null,be(L.value,I=>(c(),p("tr",{key:I.ip},[e("td",Cr,_(I.ip),1),e("td",null,_(j(I.unblockAt)),1),e("td",null,_(Y(I.unblockAt)),1),e("td",null,_(I.reason||"—"),1),e("td",null,[e("button",{class:"danger",onClick:y=>F(I.ip)},"解除封禁",8,Sr)])]))),128))])]))])])],32)):U("",!0)]),_:1})]))}}),Ir=pe(Mr,[["__scopeId","data-v-9de310ce"]]),xr={class:"panel"},Pr={class:"actions"},Ar=["disabled"],Er={key:0,class:"loading"},Rr={key:1,class:"empty"},qr={key:2},Dr={class:"mono"},Lr={class:"row-actions"},Hr=["onClick"],Br=["onClick"],Fr=de({__name:"AliasManager",setup(u){const n=ge(),r=Ee(),{aliasKeys:d,loadingAliasKeys:m}=kt(r),i=f(()=>d.value?.aliasKeys??[]),w=f(()=>m.value);function v(){n.toggleAliasManager(!1)}const{onBackdropPointerDown:k,onBackdropPointerUp:N}=et(v);async function q(W=!0){await r.refreshAliasKeys(W)}async function L(W){await n.confirm({title:"删除别名",message:`确定要删除别名 ${W} 吗？`})&&(await r.removeAlias(W),n.pushToast({type:"success",title:"删除成功",message:`${W} 已删除`}),await q(!0))}async function g(W){try{await navigator.clipboard.writeText(W),n.pushToast({type:"success",title:"已复制",message:W})}catch(A){n.pushToast({type:"error",title:"复制失败",message:A instanceof Error?A.message:String(A)})}}function T(W){return W?Me(W):"—"}return ve(()=>n.aliasManagerOpen,W=>{W&&q(!1)}),ct(()=>{n.aliasManagerOpen&&q(!1)}),(W,A)=>(c(),Te(Ue,{to:"body"},[x(Xe,{name:"overlay-dialog"},{default:ze(()=>[S(n).aliasManagerOpen?(c(),p("div",{key:0,class:"overlay",onPointerdown:A[1]||(A[1]=Z((...$)=>S(k)&&S(k)(...$),["self"])),onPointerup:A[2]||(A[2]=Z((...$)=>S(N)&&S(N)(...$),["self"]))},[e("div",xr,[e("header",null,[A[3]||(A[3]=e("h3",null,"别名密钥管理",-1)),e("div",Pr,[e("button",{class:"ghost",disabled:w.value,onClick:A[0]||(A[0]=$=>q())},"刷新",8,Ar),e("button",{class:"icon",onClick:v},[x(z,{name:"close"})])])]),e("section",null,[w.value?(c(),p("div",Er,"正在加载别名密钥...")):i.value.length===0?(c(),p("div",Rr,"暂无别名密钥")):(c(),p("table",qr,[A[6]||(A[6]=e("thead",null,[e("tr",null,[e("th",null,"别名"),e("th",null,"创建时间"),e("th",null,"最近使用"),e("th",null,"使用次数"),e("th",null,"操作")])],-1)),e("tbody",null,[(c(!0),p(ce,null,be(i.value,$=>(c(),p("tr",{key:$.aliasName},[e("td",Dr,_($.aliasName),1),e("td",null,_(T($.ctAt)),1),e("td",null,_(T($.upAt||$.firstUsedAt)),1),e("td",null,_($.usageCount),1),e("td",null,[e("div",Lr,[e("button",{class:"ghost",onClick:H=>g($.aliasName)},[x(z,{name:"content_copy"}),A[4]||(A[4]=se(" 复制 ",-1))],8,Hr),e("button",{class:"danger",onClick:H=>L($.aliasName)},[x(z,{name:"delete"}),A[5]||(A[5]=se(" 删除 ",-1))],8,Br)])])]))),128))])]))])])],32)):U("",!0)]),_:1})]))}}),zr=pe(Fr,[["__scopeId","data-v-8cd9c6d4"]]),Ur={class:"panel"},Or=de({__name:"HelpPanel",setup(u){const n=ge(),{onBackdropPointerDown:r,onBackdropPointerUp:d}=et(m);function m(){n.toggleHelpPanel(!1)}return(i,w)=>(c(),Te(Ue,{to:"body"},[x(Xe,{name:"fade"},{default:ze(()=>[S(n).helpPanelOpen?(c(),p("div",{key:0,class:"overlay",onPointerdown:w[0]||(w[0]=Z((...v)=>S(r)&&S(r)(...v),["self"])),onPointerup:w[1]||(w[1]=Z((...v)=>S(d)&&S(d)(...v),["self"]))},[e("div",Ur,[e("header",null,[w[2]||(w[2]=e("h3",null,"操作帮助",-1)),e("button",{class:"icon",onClick:m},[x(z,{name:"close"})])]),w[3]||(w[3]=e("section",null,[e("article",null,[e("h4",null,"基础用法"),e("ul",null,[e("li",null,"左侧 IP 面板支持按请求数、流量等排序，单击选择后即可加载相关主题。"),e("li",null,"主题列表支持快速筛选，可通过右上角搜索框按主题 ID 或别名过滤。"),e("li",null,"消息面板会自动缓存已加载的数据，再次打开时秒级响应，顶部按钮可强制刷新。")])]),e("article",null,[e("h4",null,"操作快捷键"),e("ul",null,[e("li",null,[e("kbd",null,"R"),se("：刷新当前主题消息。")]),e("li",null,[e("kbd",null,"Shift"),se(" + "),e("kbd",null,"R"),se("：请求全量增量同步。")]),e("li",null,[e("kbd",null,"Ctrl"),se(" + "),e("kbd",null,"F"),se("：定位浏览器原生搜索，结合消息折叠功能快速定位。")])]),e("p",{class:"hint"},"提示：快捷键操作会在浏览器焦点位于页面内时生效。")]),e("article",null,[e("h4",null,"封禁与别名"),e("ul",null,[e("li",null,"封禁和别名管理在右上角菜单中打开，支持实时刷新。"),e("li",null,"封禁记录支持自定义时长和原因，解除后相关状态实时更新。"),e("li",null,"别名密钥展示实时使用次数，删除操作需二次确认以避免误删。")])]),e("article",null,[e("h4",null,"异常处理"),e("ul",null,[e("li",null,"若出现请求失败，可通过右上角的告警信息查看错误详情并重试。"),e("li",null,"消息附件若体积较大，可分块加载文本内容；原始 JSON 支持下载保存。"),e("li",null,"若发现数据与服务端不一致，可点击“强制全量刷新”重新同步缓存。")])])],-1))])],32)):U("",!0)]),_:1})]))}}),Wr=pe(Or,[["__scopeId","data-v-6f96b201"]]),Nr={class:"overlay-control__surface"},Kr=["value","placeholder","aria-label","onKeydown"],jr=["value","aria-label"],Vr=["value","disabled"],cn=56,Gr=de({__name:"OverlayControl",setup(u){const n=Qt(),r=f(()=>n.visible),d=f(()=>n.expanded),m=f(()=>n.closing),i=f(()=>n.rect),w=f(()=>n.icon),v=f(()=>n.variant),k=f(()=>n.label),N=f(()=>n.relocating),q=f({get:()=>n.value,set:E=>n.updateValue(E)}),L=f(()=>n.options),g=f(()=>n.align),T=f(()=>n.collapsedWidth),W=f(()=>n.expandedWidth),A=R(null),$=R(null),H=f(()=>[`overlay-control--${v.value}`,{"overlay-control--expanded":d.value,"overlay-control--relocating":N.value}]),h=f(()=>({"overlay-control__icon":!0,"panel-control__icon":!0,"panel-filter__icon":v.value==="filter","panel-select__icon":v.value==="sort"})),F=f(()=>{const E=i.value,l=T.value||E.width||0,o=l>0?l:0,M=W.value||o,O=M>0?Math.max(M,o):o,B=E.left,G=E.left+E.width,we=g.value==="right"?G-O:B,he=g.value==="right"?G-o:B;let me=we,Ie=he;if(typeof window<"u"){const xe=window.innerWidth??O,tt=Math.max(xe-O,0),Se=Math.max(xe-o,0);me=Math.min(Math.max(we,0),tt),Ie=Math.min(Math.max(he,0),Se)}const $e=d.value&&!m.value,Re=$e?O:o,Q=$e?me:Ie,ye=Math.max(o-cn,0),qe=Math.max(O-cn,0),Ce=$e?qe:ye;return{top:`${E.top}px`,left:`${Q}px`,width:`${Re}px`,height:`${E.height}px`,"--overlay-field-width":`${Math.max(Ce,0)}px`}});function j(){n.beginInteraction()}function Y(){n.scheduleClose()}function V(){n.beginInteraction()}function C(E){const l=E.currentTarget,o=E.relatedTarget;l&&o&&l.contains(o)||n.scheduleClose(200)}function I(E){m.value&&(E.propertyName==="width"||E.propertyName==="left")&&n.finalize()}function y(E){r.value&&(E.key==="Escape"&&n.cancel(),E.key==="Enter"&&v.value==="filter"&&n.requestClose())}function D(){r.value&&n.refreshAnchorRect()}function P(){En(()=>{const E=v.value==="filter"?A.value:$.value;if(E?.focus({preventScroll:!0}),E instanceof HTMLInputElement){const l=E.value.length;E.setSelectionRange(l,l)}})}function J(E){n.updateValue(E.target.value)}function te(){n.commit()}function ee(){n.cancel()}function ne(E){const l=E.target.value;n.commit(l)}return ve(r,E=>{E&&P()}),ve(d,(E,l)=>{E&&!l&&P()}),ve(N,E=>{E&&P()}),ct(()=>{window.addEventListener("keydown",y,!0),window.addEventListener("resize",D,!0),window.addEventListener("scroll",D,!0)}),jt(()=>{window.removeEventListener("keydown",y,!0),window.removeEventListener("resize",D,!0),window.removeEventListener("scroll",D,!0)}),(E,l)=>(c(),Te(Ue,{to:"body"},[r.value?(c(),p("div",{key:0,class:le(["overlay-control",H.value]),style:wt(F.value),role:"dialog",onMouseenter:j,onMouseleave:Y,onFocusin:V,onFocusout:C,onTransitionend:I},[e("div",Nr,[x(z,{name:w.value,class:le(h.value)},null,8,["name","class"]),v.value==="filter"?(c(),p("input",{key:0,ref_key:"filterInputRef",ref:A,class:"overlay-control__field overlay-control__input",type:"text",value:q.value,placeholder:k.value,"aria-label":k.value,onInput:J,onKeydown:[fe(Z(te,["prevent"]),["enter"]),fe(Z(ee,["prevent"]),["esc"])],onBlur:te},null,40,Kr)):(c(),p("select",{key:1,ref_key:"selectRef",ref:$,class:"overlay-control__field overlay-control__select",value:q.value,"aria-label":k.value,onChange:ne},[(c(!0),p(ce,null,be(L.value,o=>(c(),p("option",{key:o.value,value:o.value,disabled:o.disabled===!0},_(o.label),9,Vr))),128))],40,jr))])],38)):U("",!0)]))}}),Yr=pe(Gr,[["__scopeId","data-v-8be5915e"]]),Jr={key:1,class:"loading-state"},Qr=de({__name:"App",setup(u){const n=Ee(),{initialized:r}=kt(n),d=f(()=>r.value),m={ipList:Io,topicList:ua,messageList:Nl},i=["ipList","topicList","messageList"],{layout:w,setViewport:v,setContainerSize:k,setFocusedPanel:N,updatePanelHeader:q}=Gs(i),L=f(()=>w.value.activePanelId),g=f(()=>w.value.stackDirection),T=f(()=>({"--layout-total":`${w.value.totalSpan}px`})),W=f(()=>({"app-shell--vertical":g.value==="down"})),A=f(()=>({"dashboard-grid--vertical":g.value==="down","dashboard-grid--horizontal":g.value==="right","dashboard-grid--focused":!!L.value})),$={ipList:R(null),topicList:R(null),messageList:R(null)},H={ipList(C){$.ipList.value=C},topicList(C){$.topicList.value=C},messageList(C){$.messageList.value=C}};function h(C){return[`panel-stack--${C.id}`,{"panel-stack--focused":C.id===L.value,"panel-stack--muted":!!L.value&&C.id!==L.value,"panel-stack--collapsed":!!L.value&&C.id!==L.value}]}function F(C){N(C),Object.entries($).forEach(([I,y])=>{I!==C&&y.value?.resetToCollapsedState()})}const j=R(null);Fe(j,C=>{const I=C[0];if(!I)return;let y=I.contentRect.width;j.value?.closest(".app-shell")&&(y=y-1);const P=Math.max(0,Math.round(y*10)/10),J=Math.max(0,Math.round(I.contentRect.height*10)/10);k(P,J)}),qn(Tt,{ipList:{reportHeaderSize(C){q("ipList",C.width,C.height)}},topicList:{reportHeaderSize(C){q("topicList",C.width,C.height)}},messageList:{reportHeaderSize(C){q("messageList",C.width,C.height)}}});const{width:Y,height:V}=Rn();return ve([Y,V],([C,I])=>{v(C??0,I??0)},{immediate:!0}),ct(async()=>{await n.initialize(),await n.refreshLightStats()}),(C,I)=>(c(),p("div",{class:le(["app-shell",W.value])},[x(zs),d.value?(c(),p("section",{key:0,ref_key:"gridEl",ref:j,class:le(["dashboard-grid",A.value]),style:wt(T.value)},[(c(!0),p(ce,null,be(S(w).panels,y=>(c(),p("div",{key:y.id,class:le(["panel-stack",h(y)]),style:wt(y.style)},[(c(),Te(dn(m[y.id]),{collapsed:!!L.value&&y.id!==L.value,"main-span":y.mainSpan,"stack-direction":g.value,ref_for:!0,ref:H[y.id],onRequestFocus:D=>F(y.id)},null,40,["collapsed","main-span","stack-direction","onRequestFocus"]))],6))),128))],6)):(c(),p("div",Jr,[...I[0]||(I[0]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在加载仪表板数据...",-1)])])),x(Ql),x(tr),x(lr),x(cr),x(Ir),x(zr),x(Wr),x(Yr)],2))}}),Xr=pe(Qr,[["__scopeId","data-v-d33ee2fd"]]),yn=Dn(Xr);yn.use(Ln());yn.mount("#app");typeof window<"u"&&(window.dispatchEvent(new CustomEvent("dashboard:mounted",{detail:Date.now()})),window.__hideDashboardLoading?.());
